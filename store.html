<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ZamListing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
  <style>
    :root {
      --primary: #2e7d32; --primary-dark: #1b5e20; --primary-light: #81c784; --accent: #ff9800;
      --text: #222; --text-light: #666; --background: #f5f5f5; --card-bg: white;
      --border: #e0e0e0; --shadow: 0 0 8px rgba(0,0,0,0.05); --success: #e8f5e9;
      --error: #ffebee; --danger: #c62828;
      --whatsapp: #25d366; --sms: #ff9800;
      --footer-bg: #2e7d32;
      --footer-text: #fff;
      --footer-link: #ffd600;
    }
    body { font-family: 'Roboto', sans-serif; color: var(--text); background: var(--background); line-height: 1.5; }
    .brand-title { font-size: 2.6rem; font-weight: 900; letter-spacing: 0.05em; color: var(--primary-dark); text-shadow: 0 1px 0 #fff; margin-bottom: 0.6rem; }
    .brand-title .highlight { color: var(--accent); text-shadow: none; }
    .tagline { font-size: 1.45rem; font-weight: 500; color: var(--primary); margin-bottom: 0.45rem; }
    .subtitle { font-size: 1.1rem; color: var(--text-light); margin-bottom: 1.2rem; margin-top: -0.5rem; }
    header { background: linear-gradient(135deg, var(--primary), var(--primary-dark) 90%); color: white; padding: 2.2rem 1rem 1.5rem 1rem; text-align: center; box-shadow: 0 2px 7px rgba(0,0,0,0.09); border-radius: 0 0 18px 18px;}
    .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; display: flex; flex-direction: column; gap: 2rem; }
    .filter-search-section { width: 100%; margin-bottom: 1.5rem; }
    .filter-search-section > div { display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
    .filter-search-section label { font-weight: 500; }
    .filter-search-section select, .filter-search-section input[type="text"] {
      padding: 0.5rem; border-radius: 4px; border: 1px solid #ccc; font-size: 1.06rem; min-width: 120px;
    }
    .slider-section { position: relative; width: 100%; margin-bottom: 2rem; background: var(--card-bg); border-radius: 12px; box-shadow: var(--shadow); padding: 1.5rem 1rem 1rem; }
    .slider-title { display: flex; align-items: center; gap: 0.7rem; font-size: 1.42rem; margin-bottom: 1.1rem; color: var(--primary-dark); font-weight: 600; }
    .slider-track { display: flex; overflow-x: auto; gap: 1.4rem; scroll-behavior: smooth; padding-bottom: 16px; padding-top: 6px; }
    .slider-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.63); border: none; color: white; width: 38px; height: 38px; border-radius: 50%; font-size: 1.3rem; cursor: pointer; z-index: 2; }
    .slider-btn:hover { background: rgba(0,0,0,0.81); }
    .slider-btn.prev { left: 8px; }
    .slider-btn.next { right: 8px; }
    .slider-section[hidden] { display: none !important; }
    .taxi-card { min-width: 250px; max-width: 270px; margin: 0 auto; background: linear-gradient(120deg, #e0f7fa 60%, #fceabb 100%); border-radius: 15px; box-shadow: 0 2px 22px rgba(0,0,0,0.12); padding: 1.2rem 1rem; cursor: pointer; transition: box-shadow 0.18s, transform 0.11s;}
    .taxi-card:hover { box-shadow: 0 7px 26px rgba(0,0,0,0.15); transform: scale(1.04);}
    .taxi-emoji-animated { width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.7rem; font-size: 2.9rem; margin: 0.7rem 0 0.3rem 0; animation: taxiEmojiBounce 1.4s infinite;}
    @keyframes taxiEmojiBounce { 0% { transform: translateY(0); } 50% { transform: translateY(-10px) scale(1.07); } 100% { transform: translateY(0); } }
    .taxi-card-title { font-size: 1.17rem; font-weight: 600; color: var(--primary-dark); display: flex; align-items: center; gap: 0.4rem; justify-content: center; margin-bottom: 0.15rem; }
    .taxi-card-desc { color: var(--text-light); font-size: 1.01rem; text-align: center; margin-bottom: 0.2rem; }
    .fa {
      padding: 5px;
      font-size: 18px;
      width: 34px;
      height: 34px;
      line-height: 18px;
      text-align: center;
      text-decoration: none;
      margin: 3px;
      border-radius: 50%;
      color: white;
      display: inline-block;
      vertical-align: middle;
    }
    .fa-whatsapp { background: #25d366; }
    .fa-comment { background: #ff9800; }
    .taxi-hire-actions { display: flex; gap: 7px; align-items: center; justify-content: center; margin: 0.8rem 0 0.2rem 0;}
    .taxi-hire-btn, .bid-btn {
      border: none;
      background: none;
      padding: 0 8px;
      font-size: 1em;
      font-weight: 600;
      color: inherit;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .taxi-hire-btn.calc, .taxi-hire-btn.map, .taxi-hire-btn.hide {
      background: none;
      color: inherit;
      font-size: 1em;
      border-radius: 50%;
      width: auto;
      min-width: 34px;
      min-height: 34px;
      padding: 0 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .taxi-hire-btn.calc i { color: #ff9800; }
    .taxi-hire-btn.map i { color: #00897b; }
    .taxi-hire-btn.hide i { color: #d32f2f; }
    .taxi-hire-btn.sms .fa-comment, .taxi-hire-btn.whatsapp .fa-whatsapp,
    .bid-btn.sms .fa-comment, .bid-btn.whatsapp .fa-whatsapp { margin-right: 4px;}
    .taxi-hire-btn:disabled { background: #ddd; color: #aaa;}
    .taxi-hire-status { margin: 0.7rem auto 0.2rem auto; text-align: center; font-size: 1.03em;}
    .taxi-hire-status.success { color: var(--primary-dark);}
    .taxi-hire-status.error { color: var(--danger);}
    .taxi-hire-map { display: none; width: 100%; height: 150px; border-radius: 7px; border: 1px solid #e0e0e0; margin-top: 0.5rem; background: #f8fafc; align-items: center; justify-content: center; color: #2563eb; overflow: hidden;}
    .taxi-hire-map.show { display: flex !important; }
    .taxi-radio-group {display:flex;gap:18px;margin-bottom:0.7rem;}
    .taxi-radio-label {display:flex;align-items:center;gap:6px;}
    .taxi-radio-label input[type="radio"] {accent-color:var(--primary);}
    .product, .vehicle-item { min-width: 160px; max-width: 170px; border: 1px solid var(--border); border-radius: 10px; padding: 1rem 0.7rem; text-align: center; background: var(--card-bg); transition: box-shadow 0.18s, transform 0.11s;}
    .product:hover, .vehicle-item:hover { transform: translateY(-7px) scale(1.04); box-shadow: 0 7px 26px rgba(0,0,0,0.15);}
    .product img, .vehicle-item img { width: 120px; height: 82px; object-fit: cover; margin-bottom: 0.5rem; border-radius: 4px; border: 2px solid var(--primary-light); background: #fff; }
    .product h4, .vehicle-item h4 { font-size: 1rem; margin-bottom: 0.2rem; color: var(--text); }
    .product p, .vehicle-item p { color: var(--primary-dark); font-weight: 600; margin-bottom: 0.6rem; }
    .vehicle-item p.location { font-size: 0.9rem; color: var(--text-light); margin-bottom: 0.2rem;}
    .product .out-stock { display: block; color: #b71c1c; font-size: 0.97em; font-weight: 600; margin-bottom: 0.7em; }
    .product button, .vehicle-item button { border: none; background: var(--primary); color: white; padding: 0.4rem 0.8rem; border-radius: 5px; cursor: pointer; font-family: inherit; font-weight: 500; transition: background 0.15s;}
    .product button:disabled { background: #ccc !important; cursor: not-allowed; }
    .cart { border: 1px solid var(--border); padding: 1.7rem 1.3rem 2.1rem; border-radius: 10px; flex: 1; min-width: 300px; background: var(--card-bg); position: sticky; top: 1rem; box-shadow: var(--shadow);}
    .cart-items { list-style: none; padding: 0; margin: 0 0 1.5rem; max-height: 320px; overflow-y: auto; }
    .cart-items li { padding: 0.8rem 0; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; gap: 0.2em; animation: fadein 0.33s; min-height: 54px;}
    .cart-items li:last-child { border-bottom: none; }
    .cart-thumb { width: 36px; height: 36px; object-fit: cover; border-radius: 4px; margin-right: 8px; vertical-align: middle; border: 1.5px solid #e5e7eb; background: #fff; }
    .cart-item-info { display: flex; align-items: center; flex: 1; min-width: 0; }
    .cart-item-title { font-weight: 500; font-size: 1.04em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .cart-item-qty { width: 44px; font-size: 1em; margin: 0 6px; padding: 2px 6px; border-radius: 4px; border: 1px solid #ddd; text-align: center; }
    .cart-price-block { display: flex; align-items: center; gap: 4px; }
    .quantity-controls { display: flex; align-items: center; gap: 2px; }
    .quantity-btn, .remove-btn { border: none; background: none; color: var(--primary-dark); font-size: 1.1em; margin: 0 2px; cursor: pointer; padding: 2px 6px; border-radius: 4px; transition: background 0.12s;}
    .quantity-btn:active, .remove-btn:active { background: #f1f1f1; }
    .remove-btn { color: var(--danger); }
    .cart-total { margin: 1rem 0; padding-top: 1rem; border-top: 1px solid var(--border); }
    .cart-total p { margin: 0.5rem 0; }
    .checkout-actions { margin-top: 1rem; display: flex; gap: 10px; justify-content: center;}
    .checkout-btn-sms, .checkout-btn-whatsapp { border: none; background: none; padding: 0 8px; font-size: 1em; font-weight: 600; color: inherit; display: flex; align-items: center; }
    .checkout-btn-sms .fa-comment, .checkout-btn-whatsapp .fa-whatsapp { margin-right: 4px;}
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.52); z-index: 2000; align-items: center; justify-content: center; }
    .modal-content { background: #fff; border-radius: 13px; padding: 1.3rem 1.2rem; max-width: 99vw; width: 370px; box-shadow: 0 0 22px rgba(0,0,0,0.13); position: relative; display: flex; flex-direction: column; }
    .modal-close { position: absolute; top: 11px; right: 13px; font-size: 1.4rem; color: var(--danger); background: none; border: none; cursor: pointer; z-index: 1; transition: color 0.2s;}
    .modal-close:hover { color: var(--primary-dark);}
    .modal-title { font-size: 1.19rem; font-weight: 600; color: var(--primary-dark); margin-bottom: 0.3rem; text-align: center;}
    .modal-img { width: 220px; height: 150px; object-fit: cover; border-radius: 9px; margin-bottom: 0.5rem; border: 1.5px solid #eee; background: #fff;}
    .modal-imgs { display: flex; align-items: center; gap: 10px; margin-bottom: 0.3rem; flex-wrap: wrap; justify-content: center;}
    .modal-imgs img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; border: 2px solid var(--primary-light); cursor: pointer; transition: box-shadow 0.15s; background: #fff;}
    .modal-imgs img.selected { box-shadow: 0 0 0 3px var(--primary-light); }
    .modal-slider-arrows { display: flex; gap: 8px; align-items: center; margin-bottom: 0.3rem; margin-top: 0.1rem;}
    .modal-slider-arrow { background: var(--primary-light); border: none; border-radius: 50%; width: 32px; height: 32px; font-size: 1.2rem; cursor: pointer; color: #fff; transition: background 0.18s;}
    .modal-slider-arrow:disabled { background: #ddd; color: #aaa; cursor: not-allowed;}
    .masampo-bid-block {margin: 0.7rem 0 0.2rem 0;}
    .masampo-bid-block input, .masampo-bid-block label {display:block;width:100%;font-size:1.06rem;margin-bottom:0.55rem;}
    .masampo-bid-block label {font-weight:500;}
    .masampo-bid-block .bid-actions {display:flex;gap:14px;justify-content:center;margin-top:0.4rem;}
    .bid-status {margin:0.4rem auto 0.1rem auto;text-align:center;font-size:1.02em;}
    .bid-status.success {color:var(--primary-dark);}
    .bid-status.error {color:var(--danger);}
    .bid-label {font-size:0.95em;color:var(--text-light);margin-bottom:8px;display:block;}
    .bid-dest-label {font-weight:600;font-size:0.99em;margin-bottom:3px;}
    footer {
      background: var(--footer-bg);
      color: var(--footer-text);
      text-align: center;
      padding: 1.5rem 1rem 1.7rem 1rem;
      border-radius: 18px 18px 0 0;
      font-size: 1.08rem;
      margin-top: 2.7rem;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.04);
    }
    footer a { color: var(--footer-link); text-decoration: underline; font-weight: 500;}
    footer .footer-brand { font-weight: bold; color: var(--footer-link);}
    @media (max-width: 800px) {
      .slider-track { gap: 0.8rem; }
      .slider-section, .taxi-card { max-width: 99vw; }
      .product, .vehicle-item { min-width: 140px; }
      .modal-content { width: 98vw;}
      .modal-img { width: 99vw; max-width: 240px;}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand-title">Zam<span class="highlight">Listing</span></div>
    <h2 class="tagline">Get your Service</h2>
    <p class="subtitle">Click on a service below to proceed</p>
  </header>
  <div class="container">
    <div class="filter-search-section">
      <div>
        <label for="categoryFilter">Show Section:</label>
        <select id="categoryFilter">
          <option value="all">All</option>
          <option value="taxi">Taxi Hire</option>
          <option value="masampo">Masampo</option>
          <option value="bistore">B-istore</option>
        </select>
        <input type="text" id="searchBox" placeholder="Search products, vehicles..." aria-label="Search products, vehicles">
      </div>
    </div>
    <!-- Taxi Hire Section -->
    <div class="slider-section" id="taxiSliderSection">
      <div class="slider-title"><i class="fa fa-taxi"></i> Taxi Hire</div>
      <button class="slider-btn prev" id="prevTaxiBtn" aria-label="Scroll left"><i class="fa fa-chevron-left"></i></button>
      <div class="slider-track" id="taxi-slider-track">
        <div class="taxi-card" id="taxiCard">
          <div class="taxi-emoji-animated">
            <span role="img" aria-label="vehicle">üöó</span>
            <span role="img" aria-label="motorbike">üèçÔ∏è</span>
          </div>
          <span class="taxi-card-title"><span role="img" aria-label="taxi">üöï</span> Book a Taxi</span>
          <span class="taxi-card-desc">Hire a vehicle or motorbike for your trip. Quick, safe, and affordable!</span>
        </div>
      </div>
      <button class="slider-btn next" id="nextTaxiBtn" aria-label="Scroll right"><i class="fa fa-chevron-right"></i></button>
    </div>
    <!-- Taxi Hire Modal -->
    <div class="modal" id="taxiHireModal">
      <div class="modal-content">
        <button class="modal-close" id="taxiHireModalClose" title="Close">&times;</button>
        <div class="modal-title">Taxi Hire Booking</div>
        <div style="font-size:2.5rem; margin-bottom:0.6rem;">
          <span>üöó</span>
          <span>üèçÔ∏è</span>
        </div>
        <div>
          <label for="taxiPhoneModal">Phone Number</label>
          <input type="tel" id="taxiPhoneModal" maxlength="10" placeholder="e.g. 0978167546" style="width:100%;margin-bottom:0.7rem;">
          <label>Transport Mode</label>
          <div class="taxi-radio-group">
            <label class="taxi-radio-label">
              <input type="radio" name="taxiHireMode" value="vehicle" checked>
              <span>Vehicle üöó</span>
            </label>
            <label class="taxi-radio-label">
              <input type="radio" name="taxiHireMode" value="motorbike">
              <span>Motorbike üèçÔ∏è</span>
            </label>
          </div>
          <label for="taxiHireFrom">From</label>
          <input list="placesList" id="taxiHireFrom" placeholder="Pickup location" style="width:100%;margin-bottom:0.7rem;">
          <label for="taxiHireTo">To</label>
          <input list="placesList" id="taxiHireTo" placeholder="Drop-off location" style="width:100%;margin-bottom:0.7rem;">
          <datalist id="placesList"></datalist>
        </div>
        <div class="taxi-hire-actions">
          <button class="taxi-hire-btn calc" id="taxiCalcBtn" title="Calculate Fare"><i class="fa fa-calculator"></i> Calculate</button>
          <button class="taxi-hire-btn sms" id="taxiSmsBtn" title="Send Booking SMS"><span class="fa fa-comment"></span> Send via SMS</button>
          <button class="taxi-hire-btn whatsapp" id="taxiWhatsappBtn" title="Send Booking WhatsApp"><span class="fa fa-whatsapp"></span> Send via WhatsApp</button>
          <button class="taxi-hire-btn map" id="taxiShowMapBtn" title="Show Map"><i class="fa fa-map"></i> Map</button>
          <button class="taxi-hire-btn hide" id="taxiHideMapBtn" title="Hide Map" style="display:none;"><i class="fa fa-eye-slash"></i> Hide</button>
        </div>
        <div class="taxi-hire-status" id="taxiHireStatus"></div>
        <div id="taxiHireMap" class="taxi-hire-map">
          <iframe id="taxiHireMapIframe"
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3859.06737814816!2d31.2323422143821!3d-13.147631245757161!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1947e2a8a3e25c0d%3A0xe3ee3a6f4a9c89a1!2sLuangwa!5e0!3m2!1sen!2szm!4v1692550000000!5m2!1sen!2szm"
            width="100%" height="150" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      </div>
    </div>
    <!-- Masampo Section -->
    <div class="slider-section" id="masampoSliderSection">
      <div class="slider-title"><i class="fa fa-car"></i> Masampo</div>
      <button class="slider-btn prev" id="prevMasampoBtn" aria-label="Scroll left"><i class="fa fa-chevron-left"></i></button>
      <div class="slider-track" id="masampo-slider-track"></div>
      <button class="slider-btn next" id="nextMasampoBtn" aria-label="Scroll right"><i class="fa fa-chevron-right"></i></button>
    </div>
    <!-- B-istore Section -->
    <div class="slider-section" id="bistoreSliderSection">
      <div class="slider-title"><i class="fa fa-building"></i> B-istore</div>
      <button class="slider-btn prev" id="prevBistoreBtn" aria-label="Scroll left"><i class="fa fa-chevron-left"></i></button>
      <div class="slider-track" id="bistore-slider-track"></div>
      <button class="slider-btn next" id="nextBistoreBtn" aria-label="Scroll right"><i class="fa fa-chevron-right"></i></button>
    </div>
    <!-- Cart System -->
    <div class="cart" aria-label="Your Cart">
      <h2 class="section-title"><i class="fa fa-shopping-cart"></i> Your Order</h2>
      <ul id="cart-items" class="cart-items"></ul>
      <div id="empty-cart" class="empty-cart" aria-live="polite">
        <i class="fa fa-cart-arrow-down"></i>
        <p>Your cart is empty.</p>
        <p>Add items to get started.</p>
      </div>
      <div id="cart-total" class="cart-total" style="display:none;">
        <p>Products Total: ZK <span id="products-total">0.00</span></p>
        <p><strong>Total: ZK <span id="grand-total">0.00</span></strong></p>
      </div>
      <div class="checkout-actions" id="checkoutActions" style="display:none;">
        <button class="checkout-btn-sms" id="checkout-btn-sms" title="Send Order SMS">
          <span class="fa fa-comment"></span> Send via SMS
        </button>
        <button class="checkout-btn-whatsapp" id="checkout-btn-whatsapp" title="Send Order WhatsApp">
          <span class="fa fa-whatsapp"></span> Send via WhatsApp
        </button>
      </div>
      <div id="statusMessage" class="status-message"></div>
    </div>
    <!-- Masampo Details Modal -->
    <div class="modal" id="detailsModal">
      <div class="modal-content" id="detailsModalContent">
        <button class="modal-close" id="detailsModalClose">&times;</button>
        <div class="modal-title" id="detailsModalTitle"></div>
        <div class="modal-imgs" id="detailsModalImgs"></div>
        <div class="modal-slider-arrows" id="detailsModalArrows" style="display:none;">
          <button class="modal-slider-arrow" id="detailsModalPrevImg">&lt;</button>
          <button class="modal-slider-arrow" id="detailsModalNextImg">&gt;</button>
        </div>
        <img id="detailsModalImg" class="modal-img" src="" alt="Item Image">
        <div class="modal-details" id="detailsModalDetails"></div>
        <!-- Bid block for Masampo modal -->
        <div id="masampoBidBlock" class="masampo-bid-block" style="display:none;">
          <span class="bid-label">Bid/Order will be sent to:</span>
          <span class="bid-dest-label" id="masampoBidDestLabel"></span>
          <label for="masampoBidValue">Your Bid Value (ZK):</label>
          <input type="number" min="1" id="masampoBidValue" placeholder="Enter bid value">
          <label for="masampoBidPhone">Your Phone Number:</label>
          <input type="tel" id="masampoBidPhone" maxlength="10" placeholder="e.g. 0978000000">
          <div class="bid-actions">
            <button class="bid-btn sms" id="masampoBidSms" title="Send Bid SMS">
              <span class="fa fa-comment"></span> Send via SMS
            </button>
            <button class="bid-btn whatsapp" id="masampoBidWhatsapp" title="Send Bid WhatsApp">
              <span class="fa fa-whatsapp"></span> Send via WhatsApp
            </button>
          </div>
          <div class="bid-status" id="masampoBidStatus"></div>
        </div>
      </div>
    </div>
  </div>
  <footer>
    <div class="footer-brand">ZamListing</div>
    <div>
      &copy; 2025 ZamListing &middot; Powered by <a href="https://github.com/">GitHub</a>
    </div>
    <div>
      <span>Contact: <a href="mailto:support@zamlisting.com">support@zamlisting.com</a></span>
    </div>
  </footer>
  <script>
    // Luangwa places and distances (in km, symmetric)
    const LUANGWA_PLACES = [
      "Market", "Hospital", "Police", "Bus Station", "School", "Clinic", "Bridge", "Post Office"
    ];
    const LUANGWA_DISTANCES = {
      "Market|Hospital": 3,
      "Market|Police": 2.5,
      "Hospital|Bus Station": 1.5,
      "School|Clinic": 2.2,
      "Police|Bus Station": 2.8,
      "Market|Bus Station": 3,
      "Market|School": 2.7,
      "Post Office|Bridge": 3,
      "Clinic|Bridge": 1.2,
      "Market|Clinic": 2.6,
    };
    function findLuangwaDistance(from, to) {
      if (!from || !to || from === to) return 0;
      let key = from + "|" + to;
      let revKey = to + "|" + from;
      return LUANGWA_DISTANCES[key] ?? LUANGWA_DISTANCES[revKey] ?? null;
    }
    // Populate datalist for autocomplete
    const placesList = document.getElementById('placesList');
    LUANGWA_PLACES.forEach(place => {
      const opt = document.createElement('option');
      opt.value = place;
      placesList.appendChild(opt);
    });

    // Taxi hire modal logic
    const taxiCard = document.getElementById('taxiCard');
    const taxiHireModal = document.getElementById('taxiHireModal');
    const taxiHireModalClose = document.getElementById('taxiHireModalClose');
    const taxiCalcBtn = document.getElementById('taxiCalcBtn');
    const taxiSmsBtn = document.getElementById('taxiSmsBtn');
    const taxiWhatsappBtn = document.getElementById('taxiWhatsappBtn');
    const taxiShowMapBtn = document.getElementById('taxiShowMapBtn');
    const taxiHideMapBtn = document.getElementById('taxiHideMapBtn');
    const taxiHireMap = document.getElementById('taxiHireMap');
    const taxiHireStatus = document.getElementById('taxiHireStatus');
    taxiCard.onclick = () => {
      taxiHireModal.style.display = "flex";
      taxiHireMap.classList.remove("show");
      taxiShowMapBtn.style.display="";
      taxiHideMapBtn.style.display="none";
      taxiHireStatus.textContent = '';
      document.getElementById('taxiPhoneModal').value = '';
      document.getElementById('taxiHireFrom').value = '';
      document.getElementById('taxiHireTo').value = '';
      document.querySelector('input[name="taxiHireMode"][value="vehicle"]').checked = true;
    };
    taxiHireModalClose.onclick = () => { taxiHireModal.style.display = "none"; };
    window.addEventListener('keydown', function(e) {
      if (e.key === "Escape" && taxiHireModal.style.display === "flex") {
        taxiHireModal.style.display = "none";
      }
    });
    taxiHireModal.addEventListener('mousedown', function(e) {
      if (e.target === taxiHireModal) taxiHireModal.style.display = "none";
    });
    taxiShowMapBtn.onclick = () => {
      taxiHireMap.classList.add("show");
      taxiShowMapBtn.style.display = "none";
      taxiHideMapBtn.style.display = "";
    };
    taxiHideMapBtn.onclick = () => {
      taxiHireMap.classList.remove("show");
      taxiShowMapBtn.style.display = "";
      taxiHideMapBtn.style.display = "none";
    };
    function getSelectedTaxiMode() {
      const radios = document.getElementsByName('taxiHireMode');
      for (let radio of radios) if (radio.checked) return radio.value;
      return "vehicle";
    }
    taxiCalcBtn.onclick = () => {
      const from = document.getElementById('taxiHireFrom').value.trim();
      const to = document.getElementById('taxiHireTo').value.trim();
      const mode = getSelectedTaxiMode();
      if (!from || !to) {
        taxiHireStatus.textContent = "Please enter both pickup and drop-off locations.";
        taxiHireStatus.className = "taxi-hire-status error";
        return;
      }
      let dist = findLuangwaDistance(from, to);
      if (dist === null) {
        taxiHireStatus.textContent = "No known route between selected places.";
        taxiHireStatus.className = "taxi-hire-status error";
        return;
      }
      let cost = mode === "motorbike" ? Math.ceil(dist / 3) * 10 : Math.ceil(dist / 3) * 20;
      taxiHireStatus.textContent = `Distance: ${dist} km. Fare: ZK ${cost} (${mode === 'vehicle' ? 'Vehicle' : 'Motorbike'})`;
      taxiHireStatus.className = "taxi-hire-status success";
    };
    taxiSmsBtn.onclick = () => {
      const phone = document.getElementById('taxiPhoneModal').value.trim();
      const mode = getSelectedTaxiMode();
      const from = document.getElementById('taxiHireFrom').value.trim();
      const to = document.getElementById('taxiHireTo').value.trim();
      let dist = findLuangwaDistance(from, to);
      let cost = (dist === null) ? "N/A" : (mode === "motorbike" ? Math.ceil(dist / 3) * 10 : Math.ceil(dist / 3) * 20);
      const msg = `Taxi Booking:\nMode: ${mode}\nFrom: ${from}\nTo: ${to}\nCustomer: ${phone}\nDistance: ${dist ?? "N/A"} km\nFare: ZK ${cost}`;
      window.open(`sms:+260978167546?body=${encodeURIComponent(msg)}`, "_blank");
      taxiHireStatus.textContent = "Booking sent via SMS!";
      taxiHireStatus.className = "taxi-hire-status success";
    };
    taxiWhatsappBtn.onclick = () => {
      const phone = document.getElementById('taxiPhoneModal').value.trim();
      const mode = getSelectedTaxiMode();
      const from = document.getElementById('taxiHireFrom').value.trim();
      const to = document.getElementById('taxiHireTo').value.trim();
      let dist = findLuangwaDistance(from, to);
      let cost = (dist === null) ? "N/A" : (mode === "motorbike" ? Math.ceil(dist / 3) * 10 : Math.ceil(dist / 3) * 20);
      const msg = `Taxi Booking:\nMode: ${mode}\nFrom: ${from}\nTo: ${to}\nCustomer: ${phone}\nDistance: ${dist ?? "N/A"} km\nFare: ZK ${cost}`;
      window.open(`https://wa.me/+260978167546?text=${encodeURIComponent(msg)}`, "_blank");
      taxiHireStatus.textContent = "Booking sent via WhatsApp!";
      taxiHireStatus.className = "taxi-hire-status success";
    };

    // --- Sections and cart logic ---
    // Demo data for Masampo and B-istore
    const MASAMPO_VEHICLES = [
      {
        id: 1011,
        name: "Vitz Ndola",
        price: 90000,
        location: "Ndola",
        image: "V1.jpg",
        category: "vehicle",
        details: { condition: "For Hire", contact: "0978123456" },
        additionalImages: ["V1.jpg", "V2.jpg", "V3.jpg", "V4.jpg", "V5.jpg", "V6.jpg"],
        listedDate: "2025-08-12"
      },
      {
        id: 1012,
        name: "Laptop Lusaka",
        price: 1200,
        location: "Lusaka",
        image: "L1.jpeg",
        category: "laptop",
        details: { condition: "11.6-inch, 4 GB RAM", contact: "0978234567" },
        additionalImages: ["L1.jpeg", "L2.jpeg", "L3.jpeg"],
        listedDate: "2025-08-12"
      },
      {
        id: 1013,
        name: "Samsung S24",
        price: 26000,
        location: "Lusaka",
        image: "S241.webp",
        category: "phone",
        details: { condition: "For Sale - Negotiable", contact: "0978000003" },
        additionalImages: ["S241.webp", "S242.webp"],
        listedDate: "2025-08-12"
      }
    ];
    const BISTORE_PRODUCTS = [
      { id: 1, name: "Mosi Beer", price: 25, image: "M.jpeg", category: "beverages" },
      { id: 100, name: "Calculator Casio GX-14", price: 230, image: "GX.jpg", category: "stationary" }
    ];
    let sectionMap = {
      "taxi": document.getElementById("taxiSliderSection"),
      "masampo": document.getElementById("masampoSliderSection"),
      "bistore": document.getElementById("bistoreSliderSection"),
      "all": null
    };
    document.getElementById("categoryFilter").addEventListener("change", function() {
      let val = this.value;
      Object.entries(sectionMap).forEach(([key, sec]) => {
        if (sec) sec.hidden = (val !== "all" && val !== key);
      });
    });
    let filteredMasampo = MASAMPO_VEHICLES.slice();
    let filteredBistore = BISTORE_PRODUCTS.slice();
    function updateAllFilters() {
      const query = searchBox.value.trim().toLowerCase();
      filteredMasampo = MASAMPO_VEHICLES.filter(v => {
        const matchQuery = v.name.toLowerCase().includes(query) || (v.category && v.category.toLowerCase().includes(query)) || (v.location && v.location.toLowerCase().includes(query));
        return matchQuery;
      });
      filteredBistore = BISTORE_PRODUCTS.filter(p => {
        const matchQuery = p.name.toLowerCase().includes(query) || (p.category && p.category.toLowerCase().includes(query));
        return matchQuery;
      });
      renderMasampo();
      renderBistore();
    }
    const searchBox = document.getElementById('searchBox');
    searchBox.addEventListener('input', updateAllFilters);

    function setupSliderButtons(trackId, prevBtnId, nextBtnId) {
      const sliderTrack = document.getElementById(trackId);
      document.getElementById(prevBtnId).onclick = () => {
        sliderTrack.scrollBy({ left: -180, behavior: 'smooth' });
      };
      document.getElementById(nextBtnId).onclick = () => {
        sliderTrack.scrollBy({ left: 180, behavior: 'smooth' });
      };
    }
    setupSliderButtons('taxi-slider-track', 'prevTaxiBtn', 'nextTaxiBtn');
    setupSliderButtons('masampo-slider-track', 'prevMasampoBtn', 'nextMasampoBtn');
    setupSliderButtons('bistore-slider-track', 'prevBistoreBtn', 'nextBistoreBtn');

    function renderMasampo() {
      const masampoSliderTrack = document.getElementById('masampo-slider-track');
      masampoSliderTrack.innerHTML = '';
      filteredMasampo.forEach(item => {
        const div = document.createElement('div');
        div.className = 'vehicle-item';
        div.tabIndex = 0;
        div.innerHTML = `
          <img src="${item.image}" alt="${item.name}" loading="lazy" onerror="this.src='https://via.placeholder.com/120x82?text=Error';">
          <h4>${item.name}</h4>
          <p>ZK ${item.price.toLocaleString()}</p>
          <p class="location">${item.location}</p>
          <button class="bid-btn" onclick="event.stopPropagation();showDetailsModal('${item.id}');"><i class="fa fa-eye"></i> View</button>
        `;
        div.onclick = () => showDetailsModal(item.id);
        masampoSliderTrack.appendChild(div);
      });
    }
    function renderBistore() {
      const bistoreSliderTrack = document.getElementById('bistore-slider-track');
      bistoreSliderTrack.innerHTML = '';
      filteredBistore.forEach(p => {
        const div = document.createElement('div');
        div.className = 'product';
        div.tabIndex = 0;
        let outStock = (p.price <= 0);
        div.innerHTML = `
          <img src="${p.image}" alt="${p.name}" loading="lazy" onerror="this.src='https://via.placeholder.com/120x82?text=Error';">
          <h4>${p.name}</h4>
          <p>ZK ${p.price.toFixed(2)}</p>
          ${outStock ? '<span class="out-stock">Out of Stock</span>' : ''}
          <button class="bid-btn" onclick="event.stopPropagation();addToCart('${p.id}');"><i class="fa fa-plus"></i> Add</button>
        `;
        bistoreSliderTrack.appendChild(div);
      });
    }
    document.addEventListener('DOMContentLoaded', () => {
      renderMasampo();
      renderBistore();
      updateCart();
    });

    function getMasampoItemById(id) {
      return MASAMPO_VEHICLES.find(item => String(item.id) === String(id));
    }

    // Cart logic
    let cart = [];
    const cartItemsEl = document.getElementById('cart-items');
    const emptyCartEl = document.getElementById('empty-cart');
    const cartTotalEl = document.getElementById('cart-total');
    const productsTotalEl = document.getElementById('products-total');
    const grandTotalEl = document.getElementById('grand-total');
    const checkoutBtnSms = document.getElementById('checkout-btn-sms');
    const checkoutBtnWhatsapp = document.getElementById('checkout-btn-whatsapp');
    const checkoutActions = document.getElementById('checkoutActions');
    function updateCart() {
      if (cart.length === 0) {
        cartItemsEl.innerHTML = '';
        emptyCartEl.style.display = 'block';
        cartTotalEl.style.display = 'none';
        checkoutActions.style.display = 'none';
      } else {
        emptyCartEl.style.display = 'none';
        cartTotalEl.style.display = 'block';
        checkoutActions.style.display = 'flex';
        cartItemsEl.innerHTML = '';
        cart.forEach((item, index) => {
          const li = document.createElement('li');
          li.innerHTML = `
            <div class="cart-item-info">
              <img src="${item.item.image}" alt="${item.item.name}" class="cart-thumb" loading="lazy" onerror="this.src='https://via.placeholder.com/36?text=Err';">
              <span class="cart-item-title">${item.item.name}</span>
            </div>
            <div class="cart-price-block">
              <span style="min-width:60px;">ZK ${(item.item.price * item.quantity).toFixed(2)}</span>
              <div class="quantity-controls">
                <button class="quantity-btn decrease" data-index="${index}">-</button>
                <input type="number" min="1" class="cart-item-qty" data-index="${index}" value="${item.quantity}">
                <button class="quantity-btn increase" data-index="${index}">+</button>
                <button class="remove-btn" data-index="${index}"><i class="fa fa-times"></i></button>
              </div>
            </div>
          `;
          cartItemsEl.appendChild(li);
        });
        const productsTotal = cart.reduce((sum, item) => sum + item.item.price * item.quantity, 0);
        productsTotalEl.textContent = productsTotal.toFixed(2);
        grandTotalEl.textContent = productsTotal.toFixed(2);
      }
    }
    function addToCart(id) {
      const item = BISTORE_PRODUCTS.find(p => String(p.id) === String(id));
      if (item) {
        const cartItem = cart.find(cartItem => cartItem.item.id === item.id);
        if (cartItem) { cartItem.quantity += 1; }
        else { cart.push({ item: item, quantity: 1 }); }
        updateCart();
      }
    }
    cartItemsEl.addEventListener('click', e => {
      const button = e.target.closest('button');
      if (!button) return;
      const index = parseInt(button.dataset.index, 10);
      if (button.classList.contains('remove-btn')) {
        cart.splice(index, 1);
        updateCart();
      } else if (button.classList.contains('increase')) {
        cart[index].quantity += 1;
        updateCart();
      } else if (button.classList.contains('decrease')) {
        cart[index].quantity -= 1;
        if (cart[index].quantity === 0) {
          cart.splice(index, 1);
        }
        updateCart();
      }
    });
    cartItemsEl.addEventListener('change', e => {
      const input = e.target;
      if (input.classList.contains('cart-item-qty')) {
        let idx = parseInt(input.dataset.index, 10);
        let qty = parseInt(input.value, 10);
        if (!isNaN(qty) && qty >= 1) {
          cart[idx].quantity = qty;
          updateCart();
        } else {
          input.value = cart[idx].quantity;
        }
      }
    });
    checkoutBtnSms.onclick = () => {
      if (cart.length === 0) {
        alert('Your cart is empty.');
        return;
      }
      const msg = cart.map(item => `${item.item.name} x${item.quantity} = ZK ${(item.item.price * item.quantity).toFixed(2)}`).join('\n');
      window.open(`sms:+260978167546?body=${encodeURIComponent("Order:\n"+msg)}`, "_blank");
    };
    checkoutBtnWhatsapp.onclick = () => {
      if (cart.length === 0) {
        alert('Your cart is empty.');
        return;
      }
      const msg = cart.map(item => `${item.item.name} x${item.quantity} = ZK ${(item.item.price * item.quantity).toFixed(2)}`).join('\n');
      window.open(`https://wa.me/+260978167546?text=${encodeURIComponent("Order:\n"+msg)}`, "_blank");
    };

    // Masampo Details Modal logic
    const detailsModal = document.getElementById('detailsModal');
    const detailsModalClose = document.getElementById('detailsModalClose');
    const detailsModalTitle = document.getElementById('detailsModalTitle');
    const detailsModalImg = document.getElementById('detailsModalImg');
    const detailsModalDetails = document.getElementById('detailsModalDetails');
    const detailsModalImgs = document.getElementById('detailsModalImgs');
    const detailsModalArrows = document.getElementById('detailsModalArrows');
    const detailsModalPrevImg = document.getElementById('detailsModalPrevImg');
    const detailsModalNextImg = document.getElementById('detailsModalNextImg');
    const masampoBidBlock = document.getElementById('masampoBidBlock');
    const masampoBidDestLabel = document.getElementById('masampoBidDestLabel');
    const masampoBidValue = document.getElementById('masampoBidValue');
    const masampoBidPhone = document.getElementById('masampoBidPhone');
    const masampoBidSms = document.getElementById('masampoBidSms');
    const masampoBidWhatsapp = document.getElementById('masampoBidWhatsapp');
    const masampoBidStatus = document.getElementById('masampoBidStatus');
    let currentDetailsImages = [];
    let currentDetailsIndex = 0;
    let currentMasampoItem = null;

    window.showDetailsModal = function(id) {
      const item = getMasampoItemById(id);
      if (!item) return;
      detailsModalTitle.textContent = item.name;
      let imgList = Array.isArray(item.additionalImages) && item.additionalImages.length
        ? item.additionalImages.filter(Boolean)
        : [item.image];
      while (imgList.length < 6) imgList.push(item.image);
      currentDetailsImages = imgList;
      currentDetailsIndex = 0;
      detailsModalImg.src = imgList[0] || '';
      detailsModalImgs.innerHTML = '';
      imgList.forEach((img, idx) => {
        const thumb = document.createElement('img');
        thumb.src = img;
        thumb.className = idx === 0 ? 'selected' : '';
        thumb.onclick = () => { selectDetailsImage(idx); };
        detailsModalImgs.appendChild(thumb);
      });
      detailsModalArrows.style.display = imgList.length > 1 ? '' : 'none';
      detailsModalPrevImg.disabled = currentDetailsIndex === 0;
      detailsModalNextImg.disabled = currentDetailsIndex === imgList.length - 1;
      let html = `<div><b>Price:</b> ZK ${item.price.toLocaleString()}</div>`;
      html += `<div><b>Location:</b> ${item.location}</div>`;
      html += `<div><b>Condition:</b> ${item.details?.condition || ''}</div>`;
      html += `<div><b>Contact:</b> ${item.details?.contact || ''}</div>`;
      html += `<div><b>Listed Since:</b> ${item.listedDate || ''}</div>`;
      masampoBidBlock.style.display = '';
      masampoBidValue.value = '';
      masampoBidPhone.value = '';
      masampoBidStatus.textContent = '';
      currentMasampoItem = item;
      masampoBidDestLabel.textContent = `${getOwnerPhone(item)} (Owner)`;
      detailsModalDetails.innerHTML = html;
      detailsModal.style.display = "flex";
    }
    function selectDetailsImage(idx) {
      currentDetailsIndex = idx;
      detailsModalImg.src = currentDetailsImages[idx];
      Array.from(detailsModalImgs.children).forEach((img, i) => {
        img.className = i === idx ? 'selected' : '';
      });
      detailsModalPrevImg.disabled = currentDetailsIndex === 0;
      detailsModalNextImg.disabled = currentDetailsIndex === currentDetailsImages.length - 1;
    }
    detailsModalPrevImg.onclick = () => {
      if (currentDetailsIndex > 0) selectDetailsImage(currentDetailsIndex - 1);
    };
    detailsModalNextImg.onclick = () => {
      if (currentDetailsIndex < currentDetailsImages.length - 1) selectDetailsImage(currentDetailsIndex + 1);
    };
    detailsModalClose.onclick = () => { detailsModal.style.display = "none"; };
    window.addEventListener('keydown', function(e) {
      if (e.key === "Escape" && detailsModal.style.display === "flex") {
        detailsModal.style.display = "none";
      }
    });
    detailsModal.addEventListener('mousedown', function(e) {
      if (e.target === detailsModal) detailsModal.style.display = "none";
    });

    function validateBidFields() {
      let bid = parseInt(masampoBidValue.value, 10);
      let phone = masampoBidPhone.value.trim();
      if (isNaN(bid) || bid < 1) {
        masampoBidStatus.textContent = "Please enter a valid bid value.";
        masampoBidStatus.className = "bid-status error";
        return false;
      }
      if (!/^0[0-9]{9}$/.test(phone)) {
        masampoBidStatus.textContent = "Please enter a valid phone number (e.g. 0978000000).";
        masampoBidStatus.className = "bid-status error";
        return false;
      }
      return true;
    }
    function getOwnerPhone(item) {
      let phone = (item.details && item.details.contact) ? item.details.contact : "";
      if (!/^0[0-9]{9}$/.test(phone)) return "0978167546";
      return phone;
    }
    masampoBidSms.onclick = () => {
      if (!currentMasampoItem) return;
      if (!validateBidFields()) return;
      let bid = masampoBidValue.value.trim();
      let phone = masampoBidPhone.value.trim();
      let ownerPhone = getOwnerPhone(currentMasampoItem);
      const msg = `Bid/Order for ${currentMasampoItem.name}: ZK ${bid}\nYour Phone: ${phone}`;
      window.open(`sms:+260${ownerPhone.replace(/^0/, '')}?body=${encodeURIComponent(msg)}`, "_blank");
      masampoBidStatus.textContent = "Bid/Order sent via SMS!";
      masampoBidStatus.className = "bid-status success";
    };
    masampoBidWhatsapp.onclick = () => {
      if (!currentMasampoItem) return;
      if (!validateBidFields()) return;
      let bid = masampoBidValue.value.trim();
      let phone = masampoBidPhone.value.trim();
      let ownerPhone = getOwnerPhone(currentMasampoItem);
      const msg = `Bid/Order for ${currentMasampoItem.name}: ZK ${bid}\nYour Phone: ${phone}`;
      window.open(`https://wa.me/+260${ownerPhone.replace(/^0/, '')}?text=${encodeURIComponent(msg)}`, "_blank");
      masampoBidStatus.textContent = "Bid/Order sent via WhatsApp!";
      masampoBidStatus.className = "bid-status success";
    };
  </script>
</body>
</html>
