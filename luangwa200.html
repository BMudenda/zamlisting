<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luangwa Feira Rides | Book a Ride</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary-color: #2563eb;
      --secondary-color: #ff9900;
      --error-color: #dc2626;
      --success-color: #16a34a;
      --bg-color-body: #f5f5f5;
      --bg-color-card: #ffffff;
      --border-color-light: #e0e0e0;
      --font-color-dark: #333;
    }
    body { font-family: 'Roboto', Arial, sans-serif; background-color: var(--bg-color-body); color: var(--font-color-dark); overflow-x: hidden; }

    header { background: var(--font-color-dark); color: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .header-content { max-width: 1200px; margin: auto; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; }
    .company-info h2 { font-size: 1.1rem; color: var(--secondary-color); }

    .product-container { max-width: 500px; margin: 15px auto; padding: 0 10px; }
    .booking-container { background: var(--bg-color-card); border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 15px; }
    
    fieldset { border: 1px solid var(--border-color-light); border-radius: 10px; padding: 12px; background: #fafafa; margin-bottom: 15px; width: 100%; transition: 0.3s; }
    legend { font-weight: bold; color: var(--primary-color); padding: 0 8px; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; }
    
    .input-box { background: white; border: 1.5px solid var(--border-color-light); border-radius: 8px; padding: 8px 10px; transition: 0.3s; position: relative; display: flex; align-items: center; width: 100%; }
    .input-box .material-icons { color: var(--primary-color); font-size: 20px; margin-right: 10px; }
    .input-box input { flex: 1; border: none; outline: none; font-size: 1rem; font-weight: bold; background: transparent; width: 100%; }
    
    ::placeholder { font-size: 0.8rem; font-style: italic; color: #aaa; }

    /* Horizontal Mode Layout */
    .mode-option { display: flex; align-items: center; gap: 8px; cursor: pointer; }
    .mode-option .material-icons { font-size: 24px; color: var(--primary-color); }

    .field-error { border: 2px solid var(--error-color) !important; background: #fff5f5 !important; animation: shake 0.4s ease-in-out; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-4px); } 75% { transform: translateX(4px); } }

    .autocomplete-list { position: absolute; top: 100%; left: 0; width: 100%; background: white; border: 1px solid #ddd; z-index: 100; max-height: 150px; overflow-y: auto; border-radius: 0 0 8px 8px; }
    .suggestion { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; font-size: 0.9rem; }

    .summary-card { background: white; border: 1px solid var(--border-color-light); border-radius: 8px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
    .submit-btn { background: var(--primary-color); color: white; width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; border: none; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: 0.3s; }
    
    .hidden-section { display: none; }
    .loader { width: 25px; height: 25px; border: 3px solid #f3f3f3; border-top: 3px solid var(--secondary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 10px auto; display: none; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .tooltip-container { position: relative; display: inline-flex; align-items: center; cursor: pointer; margin-left: 4px; }
    .tooltip-icon { font-size: 18px !important; color: var(--primary-color); }
    .tooltip-text { visibility: hidden; width: 180px; background-color: #333; color: #fff; text-align: center; border-radius: 6px; padding: 8px; position: absolute; z-index: 999; bottom: 125%; left: 50%; margin-left: -90px; opacity: 0; transition: opacity 0.3s; font-size: 0.75rem; font-weight: normal; }
    .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; }
  </style>
</head>
<body>

  <header>
    <div class="header-content">
      <div class="company-info"><h2>Luangwa Feira Rides</h2></div>
    </div>
  </header>

  <main class="product-container">
    <div class="booking-container">
      
      <fieldset>
        <legend><span class="material-icons">account_circle</span> Phone Number</legend>
        <div class="input-box" id="phone-box">
          <span class="material-icons">phone</span>
          <input type="tel" id="customer-phone" maxlength="10" placeholder="0xxxxxxxxx" inputmode="numeric">
        </div>
      </fieldset>

      <div id="trip-details" class="hidden-section">
        <fieldset id="mode-fieldset">
          <legend><span class="material-icons">commute</span> Transport Mode</legend>
          <div id="mode-group" style="display:flex; justify-content:space-around; padding:10px 0;">
            <label class="mode-option">
              <input type="radio" name="mode" value="motorbike">
              <span class="material-icons">motorcycle</span>
              <small>Motorbike</small>
            </label>
            <label class="mode-option">
              <input type="radio" name="mode" value="vehicle">
              <span class="material-icons">directions_car</span>
              <small>Vehicle</small>
            </label>
          </div>
        </fieldset>

        <fieldset id="route-fieldset">
          <legend>Route</legend>
          <div class="input-box" id="origin-container" style="margin-bottom:12px;">
            <span class="material-icons">my_location</span>
            <input type="text" id="gm-origin" placeholder="type and select your pick" autocomplete="off">
            <div id="originList" class="autocomplete-list"></div>
          </div>
          <div class="input-box" id="dest-container">
            <span class="material-icons">pin_drop</span>
            <input type="text" id="gm-destination" placeholder="type and select destination" autocomplete="off">
            <div id="destinationList" class="autocomplete-list"></div>
          </div>
        </fieldset>
      </div>

      <div id="summary-section" class="hidden-section">
        <fieldset>
          <legend><span class="material-icons">receipt_long</span> Trip Summary</legend>
          <div id="summary-cards"></div>
        </fieldset>
        <div style="display:flex; flex-direction:column; align-items:center;">
          <button class="fas fa-paper-plane submit-btn" id="submit-btn"></button>
          <p id="action-label" style="margin-top:6px; font-weight:bold; color:var(--primary-color);">Request Now</p>
        </div>
      </div>

      <div class="loader" id="spinner"></div>
      <p id="status" style="text-align:center; margin-top:8px; font-weight:bold; min-height:1.2em;"></p>
    </div>
  </main>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxpvhvgnjkRcZmuly7uNzPeAC5OwVUq8-qUJ2WXrOqOnSsNgCn0ZHbuz6BGslW83_rB5Q/exec";
    const places = ["Anglican Church","Airstrip","Big 2 Zambezi Water Front Resort & Safari","BM Residence","Boma Clinic","Chidada Ground","Car Wash Pub","Chitope","Chitope Rural Health Centre","Chilombwe Community School","Chiriwe Primary School","Dzalo Skills Training Centre Kambolozo","Feira Kindom Hall","Feira Day Secondary School","Gerasmos Safari Lodge","Hill View","JB Three Boarders Mall","JB Three Boarders Club","Justifeli Lodge","Kakaro Primary School","Kakaro Liberation Heritage Site","Kantuleni Executive Lodge","Kapoche","Kaunga Secondary School","Kasinsa","Katondwe Chapel","Katondwe Chaz Hotel","Katondwe Dam","Katondwe Girls Secondary School","Katondwe Mission Hospital","Katondwe Primary School","Kavalamanja","Luangwa (Feira)","Luangwa Basic School","Luangwa Bridge","Luangwa Bridge Market","Luangwa Bus Station","Luangwa Council Lodge","Luangwa DC Office","Luangwa DEBS Offices","Luangwa District Hospital","Luangwa High School Police Post","Boma Filling Station","Luangwa Habour","Indeco Building","Luangwa Market","Luangwa Main SDA Church","Mburuma Local Court","Luangwa Police Station","Luangwa Post Office","Luangwa Town Council","Luangwa Secondary School","Makichilo Lodge","Mwavi Secondary School","Mwalila Primary School","Nyabota Lodge","Passover Living Lamb Ministry Katondwe","Pentecostal Assembly of God Joshua Assembly","UCZ","Soweto Junction","Registration Office","River Spot Club","SDA Katondwe","Yangoma Lodge","Yellow Shop","ZESCO Office"];
    
    let rideData = null;

    function getHub(location) {
        const l = location.toLowerCase();
        if (l.includes("katondwe")) return "Katondwe";
        if (l.includes("bridge")) return "Luangwa Bridge";
        if (l.includes("boma")) return "Boma";
        return "Main Market";
    }

    const phoneInput = document.getElementById('customer-phone');
    const tripDiv = document.getElementById('trip-details');
    const summaryDiv = document.getElementById('summary-section');
    const statusText = document.getElementById('status');
    const submitBtn = document.getElementById('submit-btn');

    phoneInput.oninput = () => { 
      if (/^0[0-9]{9}$/.test(phoneInput.value)) {
        tripDiv.style.display = 'block';
      }
    };

    function setupAuto(inputId, containerId, listId) {
      const input = document.getElementById(inputId);
      const container = document.getElementById(containerId);
      const list = document.getElementById(listId);

      input.oninput = () => {
        const val = input.value.toLowerCase();
        list.innerHTML = '';
        container.classList.remove('field-error'); 
        if (!val) return;

        const matches = places.filter(p => p.toLowerCase().includes(val));
        matches.forEach(p => {
          const d = document.createElement('div');
          d.className = 'suggestion';
          d.textContent = p;
          d.onclick = () => {
            input.value = p;
            list.innerHTML = '';
            container.classList.remove('field-error');
            checkReady();
          };
          list.appendChild(d);
        });
      };

      input.onblur = () => {
        setTimeout(() => {
          if (input.value && !places.includes(input.value)) {
            container.classList.add('field-error');
            statusText.textContent = "⚠️ Invalid location. Select from list.";
            statusText.style.color = "var(--error-color)";
            summaryDiv.style.display = 'none';
          }
        }, 200);
      };
    }

    function checkReady() {
      const from = document.getElementById('gm-origin').value;
      const to = document.getElementById('gm-destination').value;
      const mode = document.querySelector('input[name="mode"]:checked');

      if (places.includes(from) && places.includes(to)) {
        if (!mode) {
          statusText.textContent = "Select Transport Mode (Bike/Car).";
          statusText.style.color = "var(--secondary-color)";
        } else {
          statusText.textContent = "";
          calculate(from, to, mode.value);
        }
      }
    }

    function calculate(from, to, mode) {
      document.getElementById('spinner').style.display = 'block';
      summaryDiv.style.display = 'none';
      setTimeout(() => {
        document.getElementById('spinner').style.display = 'none';
        summaryDiv.style.display = 'block';
        
        const hub = getHub(from);
        const price = mode === 'vehicle' ? 35 : 15;
        const dist = (Math.random() * 4 + 1.5).toFixed(1); 

        document.getElementById('summary-cards').innerHTML = `
          <div class="summary-card">
            <span>Price</span>
            <span style="color:var(--secondary-color); font-weight:bold;">K${price}</span>
          </div>
          <div class="summary-card">
            <span>Trip Distance
              <div class="tooltip-container">
                <span class="material-icons tooltip-icon">info</span>
                <span class="tooltip-text">Price calculated via <b>${hub}</b> hub for accuracy.</span>
              </div>
            </span>
            <span>${dist} km</span>
          </div>`;
        rideData = { phone: phoneInput.value, from, to, price, mode, distance: dist, hub: hub };
      }, 600);
    }

    submitBtn.onclick = async () => {
      if (!rideData) return;
      statusText.textContent = "Sending request...";
      submitBtn.disabled = true;
      try {
        await fetch(SCRIPT_URL, { method: 'POST', body: new URLSearchParams({...rideData}) });
        statusText.textContent = "Sent! Tap phone to call dispatcher.";
        statusText.style.color = "var(--success-color)";
        submitBtn.className = "fas fa-phone submit-btn";
        submitBtn.style.background = "var(--success-color)";
        submitBtn.disabled = false;
        document.getElementById('action-label').textContent = "Call Now";
        submitBtn.onclick = () => window.location.href = "tel:0966423229";
      } catch (err) { statusText.textContent = "Error. Call dispatcher directly."; }
    };

    setupAuto('gm-origin', 'origin-container', 'originList');
    setupAuto('gm-destination', 'dest-container', 'destinationList');
    document.getElementById('mode-group').onchange = checkReady;
  </script>
</body>
</html>
