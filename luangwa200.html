<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luangwa Feira Rides | Book a Ride</title>
  <meta property="og:image" content="https://zamlisting.com/taxi.webp" />
  <meta property="og:title" content="Luangwa Feira Rides| Book a Ride" />
  <meta property="og:description" content="Book your taxi ride in Luangwa! Choose vehicle or motorbike, enter trip details, and submit via the app." />
  <meta property="og:type" content="website" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2b6ef6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Luangwa Feira Rides">
  <link rel="apple-touch-icon" href="lfr.jpg">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary-color: #2563eb;
      --secondary-color: #ff9900;
      --success-color: #1aaf5d;
      --whatsapp-color: #25d366;
      --fail-color: #dc2626;
      --bg-color-body: #f5f5f5;
      --bg-color-card: #ffffff;
      --bg-color-input: #f5f7fa;
      --border-color-light: #ccc;
      --border-color-blue: #2563eb;
      --box-shadow-light: 0 2px 5px rgba(0,0,0,0.1);
      --box-shadow-strong: 0 4px 8px rgba(0,0,0,0.2);
      --font-color-dark: #333;
      --font-color-medium: #2d3a4a;
    }
    body { font-family: 'Roboto', Arial, sans-serif; background-color: var(--bg-color-body); color: var(--font-color-dark); }

    header {
      background: var(--font-color-dark);
      color: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-content {
      max-width: 1200px;
      margin: auto;
      padding: 8px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    .company-info h2 {
      font-size: 1.3rem;
      color: var(--secondary-color);
    }
    .company-info ul { list-style: none; font-size: 0.8rem; margin-top: 2px; }
    .menu-button {
      background: none;
      border: none;
      color: white;
      font-size: 1.3rem;
      cursor: pointer;
      padding: 5px;
    }
    .menu-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--bg-color-card);
      border: 1px solid var(--border-color-light);
      border-radius: 5px;
      box-shadow: var(--box-shadow-strong);
      min-width: 250px;
      display: none;
      padding: 10px;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 200;
    }
    .menu-dropdown a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px;
      width: 100%;
      text-decoration: none;
      color: var(--font-color-dark);
      border-radius: 4px;
    }
    .menu-dropdown a:hover { background: var(--bg-color-input); }

    .product-container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
    .booking-container {
      background: var(--bg-color-card);
      border-radius: 8px;
      box-shadow: var(--box-shadow-strong);
      padding: 20px;
    }
    .inputs-wrapper { display: flex; flex-direction: column; gap: 20px; }

    /* Fieldset styling */
    fieldset {
      border: 1px solid var(--border-color-light);
      border-radius: 8px;
      padding: 15px;
      background: #f9fbfd;
      margin-bottom: 10px;
    }
    legend {
      font-weight: bold;
      color: var(--primary-color);
      padding: 0 10px;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    legend .material-icons {
      font-size: 20px;
    }

    .input-group {
      position: relative;
      background: var(--bg-color-input);
      border-radius: 5px;
      padding: 10px 10px 10px 40px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-top: 10px;
    }
    .input-group label {
      font-weight: bold;
      color: var(--primary-color);
      font-size: 0.9rem;
      display: block;
      margin-bottom: 5px;
    }
    .input-group .material-icons.input-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary-color);
      font-size: 20px;
    }
    input[type="text"], input[type="tel"] {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid var(--border-color-light);
      border-radius: 5px;
      background: transparent;
    }
    input:focus {
      border-color: var(--border-color-blue);
      box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    }

    .option-group { margin-top: 15px; }
    .radio-group {
      display: flex;
      flex-direction: row;
      gap: 30px;
      padding: 10px 0;
      justify-content: center;
    }
    .radio-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 0.95rem;
    }
    .radio-item .mode-icon {
      font-size: 36px;
      color: var(--primary-color);
    }
    .radio-item input[type="radio"] {
      appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid var(--primary-color);
      border-radius: 50%;
      position: relative;
    }
    .radio-item input[type="radio"]:checked:after {
      content: '';
      width: 10px;
      height: 10px;
      background: var(--primary-color);
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .autocomplete-list {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background: white;
      border: 1px solid var(--border-color-light);
      max-height: 200px;
      overflow-y: auto;
      z-index: 100;
      border-top: none;
      border-radius: 0 0 5px 5px;
    }
    .suggestion {
      padding: 10px;
      cursor: pointer;
    }
    .suggestion:hover { background: #f1f1f1; }

    .summary-table-section { margin-top: 20px; }
    .summary-card-fieldset {
      border: 1px solid var(--border-color-light);
      border-radius: 8px;
      padding: 15px;
      background: #f9fbfd;
    }
    .summary-card {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .card-label {
      font-size: 0.95rem;
      color: var(--font-color-medium);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .card-value {
      font-weight: bold;
      font-size: 1.1rem;
      color: var(--font-color-dark);
    }
    .card-value b { color: var(--secondary-color); font-size: 1.3rem; }

    .summary-actions-row {
      display: flex;
      justify-content: center;
      margin: 20px 0;
      gap: 15px;
      align-items: center;
    }
    .submit-btn {
      background: var(--primary-color);
      color: white;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    .submit-btn[disabled] { opacity: 0.5; cursor: not-allowed; }

    .calculation-status-wrapper {
      text-align: center;
      padding: 15px;
      min-height: 80px;
    }
    .loader {
      display: none;
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--secondary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 10px auto;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .submit-status { font-weight: 500; }
    .hidden-section { display: none; }

    @media (min-width: 768px) {
      .header-content { padding: 10px 20px; }
      .company-info h2 { font-size: 1.4rem; }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="company-info">
        <h2>Luangwa Feira Rides</h2>
        <ul><li><strong>Location:</strong> Luangwa, Zambia</li></ul>
      </div>
      <button id="menu-toggle-btn" class="menu-button" title="Menu"><i class="fas fa-ellipsis-v"></i></button>
      <div class="menu-dropdown" id="header-menu-dropdown">
        <div style="padding:5px;margin-bottom:10px;border-bottom:1px solid #eee;">
          <h4><i class="fas fa-info-circle"></i> About Our Service</h4>
          <p><strong>Location:</strong> Luangwa Feira area, Zambia.</p>
          <p><strong>Affordable:</strong> Fixed pricing based on distance.</p>
          <p><strong>Reliable:</strong> Safe and efficient transport.</p>
        </div>
        <div style="padding:5px;">
          <h4><i class="fas fa-headset"></i> Quick Contact</h4>
          <a href="tel:0966423229"><i class="fas fa-phone"></i> Call</a>
          <a href="https://wa.me/260966423229" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
          <a href="sms:0966423229"><i class="fas fa-sms"></i> SMS</a>
          <a href="mailto:zamlisting@gmail.com"><i class="fas fa-envelope"></i> Email</a>
        </div>
      </div>
    </div>
  </header>

  <main class="product-container">
    <section class="booking-section">
      <div class="booking-container">
        <div class="inputs-wrapper">

          <!-- Phone Number Fieldset with Profile Icon -->
          <fieldset>
            <legend><span class="material-icons">account_circle</span> Customer Details</legend>
            <div class="input-group">
              <span class="material-icons input-icon">phone</span>
              <input type="tel" id="customer-phone" maxlength="10" placeholder="0xxxxxxxxx" inputmode="numeric" aria-label="Phone Number">
            </div>
          </fieldset>

          <!-- Trip Details (shown after valid phone) -->
          <div id="trip-details" class="hidden-section">

            <!-- Transport Mode with Icons -->
            <fieldset>
              <legend>Transport Mode</legend>
              <div class="option-group">
                <div class="radio-group" id="mode-selection-group">
                  <div class="radio-item">
                    <input type="radio" id="mode-motorbike" name="mode" value="motorbike">
                    <span class="mode-icon material-icons">motorcycle</span>
                    <span>Motorbike</span>
                  </div>
                  <div class="radio-item">
                    <input type="radio" id="mode-vehicle" name="mode" value="vehicle">
                    <span class="mode-icon material-icons">directions_car</span>
                    <span>Vehicle</span>
                  </div>
                </div>
              </div>
            </fieldset>

            <!-- Trip Locations Fieldset -->
            <fieldset>
              <legend>Trip Locations</legend>
              <div style="display:flex;flex-direction:column;gap:15px;">
                <div class="autocomplete-wrapper input-group">
                  <span class="material-icons input-icon">place</span>
                  <label for="gm-origin">From (Pickup)</label>
                  <input type="text" id="gm-origin" placeholder="Type & Select Pickup Location...">
                  <div id="originList" class="autocomplete-list"></div>
                </div>
                <div class="autocomplete-wrapper input-group">
                  <span class="material-icons input-icon">flag</span>
                  <label for="gm-destination">To (Destination)</label>
                  <input type="text" id="gm-destination" placeholder="Type & Select Destination...">
                  <div id="destinationList" class="autocomplete-list"></div>
                </div>
              </div>
            </fieldset>
          </div>
        </div>

        <!-- Summary: Only Price and Trip Distance -->
        <div class="summary-table-section hidden-section">
          <fieldset class="summary-card-fieldset">
            <legend>Trip Summary</legend>
            <div id="summary-cards"></div>
          </fieldset>

          <div class="summary-actions-row">
            <a href="#" class="fas fa-paper-plane submit-btn" id="submit-btn" title="Submit" disabled></a>
            <span style="font-size:0.95rem;font-weight:500;">Request A Ride</span>
          </div>
        </div>

        <div class="calculation-status-wrapper">
          <div id="submit-status" class="submit-status">Please fill in all details correctly.</div>
          <div class="loader" id="calculation-spinner"></div>
        </div>
      </div>
    </section>
  </main>

  <script>
    const config = {
      vehiclePricePerKm: 3.00,
      motorbikePricePerKm: 1.02,
      vehicleMinPrice: 20,
      motorbikeMinPrice: 10,
      vehicleExtra: 6.00,
      motorbikeExtra: 2.04,
      avgSpeed: 60
    };

    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxpvhvgnjkRcZmuly7uNzPeAC5OwVUq8-qUJ2WXrOqOnSsNgCn0ZHbuz6BGslW83_rB5Q/exec";

    const places = ["Anglican Church","Airstrip","Big 2 Zambezi Water Front Resort & Safari","BM Residence","Boma Clinic","Chidada Ground","Car Wash Pub","Chitope","Chitope Rural Health Centre","Chilombwe Community School","Chiriwe Primary School","Dzalo Skills Training Centre Kambolozo","Feira Kindom Hall","Feira Day Secondary School","Gerasmos Safari Lodge","Hill View","JB Three Boarders Mall","JB Three Boarders Club","Justifeli Lodge","Kakaro Primary School","Kakaro Liberation Heritage Site","Kantuleni Executive Lodge","Kapoche","Kaunga Secondary School","Kasinsa","Katondwe Chapel","Katondwe Chaz Hotel","Katondwe Dam","Katondwe Girls Secondary School","Katondwe Mission Hospital","Katondwe Primary School","Kavalamanja","Luangwa (Feira)","Luangwa Basic School","Luangwa Bridge","Luangwa Bridge Market","Luangwa Bus Station","Luangwa Council Lodge","Luangwa DC Office","Luangwa DEBS Offices","Luangwa District Hospital","Luangwa High School Police Post","Boma Filling Station","Luangwa Habour","Indeco Building","Luangwa Market","Luangwa Main SDA Church","Mburuma Local Court","Luangwa Police Station","Luangwa Post Office","Luangwa Town Council","Luangwa Secondary School","Makichilo Lodge","Mwavi Secondary School","Mwalila Primary School","Nyabota Lodge","Passover Living Lamb Ministry Katondwe","Pentecostal Assembly of God Joshua Assembly","UCZ","Soweto Junction","Registration Office","River Spot Club","SDA Katondwe","Yangoma Lodge","Yellow Shop","ZESCO Office"];

    const segments = [
      { from: 'Kakaro Primary School', to: 'Kapoche', distance: 16 },
      { from: 'Kapoche', to: 'Luangwa Secondary School', distance: 21 },
      { from: 'Luangwa Secondary School', to: 'Katondwe Mission Hospital', distance: 5 },
      { from: 'Katondwe Mission Hospital', to: 'Mburuma Local Court', distance: 7 },
      { from: 'Mburuma Local Court', to: 'Mwavi Secondary School', distance: 0.65 },
      { from: 'Mburuma Local Court', to: 'Katondwe Mission Hospital', distance: 7.8 },
      { from: 'Mwavi Secondary School', to: 'Chitope Rural Health Centre', distance: 2 },
      { from: 'Chitope Rural Health Centre', to: 'Mwalila Primary School', distance: 6 },
      { from: 'Mwalila Primary School', to: 'Kaunga Secondary School', distance: 5 },
      { from: 'Kaunga Secondary School', to: 'Luangwa Bridge Market', distance: 14 },
      { from: 'Luangwa Bridge Market', to: 'Luangwa Bridge', distance: 3 },
      { from: "Luangwa District Hospital", to: "Soweto Junction", distance: 2.5 },
      { from: "Car Wash Pub", to: "Luangwa Town Council", distance: 1.00 },
      { from: "Car Wash Pub", to: "Soweto Junction", distance: 2.75 },
      { from: "Car Wash Pub", to: "BM Residence", distance: 1.00 },
      { from: "Soweto Junction", to: "Airstrip", distance: 1.7 },
      { from: "Soweto Junction", to: "ZESCO Office", distance: 0.3 },
      { from: "Kakaro Primary School", to: "Luangwa District Hospital", distance: 7.1 },
      { from: "ZESCO Office", to: "Luangwa Main SDA Church", distance: 0.65 },
      { from: "Luangwa Main SDA Church", to: "Indeco Building", distance: 0.7 },
      { from: "Indeco Building", to: "JB Three Boarders Club", distance: 0.1 },
      { from: "JB Three Boarders Club", to: "Yellow Shop", distance: 0.45 },
      { from: "Yellow Shop", to: "Luangwa Bus Station", distance: 0.19 },
      { from: "Luangwa Bus Station", to: "JB Three Boarders Mall", distance: 0.24 },
      { from: "JB Three Boarders Mall", to: "Boma Filling Station", distance: 0.35 },
      { from: "Boma Filling Station", to: "Kantuleni Executive Lodge", distance: 0.19 },
      { from: "Kantuleni Executive Lodge", to: "Luangwa Habour", distance: 0.09 },
      { from: "Kantuleni Executive Lodge", to: "Luangwa Council Lodge", distance: 0.09 },
      { from: "Luangwa Council Lodge", to: "Luangwa DC Office", distance: 0.3 },
      { from: "Luangwa DC Office", to: "Luangwa Police Station", distance: 0.3 },
      { from: "Luangwa Police Station", to: "Luangwa DEBS Offices", distance: 0.1 },
      { from: "Luangwa DEBS Offices", to: "Yangoma Lodge", distance: 0.4 },
      { from: "Yangoma Lodge", to: "Boma Clinic", distance: 0.5 },
      { from: "JB Three Boarders Mall", to: "Nyabota Lodge", distance: 0.25 },
      { from: "Nyabota Lodge", to: "Luangwa Basic School", distance: 0.18 },
      { from: "JB Three Boarders Mall", to: "River Spot Club", distance: 0.03 },
      { from: "Luangwa Bus Station", to: "Luangwa Town Council", distance: 2.16 },
      { from: "Luangwa Town Council", to: "Registration Office", distance: 0.49 },
      { from: "Luangwa Town Council", to: "Dzalo Skills Training Centre Kambolozo", distance: 0.60 },
      { from: "Luangwa Town Council", to: "Big 2 Zambezi Water Front Resort & Safari", distance: 3.2 },
      { from: "Big 2 Zambezi Water Front Resort & Safari", to: "Chilombwe Community School", distance: 9.8 },
      { from: "Registration Office", to: "Chidada Ground", distance: 0.49 },
      { from: "Chidada Ground", to: "Yangoma Lodge", distance: 2.34 },
      { from: "Luangwa Town Council", to: "Hill View", distance: 0.40 },
      { from: "Hill View", to: "BM Residence", distance: 1.00 },
      { from: "BM Residence", to: "Feira Day Secondary School", distance: 1.10 },
      { from: "Feira Kindom Hall", to: "Anglican Church", distance: 0.08 },
      { from: "Feira Kindom Hall", to: "Luangwa (Feira)", distance: 0.7 },
      { from: "Luangwa (Feira)", to: "Luangwa Bus Station", distance: 0.1 },
      { from: "Dzalo Skills Training Centre Kambolozo", to: "Justifeli Lodge", distance: 0.26 },
      { from: "Luangwa Market", to: "Makichilo Lodge", distance: 0.4 },
      { from: "Makichilo Lodge", to: "Gerasmos Safari Lodge", distance: 0.3 },
      { from: "Makichilo Lodge", to: "UCZ", distance: 0.5 },
      { from: "Luangwa Bus Station", to: "Luangwa Market", distance: 0.02 },
      { from: "Pentecostal Assembly of God Joshua Assembly", to: "Kindom Hall", distance: 0.13 },
      { from: "UCZ", to: "Pentecostal Assembly of God Joshua Assembly", distance: 0.08 },
      { from: "Chitope", to: "Kasinsa", distance: 10.0 },
      { from: "Chitope", to: "Mwavi Secondary School", distance: 1.1 },
      { from: "Kasinsa", to: "Luangwa Secondary School", distance: 14.0 },
      { from: "Luangwa High School Police Post", to: "Chiriwe Primary School", distance: 2.1 },
      { from: "Luangwa Secondary School", to: "Luangwa High School Police Post", distance: 0.8 },
      { from: "Kapoche", to: "Chiriwe Primary School", distance: 19.7 },
      { from: "Luangwa High School Police Post", to: "SDA Katondwe", distance: 1.0 },
      { from: "Katondwe Mission Hospital", to: "Katondwe Primary School", distance: 0.55 },
      { from: "Katondwe Chapel", to: "Katondwe Primary School", distance: 0.05 },
      { from: "Katondwe Primary School", to: "Katondwe Girls Secondary School", distance: 0.0 },
      { from: "Katondwe Girls Secondary School", to: "Katondwe Chaz Hotel", distance: 0.45 },
      { from: "Katondwe Chaz Hotel", to: "Passover Living Lamb Ministry Katondwe", distance: 0.4 },
      { from: "Passover Living Lamb Ministry Katondwe", to: "Katondwe Dam", distance: 0.1 },
      { from: "Kakaro Primary School", to: "Kakaro Liberation Heritage Site", distance: 1.2 },
      { from: "Kavalamanja", to: "Luangwa District Hospital", distance: 23.0 }
    ];

    const hubs = ["Luangwa Bus Station","Chitope","Luangwa Bridge Market"];

    const graph = {};
    segments.forEach(({from, to, distance}) => {
      if (!graph[from]) graph[from] = [];
      if (!graph[to]) graph[to] = [];
      graph[from].push({node: to, distance});
      graph[to].push({node: from, distance});
    });

    function findShortestDistance(start, end) {
      if (start === end) return 0;
      const distances = {}; const unvisited = new Set(Object.keys(graph));
      for (const node of unvisited) distances[node] = Infinity;
      distances[start] = 0;
      while (unvisited.size) {
        let current = null;
        for (const node of unvisited) {
          if (current === null || distances[node] < distances[current]) current = node;
        }
        if (distances[current] === Infinity) break;
        if (current === end) return distances[end];
        unvisited.delete(current);
        for (const neighbor of graph[current] || []) {
          if (unvisited.has(neighbor.node)) {
            const alt = distances[current] + neighbor.distance;
            if (alt < distances[neighbor.node]) distances[neighbor.node] = alt;
          }
        }
      }
      return null;
    }

    function calculateTotalDistance(pickup, destination) {
      if (pickup === destination) return {total:0, trip:0, hub:'N/A'};
      let nearestHub = null, minToHub = Infinity;
      for (const hub of hubs) {
        const d = findShortestDistance(pickup, hub);
        if (d !== null && d < minToHub) { minToHub = d; nearestHub = hub; }
      }
      if (!nearestHub) return {total:null, trip:null, hub:null};
      const tripDist = findShortestDistance(pickup, destination);
      const destToHub = findShortestDistance(destination, nearestHub);
      if (tripDist === null || destToHub === null) return {total:null, trip:null, hub:nearestHub};
      return {total: minToHub + tripDist + destToHub, trip: tripDist, hub: nearestHub};
    }

    // Elements
    const originInput = document.getElementById('gm-origin');
    const destinationInput = document.getElementById('gm-destination');
    const customerPhoneInput = document.getElementById('customer-phone');
    const modeVehicle = document.getElementById('mode-vehicle');
    const modeMotorbike = document.getElementById('mode-motorbike');
    const summarySection = document.querySelector('.summary-table-section');
    const summaryCards = document.getElementById('summary-cards');
    const submitBtn = document.getElementById('submit-btn');
    const statusDiv = document.getElementById('submit-status');
    const spinner = document.getElementById('calculation-spinner');
    const tripDetails = document.getElementById('trip-details');

    let summaryData = null;

    function setupAutocomplete(input, listId) {
      const list = document.getElementById(listId);
      input.addEventListener('input', () => {
        const query = input.value.toLowerCase();
        list.innerHTML = '';
        if (!query) return;
        places.filter(p => p.toLowerCase().includes(query)).sort().forEach(place => {
          const item = document.createElement('div');
          item.textContent = place;
          item.className = 'suggestion';
          item.onclick = () => {
            input.value = place;
            list.innerHTML = '';
            updateSummary();
          };
          list.appendChild(item);
        });
      });
    }

    function updateSummary() {
      summaryCards.innerHTML = '';
      summarySection.classList.add('hidden-section');
      submitBtn.disabled = true;
      summaryData = null;

      const origin = originInput.value.trim();
      const destination = destinationInput.value.trim();
      const phone = customerPhoneInput.value.trim();
      const mode = modeVehicle.checked ? 'Vehicle' : modeMotorbike.checked ? 'Motorbike' : null;

      const phoneValid = /^0[0-9]{9}$/.test(phone);
      if (phoneValid) {
        tripDetails.classList.remove('hidden-section');
      } else {
        tripDetails.classList.add('hidden-section');
      }

      if (!places.includes(origin) || !places.includes(destination) || !phoneValid || !mode) {
        statusDiv.textContent = phoneValid ? 'Please select locations and transport mode.' : 'Enter a valid 10-digit phone number starting with 0.';
        return;
      }

      statusDiv.textContent = 'Calculating price and distance...';
      spinner.style.display = 'block';

      setTimeout(() => {
        spinner.style.display = 'none';

        const dist = calculateTotalDistance(origin, destination);
        if (dist.total === null) {
          statusDiv.textContent = 'No route found between these locations.';
          return;
        }

        const pricePerKm = mode === 'Vehicle' ? config.vehiclePricePerKm : config.motorbikePricePerKm;
        const minPrice = mode === 'Vehicle' ? config.vehicleMinPrice : config.motorbikeMinPrice;
        const extra = mode === 'Vehicle' ? config.vehicleExtra : config.motorbikeExtra;

        let base = Math.max(dist.total * pricePerKm, minPrice);
        const price = Math.round(base + extra);

        summaryCards.innerHTML = `
          <div class="summary-card">
            <span class="card-label"><span class="material-icons">payments</span> Price</span>
            <span class="card-value"><b>K${price}</b></span>
          </div>
          <div class="summary-card">
            <span class="card-label"><span class="material-icons">route</span> Trip Distance</span>
            <span class="card-value">${dist.trip.toFixed(2)} km</span>
          </div>
        `;

        summaryData = { mode, phone, from: origin, to: destination, price, tripDistance: dist.trip.toFixed(2) };
        summarySection.classList.remove('hidden-section');
        submitBtn.disabled = false;
        statusDiv.textContent = '';
      }, 800);
    }

    function submitRide() {
      if (!summaryData) return;
      const standardized = '+260' + summaryData.phone.substring(1);
      const payload = new URLSearchParams({
        preferredMode: summaryData.mode,
        phone: standardized,
        from: summaryData.from,
        to: summaryData.to,
        tripDistance: summaryData.tripDistance,
        price: summaryData.price,
        timestamp: new Date().toLocaleString("en-US", { timeZone: "Africa/Lusaka" })
      });

      statusDiv.textContent = 'Submitting...';
      submitBtn.disabled = true;

      fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: payload })
        .then(() => {
          statusDiv.textContent = 'Booking request sent! You will be contacted shortly.';
          submitBtn.classList.replace('fa-paper-plane', 'fa-phone');
          submitBtn.style.backgroundColor = '#25d366';
          submitBtn.onclick = (e) => { e.preventDefault(); window.location.href = 'tel:0966423229'; };
        })
        .catch(() => {
          statusDiv.textContent = 'Submission failed. Please try again.';
          submitBtn.disabled = false;
        });
    }

    // Event listeners
    customerPhoneInput.addEventListener('input', updateSummary);
    document.getElementById('mode-selection-group').addEventListener('change', updateSummary);
    originInput.addEventListener('input', updateSummary);
    destinationInput.addEventListener('input', updateSummary);

    setupAutocomplete(originInput, 'originList');
    setupAutocomplete(destinationInput, 'destinationList');

    submitBtn.addEventListener('click', e => { e.preventDefault(); submitRide(); });

    // Menu toggle
    document.getElementById('menu-toggle-btn').addEventListener('click', e => {
      e.stopPropagation();
      const dropdown = document.getElementById('header-menu-dropdown');
      dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    });
    document.addEventListener('click', () => {
      document.getElementById('header-menu-dropdown').style.display = 'none';
    });
  </script>
</body>
</html>
