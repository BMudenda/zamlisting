<!DOCTYPE html>
<html>
<head>
  <title>Book a Ride</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Google Fonts and Material Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      background: linear-gradient(135deg, #eaf1fc 0%, #f7fbff 100%);
      max-width: 470px;
      margin: auto;
      padding: 0;
    }
    .top-controls {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 12px;
      margin-top: 14px;
      margin-bottom: 0;
    }
    .toggle-btn {
      background: linear-gradient(90deg, #2563eb 0%, #468cf0 100%);
      color: #fff;
      border: none;
      font-weight: 500;
      padding: 8px 24px;
      border-radius: 999px;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.2s, transform 0.15s;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 8px #2563eb19;
    }
    .toggle-btn:hover, .toggle-btn:focus {
      background: linear-gradient(90deg, #174ea6 0%, #2563eb 100%);
      box-shadow: 0 8px 24px #2563eb22;
      transform: translateY(-2px) scale(1.03);
    }
    .instructions-box {
      background: #fff;
      color: #1e293b;
      border-radius: 12px;
      box-shadow: 0 2px 10px #2563eb13;
      margin: 12px 0 18px 0;
      padding: 18px 18px 14px 18px;
      font-size: 15px;
      line-height: 1.6;
      display: none;
      animation: fadeIn .4s;
    }
    @keyframes fadeIn {
      from { opacity: 0;}
      to { opacity: 1;}
    }
    h2 {
      text-align: center;
      color: #2563eb;
      margin: 28px 0 12px 0;
      font-weight: 800;
      letter-spacing: 2px;
      font-size: 2.3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .icon-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 38px;
      margin-bottom: 34px;
      margin-top: 14px;
    }
    .icon-box {
      background: linear-gradient(135deg, #e3eafe 0%, #d0e2ff 100%);
      border-radius: 50%;
      box-shadow: 0 2px 12px #2563eb19;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 72px;
      height: 72px;
      border: 3px solid #2563eb;
      font-size: 2.7rem;
      color: #2563eb;
      transition: box-shadow 0.18s, transform 0.18s;
    }
    .icon-box:hover {
      box-shadow: 0 8px 24px #2563eb22;
      transform: scale(1.10);
    }
    .content-section, .summary-table-section {
      background: #fff;
      padding: 34px 22px 22px 22px;
      border-radius: 18px;
      box-shadow: 0 6px 28px 0 rgba(66,133,244,0.12);
      margin: 18px 0 18px 0;
      position: relative;
      overflow: hidden;
      transition: box-shadow 0.3s, transform 0.3s;
    }
    .content-section:hover, .summary-table-section:hover {
      box-shadow: 0 12px 48px 0 rgba(66,133,244,0.18);
      transform: translateY(-3px) scale(1.01);
    }
    .section-title {
      font-weight: 700;
      color: #2563eb;
      font-size: 17px;
      margin-bottom: 10px;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .inputs-wrapper {
      display: flex;
      flex-direction: column;
      gap: 27px;
      margin: 15px 0;
    }
    .input-group {
      position: relative;
      background: #f5f7fa;
      border-radius: 9px;
      padding: 16px 14px 8px 48px;
      box-shadow: 0 1px 3px #2563eb11;
      display: flex;
      flex-direction: column;
      justify-content: center;
      width: 100%;
      min-width: 0;
      box-sizing: border-box;
    }
    .input-group label {
      font-weight: 500;
      color: #2563eb;
      font-size: 13px;
      margin-bottom: 2px;
      letter-spacing: .1em;
    }
    .input-group .material-icons.input-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #2563eb;
      font-size: 26px;
      opacity: 0.85;
      background: #e3eafe;
      border-radius: 50%;
      padding: 6px;
    }
    .autocomplete-wrapper {
      width: 100%;
      position: relative;
    }
    input, select {
      width: 100%;
      padding: 13px 12px;
      margin: 3px 0 0 0;
      font-size: 16px;
      border-radius: 7px;
      border: 1.5px solid #e3e8f0;
      transition: border 0.2s, box-shadow 0.2s;
      font-family: 'Roboto', Arial, sans-serif;
      outline: none;
      background: #f5f7fa;
      min-width: 0;
      box-sizing: border-box;
      display: block;
      box-shadow: 0 1px 2px #2563eb09;
    }
    input:focus, select:focus {
      border: 1.5px solid #2563eb;
      box-shadow: 0 0 0 3px #2563eb22;
      background: #fff;
    }
    .autocomplete-list {
      position: absolute;
      background: #fff;
      border: 1px solid #b6c1dd;
      max-height: 140px;
      overflow-y: auto;
      z-index: 1000;
      width: 100%;
      border-radius: 0 0 7px 7px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.13);
      left: 0;
      top: 100%;
    }
    .autocomplete-item {
      padding: 11px 14px;
      cursor: pointer;
      border-bottom: 1px solid #f1f5f9;
      font-size: 15px;
      color: #1e293b;
      transition: background 0.13s;
    }
    .autocomplete-item:last-child {
      border-bottom: none;
    }
    .autocomplete-item:hover, .autocomplete-item.active {
      background-color: #f0f6ff;
      color: #2563eb;
    }
    .info-section {
      padding: 12px 0 5px 0;
      color: #475569;
      font-size: 16px;
      line-height: 1.5;
    }
    #google-map-frame {
      width: 100%;
      height: 390px;
      border: none;
      margin-top: 12px;
      display: none;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(66,133,244,0.10);
      background: #f1f5f9;
      transition: box-shadow 0.2s;
    }
    .summary-table-section {
      overflow-x: auto;
      padding-bottom: 18px;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 6px 28px 0 rgba(66,133,244,0.12);
      margin: 18px 0 18px 0;
    }
    .summary-table-wrapper {
      width: 100%;
      overflow-x: auto;
      margin-top: 8px;
      display: flex;
      justify-content: center;
    }
    table.summary-table {
      min-width: 710px;
      width: auto;
      border-collapse: collapse;
      font-size: 15px;
      background: #f9fbfd;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 6px #2563eb11;
      margin-left: auto;
      margin-right: auto;
    }
    table.summary-table th, table.summary-table td {
      border: 1px solid #dbeafe;
      padding: 10px 13px;
      text-align: left;
    }
    table.summary-table th {
      background-color: #e7f0fe;
      color: #222;
      font-weight: 700;
    }
    table.summary-table td {
      color: #2d3a4a;
      font-weight: 500;
    }
    .material-icons {
      font-size: 23px;
      vertical-align: middle;
      color: #2563eb;
      margin-right: 2px;
    }
    .summary-table-section .material-icons {
      font-size: 18px;
      margin-right: 3px;
    }
    .single-action-row {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin-bottom: 14px;
      margin-top: 0;
      gap: 0;
    }
    .single-action-row .map-btn-wrapper {
      width: 100%;
      display: flex;
      justify-content: flex-start;
    }
    .single-action-row button {
      min-width: 120px;
      max-width: 220px;
      padding: 11px 0;
      background: linear-gradient(90deg, #2563eb 0%, #468cf0 100%);
      color: #fff;
      border: none;
      border-radius: 999px;
      box-shadow: 0 2px 8px #2563eb19;
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 1px;
      cursor: pointer;
      transition: background 0.18s, box-shadow 0.18s, transform 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 7px;
    }
    .single-action-row button:hover, .single-action-row button:focus {
      background: linear-gradient(90deg, #174ea6 0%, #2563eb 100%);
      box-shadow: 0 8px 32px #2563eb33;
      transform: translateY(-2px) scale(1.03);
    }
    .summary-actions-row {
      display: flex;
      gap: 12px;
      margin-bottom: 8px;
      margin-top: 0;
      justify-content: space-between;
      flex-wrap: nowrap;
      width: 100%;
    }
    .summary-actions-row button {
      flex: 1 1 0;
      min-width: 100px;
      max-width: 180px;
      padding: 11px 0;
      margin: 0;
      background: linear-gradient(90deg, #2563eb 0%, #468cf0 100%);
      color: #fff;
      border: none;
      border-radius: 999px;
      box-shadow: 0 2px 8px #2563eb19;
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 1px;
      cursor: pointer;
      transition: background 0.18s, box-shadow 0.18s, transform 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 7px;
    }
    .summary-actions-row button:hover, .summary-actions-row button:focus {
      background: linear-gradient(90deg, #174ea6 0%, #2563eb 100%);
      box-shadow: 0 8px 32px #2563eb33;
      transform: translateY(-2px) scale(1.03);
    }
    @media (max-width: 540px) {
      .single-action-row {
        flex-direction: column;
        margin-bottom: 10px;
      }
      .summary-actions-row {
        flex-direction: column;
        gap: 7px;
      }
      .summary-actions-row button {
        font-size: 14px;
        min-width: 90px;
      }
    }
    .loader {
      display: inline-block;
      width: 26px;
      height: 26px;
      border: 3px solid #2563eb;
      border-radius: 50%;
      border-top: 3px solid #e5e7eb;
      animation: spin 1s linear infinite;
      vertical-align: middle;
      margin-right: 7px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
    .submit-status {
      display: flex;
      align-items: center;
      gap: 7px;
      margin-top: 10px;
      font-weight: 500;
    }
    .submit-status.success {
      color: #1aaf5d;
    }
    .submit-status.failed {
      color: #dc2626;
    }
    .mode-radio.selected {
      background: #e3eafe;
      border-radius: 10px;
      padding-right: 8px;
      font-weight: 600;
      box-shadow: 0 2px 8px #2563eb0b;
    }
    .mode-group {
      display: flex;
      gap: 20px;
      align-items: center;
      margin-top: 4px;
    }
    .mode-radio {
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      padding: 3px 8px 3px 0;
      transition: background 0.2s;
    }
    .mode-radio input[type="radio"] {
      accent-color: #2563eb;
      margin-right: 3px;
      margin-left: 0;
    }
  </style>
</head>
<body>
  <div class="top-controls">
    <button class="toggle-btn" id="toggle-instructions-btn" onclick="toggleInstructions()">
      <span class="material-icons">info</span>
      Instructions
    </button>
  </div>
  <div class="instructions-box" id="instructions-box">
    <b>How to Use Book a Ride:</b>
    <ol style="margin: 10px 0 0 18px; padding:0;">
      <li>
        <b>Mode selection:</b> Choose your preferred mode (Vehicle/Motorbike), enter your trip details, and get fare estimates. Enter your phone number (e.g. 0978167546).
      </li>
      <li><b>Start/End Location:</b> Use the "From" and "To" fields to type or pick your route. Suggestions will appear as you type.</li>
      <li><b>Summarize:</b> Click <b>Summarize</b> to review your trip summary and fare calculation.</li>
      <li><b>Submit:</b> Click <b>Submit</b> to send your trip record to. You'll see a loader and a status message.</li>
      <li><b>Show Route on Map:</b> Optionally, click <b>Show Route on Google Maps</b> to see your route visually.</li>
    </ol>
    <div style="margin-top: 13px; color: #666; font-size: 14px;">
    </div>
  </div>
  <h2>
    Book a Ride
  </h2>
  <div class="icon-row">
    <div class="icon-box" title="Book a motorbike ride">
      <span class="material-icons" aria-label="Motorbike">two_wheeler</span>
    </div>
    <div class="icon-box" title="Book a vehicle ride">
      <span class="material-icons" aria-label="Vehicle">directions_car</span>
    </div>
  </div>
  <div class="content-section">
    <div class="section-title"></div>
    <div class="inputs-wrapper">
      <input type="hidden" id="user-type" value="customer">
      <div class="input-group" id="mode-group-wrapper">
        <span class="material-icons input-icon">commute</span>
        <label for="mode-of-transport">Preferred Mode</label>
        <div class="mode-group" id="mode-group">
          <label class="mode-radio" id="radio-vehicle">
            <input type="radio" name="mode" value="vehicle" id="mode-vehicle" onchange="handleModeChange();handleCustomerPhoneInput();">
            <span class="material-icons">directions_car</span>Vehicle
          </label>
          <label class="mode-radio" id="radio-motorbike">
            <input type="radio" name="mode" value="motorbike" id="mode-motorbike" onchange="handleModeChange();handleCustomerPhoneInput();">
            <span class="material-icons">two_wheeler</span>Motorbike
          </label>
        </div>
      </div>
      <div class="input-group" id="customer-phone-wrapper" style="display:none;">
        <span class="material-icons input-icon">phone</span>
        <label for="customer-phone">Phone Number</label>
        <input
          type="tel"
          id="customer-phone"
          maxlength="10"
          pattern="^0[0-9]{9}$"
          placeholder="e.g. 0978167546"
          autocomplete="off"
          inputmode="numeric"
        >
      </div>
      <div class="input-group">
        <span class="material-icons input-icon">place</span>
        <label for="gm-origin">From</label>
        <div class="autocomplete-wrapper">
          <input type="text" id="gm-origin" autocomplete="off" placeholder="Enter starting point" aria-label="Origin">
          <div id="gm-origin-list" class="autocomplete-list"></div>
        </div>
      </div>
      <div class="input-group">
        <span class="material-icons input-icon">flag</span>
        <label for="gm-destination">To</label>
        <div class="autocomplete-wrapper">
          <input type="text" id="gm-destination" autocomplete="off" placeholder="Enter destination" aria-label="Destination">
          <div id="gm-destination-list" class="autocomplete-list"></div>
        </div>
      </div>
    </div>
    <div class="info-section" style="font-size:14px; color:#666;">
      <span class="material-icons" style="font-size:17px;vertical-align:middle; color:#666;margin-right:2px;">info</span>
      This will show the route on this page and requires internet access. Toggle the map to check distance
    </div>
    <iframe id="google-map-frame" allowfullscreen loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
  </div>
  <div class="summary-table-section">
    <div class="section-title">
      <span class="material-icons">table_chart</span>
      Trip Summary
    </div>
    <form id="summary-form" onsubmit="event.preventDefault(); updateSummaryTable();">
      <div class="single-action-row">
        <div class="map-btn-wrapper">
          <button type="button" id="map-btn" onclick="toggleMap()">
            <span class="material-icons">map</span><span id="map-btn-text">Tap To Show Map</span>
          </button>
        </div>
      </div>
      <div class="summary-actions-row">
        <button type="button" onclick="updateSummaryTable()">
          <span class="material-icons">summarize</span>Calculate
        </button>
        <button type="button" id="submit-btn" onclick="submitToGoogleSheet()" disabled>
          <span class="material-icons">send</span>Submit
        </button>
      </div>
    </form>
    <div class="summary-table-wrapper">
      <div id="summary-table-container"></div>
    </div>
    <div id="submit-status"></div>
    <div id="loader" class="loader" style="display:none;"></div>
  </div>
  <script>
    // Place list and distance map for Luangwa district
    const places = [
      "Luangwa Boma Clinic", "Katondwe", "Feira", "Kasinsa", "Kavalamanja",
      "Chitope", "Luangwa Bridge", "Mphuka", "Kapoche", "Kanyense",
      "Munyense", "Chipuka", "Mpuka Mission",
      "Luangwa Boma Clinic", "Katondwe", "Feira", "Kasinsa", "Kavalamanja",
      "Chitope", "Luangwa Bridge", "Kapoche", "Chipuka", "Kaunga",
      "Mpuka Mission", "Unknown1", "Unknown2", "Unknown3", "Unknown4", "Unknown5", "Unknown6",

    // Luanshya Town Areas
     "Luanshya", "Roan", "Mpatamatu", "Fikondo", "Baluba", "Muliokela", "Mine Area", "Kamirenda",

    // Main Towns in Zambia
      "Lusaka", "Kitwe", "Ndola", "Livingstone", "Chipata", "Solwezi", "Kasama",
     "Mansa", "Mongu", "Mazabuka", "Choma", "Kabwe", "Kapiri Mposhi", "Petauke", "Samfya", "Serenje",
  
    // Luangwa distances
      
      "Kaunga"
    ];

    const roadDistances = {
    // Luangwa District
    
    "Katondwe-Feira": 53,
    "Feira-Kasinsa": 56,
    "Luangwa Boma Clinic-Katondwe": 53,
    "Luangwa Boma Clinic-Kavalamanja": 65,
    "Luangwa Boma Clinic-Feira": 15,
    "Katondwe-Kavalamanja": 71,
    "Luangwa Boma Clinic-Chitope": 63,
    "Chitope-Luangwa Bridge": 29,
    "Luangwa Bridge-Kavalamanja": 106,
    "Feira-Kapoche": 30,
    "Feira-Unknown1": 22,
    "Feira-Unknown2": 35,
    "Unknown3-Kavalamanja": 20,
    "Katondwe-Unknown4": 18,
    "Unknown5-Chitope": 15,
    "Chipuka-Kasinsa": 10,
    "Kasinsa-Unknown6": 14,
    "Unknown6-Kaunga": 26,
    "Mpuka Mission-Unknown5": 12,

    // Luanshya local distances (example)
    "Luanshya-Roan": 3,
    "Luanshya-Mpatamatu": 5,
    "Luanshya-Fikondo": 7,
    "Luanshya-Baluba": 15,
    "Luanshya-Muliokela": 10,
    "Luanshya-Mine Area": 2,
    "Luanshya-Kamirenda": 4,

    // Main Zambia towns (approximate road distances in km)
    "Lusaka-Ndola": 320,
    "Lusaka-Kitwe": 360,
    "Lusaka-Livingstone": 480,
    "Ndola-Kitwe": 62,
    "Kitwe-Solwezi": 230,
    "Chipata-Lusaka": 570,
    "Kasama-Mansa": 350,
    "Mongu-Lusaka": 580,
    "Choma-Livingstone": 190,
    "Kabwe-Kapiri Mposhi": 55,
    "Mazabuka-Lusaka": 135,




      
      "Mpuka Mission-x": 12
    };

    function getDistance(from, to) {
      const key1 = `${from}-${to}`;
      const key2 = `${to}-${from}`;
      return roadDistances[key1] || roadDistances[key2] || null;
    }

    function calculateFare(distance, type) {
      return type === "motorbike" ? Math.ceil(distance / 3) * 10 :
             type === "vehicle" ? Math.ceil(distance / 3) * 20 : 0;
    }

    let summaryData = null;

    function toggleInstructions() {
      const box = document.getElementById('instructions-box');
      const btn = document.getElementById('toggle-instructions-btn');
      if (box.style.display === "block") {
        box.style.display = "none";
        btn.innerHTML = '<span class="material-icons">info</span>Instructions';
      } else {
        box.style.display = "block";
        btn.innerHTML = '<span class="material-icons">close</span>Hide Instructions';
      }
    }

    function handleCustomerPhoneInput() {
      const phoneWrapper = document.getElementById('customer-phone-wrapper');
      const vehicle = document.getElementById('mode-vehicle').checked;
      const motorbike = document.getElementById('mode-motorbike').checked;
      if (vehicle || motorbike) {
        phoneWrapper.style.display = "";
      } else {
        phoneWrapper.style.display = "none";
      }
    }

    function handleModeChange() {
      const v = document.getElementById('mode-vehicle');
      const m = document.getElementById('mode-motorbike');
      document.getElementById('radio-vehicle').classList.toggle('selected', v.checked);
      document.getElementById('radio-motorbike').classList.toggle('selected', m.checked);
    }

    // Autocomplete helpers
    function searchPlaces(value, list, maxResults = 12) {
      if (!value) return [];
      value = value.trim().toLowerCase();

      const startsWith = [], wordMatch = [], contains = [], fuzzy = [];
      for (let place of list) {
        const p = place.toLowerCase();
        if (p.startsWith(value)) {
          startsWith.push(place);
        } else if (p.split(/[\s,()-]+/).some(w => w.startsWith(value) && w.length > value.length)) {
          wordMatch.push(place);
        } else if (p.includes(value)) {
          contains.push(place);
        } else if (value.length >= 3 && getEditDistance(p, value) === 1) {
          fuzzy.push(place);
        }
        if (startsWith.length + wordMatch.length + contains.length + fuzzy.length >= maxResults * 2) break;
      }
      const all = startsWith.concat(wordMatch, contains, fuzzy);
      return Array.from(new Set(all)).slice(0, maxResults);
    }
    function getEditDistance(a, b) {
      if (Math.abs(a.length - b.length) > 2) return 99;
      const m = a.length, n = b.length;
      const dp = Array(m + 1).fill(0).map(() => Array(n + 1).fill(0));
      for (let i = 0; i <= m; i++) dp[i][0] = i;
      for (let j = 0; j <= n; j++) dp[0][j] = j;
      for (let i = 1; i <= m; i++) {
        for (let j = 1; j <= n; j++) {
          if (a[i - 1] === b[j - 1]) dp[i][j] = dp[i - 1][j - 1];
          else dp[i][j] = 1 + Math.min(dp[i - 1][j], dp[i][j - 1], dp[i - 1][j - 1]);
        }
      }
      return dp[m][n];
    }
    function showSuggestions(input, field) {
      const listId = field + '-list';
      const list = document.getElementById(listId);
      const value = input.value;
      list.innerHTML = '';
      if (!value) return;
      const filtered = searchPlaces(value, places, 12);
      filtered.forEach(place => {
        const item = document.createElement('div');
        item.classList.add('autocomplete-item');
        item.textContent = place;
        item.onclick = () => {
          input.value = place;
          list.innerHTML = '';
        };
        list.appendChild(item);
      });
    }
    document.getElementById('gm-origin').addEventListener("input", function() {
      showSuggestions(this, 'gm-origin');
    });
    document.getElementById('gm-destination').addEventListener("input", function() {
      showSuggestions(this, 'gm-destination');
    });

    document.addEventListener('click', function (e) {
      document.querySelectorAll('.autocomplete-list').forEach(list => {
        if (!e.target.closest('.autocomplete-wrapper')) {
          list.innerHTML = '';
        }
      });
    });

    function toggleMap() {
      const origin = document.getElementById('gm-origin').value.trim();
      const destination = document.getElementById('gm-destination').value.trim();
      const frame = document.getElementById('google-map-frame');
      const mapBtn = document.getElementById('map-btn');
      const mapBtnText = document.getElementById('map-btn-text');

      if (frame.style.display === "none" || frame.style.display === "") {
        if (!origin || !destination) {
          alert("Please enter both origin and destination.");
          return;
        }
        const embedUrl = "https://www.google.com/maps?q=" +
          encodeURIComponent(origin + " to " + destination) +
          "&output=embed";
        frame.src = embedUrl;
        frame.style.display = "block";
        mapBtnText.textContent = "Hide Map";
        mapBtn.setAttribute('aria-pressed', 'true');
        frame.scrollIntoView({behavior:"smooth"});
      } else {
        frame.style.display = "none";
        mapBtnText.textContent = "Map";
        mapBtn.setAttribute('aria-pressed', 'false');
      }
    }

    async function updateSummaryTable() {
      const container = document.getElementById('summary-table-container');
      const submitBtn = document.getElementById('submit-btn');
      let mode = "";
      let pricePer3Km = 20;
      let customerPhone = "";
      const v = document.getElementById('mode-vehicle').checked;
      const m = document.getElementById('mode-motorbike').checked;
      if (!v && !m) {
        container.innerHTML = '<div style="color:red;margin-top:10px;">Please select a mode of transport above.</div>';
        submitBtn.disabled = true;
        summaryData = null;
        return;
      }
      if (v) {
        mode = "Vehicle";
        pricePer3Km = 20;
      } else if (m) {
        mode = "Motorbike";
        pricePer3Km = 10;
      }
      customerPhone = document.getElementById('customer-phone').value.trim();
      if (!customerPhone.match(/^0[0-9]{9}$/)) {
        container.innerHTML = '<div style="color:red;margin-top:10px;">Please enter a valid phone number in the format 0978167546.</div>';
        submitBtn.disabled = true;
        summaryData = null;
        return;
      }
      const origin = document.getElementById('gm-origin').value.trim();
      const destination = document.getElementById('gm-destination').value.trim();
      if (!origin || !destination) {
        container.innerHTML = '<div style="color:red;margin-top:10px;">Please enter both origin and destination above.</div>';
        submitBtn.disabled = true;
        summaryData = null;
        return;
      }

      // Get distance from the predefined roadDistances table
      const distance = getDistance(origin, destination);

      if (!distance) {
        container.innerHTML = `<div style="color:red;margin-top:10px;">Distance not found for selected route.</div>`;
        submitBtn.disabled = true;
        summaryData = null;
        return;
      }

      // Estimate travel time (assuming average speed 60km/h)
      const avgSpeed = 60;
      const timeHours = distance / avgSpeed;
      const wholeHours = Math.floor(timeHours);
      const minutes = Math.round((timeHours - wholeHours) * 60);

      // Price calculation: K20 per 3km for vehicle, K10 per 3km for motorbike
      let price = Math.ceil(distance / 3) * pricePer3Km;

      let timeText = "";
      if (wholeHours > 0) {
        timeText += wholeHours + " hr";
        if (minutes > 0) timeText += " " + minutes + " min";
      } else {
        timeText += minutes + " min";
      }

      let tableHeader = `
        <tr>
          <th>User Type</th>
          <th>Preferred Mode</th>
          <th>Phone</th>
          <th>From</th>
          <th>To</th>
          <th>Distance (km)</th>
          <th>Estimated Time</th>
          <th>Price (K)</th>
        </tr>`;
      let tableRow = `
        <tr>
          <td>Customer</td>
          <td>${mode}</td>
          <td>${customerPhone}</td>
          <td>${origin}</td>
          <td>${destination}</td>
          <td>${distance}</td>
          <td>${timeText}</td>
          <td><b>K${price}</b></td>
        </tr>`;

      container.innerHTML = `
        <table class="summary-table">
          ${tableHeader}
          ${tableRow}
        </table>
      `;

      summaryData = {
        userType: "Customer",
        preferredMode: mode,
        phone: customerPhone,
        from: origin,
        to: destination,
        distance: distance,
        estimatedTime: timeText,
        price: price
      };
      submitBtn.disabled = false;
      document.getElementById('submit-status').innerHTML = '';
    }

    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyXsFAuKlId6lbjSWzfrVoV-o8vgYxFiMiivw9v_WUv9r2ejay5prrDaSuFNSYYYEbj/exec";
    function submitToGoogleSheet() {
      const submitBtn = document.getElementById('submit-btn');
      const statusDiv = document.getElementById('submit-status');
      const loader = document.getElementById('loader');
      if (!summaryData) {
        statusDiv.innerHTML = '<span class="submit-status failed"><span class="material-icons">error</span>No data to submit.</span>';
        return;
      }
      let requiredFields = ["userType", "from", "to", "distance", "estimatedTime", "price", "phone", "preferredMode"];
      for (const key of requiredFields) {
        if (!summaryData[key] || (typeof summaryData[key] === "string" && summaryData[key].trim() === "")) {
          statusDiv.innerHTML = '<span class="submit-status failed"><span class="material-icons">error</span>Please complete all required information before submitting.</span>';
          return;
        }
      }
      summaryData.timestamp = new Date().toISOString();
      submitBtn.disabled = true;
      loader.style.display = "block";
      statusDiv.innerHTML = 'Submitting...';
      const data = summaryData;
      const formBody = Object.keys(data)
        .map(k => encodeURIComponent(k) + "=" + encodeURIComponent(data[k]))
        .join("&");
      fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: formBody
      })
      .then(r => {
        if (r.ok) return r.json();
        else throw new Error("Network response was not ok");
      })
      .then(j => {
        loader.style.display = "none";
        statusDiv.innerHTML = '<span class="submit-status success"><span class="material-icons">check_circle</span>Submitted successfully!</span>';
        submitBtn.disabled = false;
      })
      .catch(() => {
        loader.style.display = "none";
        statusDiv.innerHTML = '<span class="submit-status failed"><span class="material-icons">error</span>Submission failed. Try again.</span>';
        submitBtn.disabled = false;
      });
    }
  </script>
</body>
                                                                                    </html>
