<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZamTaxi | Book a Ride</title>
  <meta property="og:image" content="https://zamlisting.com/taxi.webp" />
  <meta property="og:image:secure_url" content="https://zamlisting.com/taxi.webp" />
  <meta property="og:image:width" content="220" />
  <meta property="og:image:height" content="120" />
  <meta property="og:url" content="https://zamlisting.com/taxi" />
  <meta property="og:title" content="ZamTaxi | Book a Ride" />
  <meta property="og:description" content="Book your taxi ride in Lusaka! Choose vehicle or motorbike, enter trip details, and submit via SMS or WhatsApp." />
  <meta property="og:type" content="website" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary-color: #2563eb;
      --secondary-color: #ff9900;
      --success-color: #1aaf5d;
      --whatsapp-color: #25d366;
      --fail-color: #dc2626;
      --bg-color-body: #f5f5f5;
      --bg-color-card: #ffffff;
      --bg-color-input: #f5f7fa;
      --border-color-light: #ccc;
      --border-color-blue: #2563eb;
      --box-shadow-light: 0 2px 5px rgba(0,0,0,0.1);
      --box-shadow-strong: 0 4px 8px rgba(0, 0, 0, 0.2);
      --font-color-dark: #333;
      --font-color-medium: #2d3a4a;
    }
    body { font-family: 'Roboto', Arial, sans-serif; background-color: var(--bg-color-body); color: var(--font-color-dark); }
    header {
      background: var(--font-color-dark); color: white; padding: 20px; text-align: left;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .header-content {
      max-width: 1200px; margin: auto; display: flex; flex-wrap: wrap;
      justify-content: space-between; align-items: center; gap: 15px;
    }
    .company-info { flex: 1 1 60%; }
    .company-info h2 { font-size: 1.4rem; color: var(--secondary-color); }
    .company-info ul { list-style: none; margin-top: 8px; }
    .company-info li { margin-bottom: 5px; font-size: 0.95rem; }
    .price-tag {
      font-size: 1.3rem; font-weight: bold; background: #e67e22;
      padding: 8px 15px; border-radius: 5px; color: white;
    }
    .product-container {
      max-width: 1200px; margin: 30px auto; padding: 0 20px;
      display: flex; flex-wrap: wrap; gap: 30px;
      justify-content: center;
    }
    .booking-section {
      flex: 1 1 100%;
      min-width: 300px;
    }
    .booking-container {
      background: var(--bg-color-card); border-radius: 8px;
      box-shadow: var(--box-shadow-strong);
      padding: 20px;
    }
    .inputs-wrapper { display: flex; flex-direction: column; gap: 15px; margin: 15px 0; }
    .input-group {
      position: relative; background: var(--bg-color-input); border-radius: 5px;
      padding: 10px 10px 10px 40px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .input-group label {
      font-weight: bold; color: var(--primary-color); font-size: 0.9rem;
      margin-bottom: 5px; display: block;
    }
    .input-group .material-icons.input-icon {
      position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
      color: var(--primary-color); font-size: 20px; opacity: 0.85;
    }
    .input-group .material-icons.validation-tick {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--success-color);
        font-size: 24px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .input-group.valid .validation-tick {
      opacity: 1;
    }
    input, select {
      width: 100%; padding: 10px; font-size: 1rem; border-radius: 5px;
      border: 1px solid var(--border-color-light); transition: border 0.2s, box-shadow 0.2s;
      background-color: transparent;
      box-sizing: border-box;
    }
    input:focus, select:focus {
      border: 1px solid var(--border-color-blue); box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    }
    .mode-group {
      display: flex; gap: 10px; flex-wrap: wrap;
    }
    .mode-radio {
      display: flex; align-items: center; gap: 5px; font-size: 0.95rem;
      cursor: pointer;
    }
    .mode-radio input[type="radio"] {
      display: none;
    }
    .heart-icon {
      font-size: 20px;
      color: #ccc;
      transition: color 0.2s ease;
    }
    .heart-icon::before {
      content: "‚ô°";
    }
    .mode-radio input[type="radio"]:checked + .heart-icon {
      color: var(--primary-color);
    }
    .mode-radio input[type="radio"]:checked + .heart-icon::before {
      content: "‚ô•";
    }
    .input-group.valid input,
    .input-group.valid select {
      display: none;
    }
    .masked-value {
      display: none;
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid var(--border-color-light);
      background-color: var(--bg-color-card);
      color: var(--font-color-dark);
      cursor: pointer;
      min-height: 40px;
    }
    .input-group.valid .masked-value {
      display: block;
    }
    .summary-table-section {
      margin-top: 20px; padding: 15px; background: var(--bg-color-card);
      border-radius: 8px; box-shadow: var(--box-shadow-light);
    }
    .section-title {
      font-weight: bold; color: var(--primary-color); font-size: 1.1rem;
      margin-bottom: 10px; display: flex; align-items: center; gap: 5px;
    }
    #summary-table-container {
      width: 100%;
    }
    .table-responsive {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    table.summary-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      background: #f9fbfd;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      white-space: nowrap;
    }
    table.summary-table th, table.summary-table td {
      border: 1px solid #dbeafe;
      padding: 8px;
      text-align: left;
    }
    table.summary-table th {
      background-color: #e7f0fe; color: #222; font-weight: bold;
    }
    table.summary-table td { color: var(--font-color-medium); font-weight: 500; }
    .summary-actions-row {
      display: flex; gap: 15px; justify-content: center; margin: 10px 0; align-items: center;
      flex-wrap: wrap;
    }
    .button-wrapper {
      display: flex; align-items: center; gap: 5px;
    }
    .button-label {
      font-size: 0.95rem; color: var(--font-color-dark); font-weight: 500;
    }
    .fa {
      padding: 10px;
      font-size: 24px;
      width: 44px;
      height: 44px;
      line-height: 24px;
      text-align: center;
      text-decoration: none;
      margin: 5px;
      border-radius: 50%;
      color: white;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .fa-map { background: var(--primary-color); }
    .fa-send-o { background: var(--primary-color); }
    .map-btn:hover { background: #174ea6; }
    .submit-btn:hover { background: #138244; }
    .map-btn[disabled], .submit-btn[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .loader {
      display: none; width: 20px; height: 20px; border: 3px solid var(--primary-color);
      border-radius: 50%; border-top: 3px solid #e5e7eb;
      animation: spin 1s linear infinite; margin: 10px auto;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .submit-status {
      display: flex; align-items: center; gap: 5px; margin-top: 10px;
      justify-content: center; font-weight: 500;
    }
    .submit-status.success { color: var(--success-color); }
    .submit-status.failed { color: var(--fail-color); }
    .submit-status.info { color: var(--primary-color); }
    .material-icons { font-size: 20px; vertical-align: middle; }
    .share-options {
      display: none;
      justify-content: center;
      gap: 15px;
      margin-top: 10px;
    }
    .hidden-value {
      display: none;
      color: green;
      font-weight: bold;
    }
    .eye-btn {
      cursor: pointer;
      font-size: 18px;
    }
    @media (min-width: 768px) {
      .booking-section {
        flex: 1 1 50%;
      }
    }
    .option-group {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        align-items: flex-start;
    }
    .radio-group, .checkbox-group, .locations-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      border: 1px solid var(--border-color-light);
      border-radius: 5px;
      padding: 10px;
      background: #f9fbfd;
      flex-grow: 1;
      flex-basis: 0;
    }
    .radio-group {
      flex-direction: row;
      gap: 20px;
    }
    .radio-group legend, .checkbox-group legend, .locations-group legend {
      font-weight: bold;
      color: var(--primary-color);
      font-size: 0.95rem;
      padding: 0 5px;
      margin-bottom: 5px;
    }
    .radio-item, .checkbox-item {
      display: flex;
      align-items: center;
      cursor: pointer;
      gap: 10px;
      font-size: 1rem;
    }
    .radio-item label, .checkbox-item label {
        font-size: 0.85rem;
    }
    .radio-item input[type="radio"], .checkbox-item input[type="checkbox"] {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid var(--primary-color);
      border-radius: 4px;
      outline: none;
      cursor: pointer;
      position: relative;
    }
    .radio-item input[type="radio"] {
        border-radius: 50%;
    }
    .radio-item input[type="radio"]:checked:after {
        content: '';
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: var(--primary-color);
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    .checkbox-item input[type="checkbox"]:checked {
      background-color: var(--primary-color);
    }
    .checkbox-item input[type="checkbox"]:checked:after {
      content: '‚úî';
      color: white;
      font-size: 14px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    /* Make both fieldsets equal width on larger screens */
    .radio-group,
    .checkbox-group {
        flex: 1;
        min-width: 150px;
    }
    .locations-group {
        flex: 1 1 100%;
    }
    .hidden-section {
      display: none;
    }
    .locations-wrapper {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    @media (min-width: 500px) {
        .locations-wrapper {
            flex-direction: row;
        }
        .locations-wrapper .input-group {
            flex-grow: 1;
        }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="company-info">
        <h2>ZamListing Booking</h2>
        <ul>
          <li><strong>Location:</strong> Luangwa, Zambia</li>
        </ul>
      </div>
      <div>
        <div class="price-tag">Book Your Ride Now!</div>
      </div>
    </div>
  </header>
  <main class="product-container">
    <section class="booking-section">
      <div class="booking-container">
        <div class="inputs-wrapper">
          <div class="input-group" id="customer-phone-wrapper">
            <span class="material-icons input-icon">phone</span>
            <label for="customer-phone">Phone Number</label>
            <input
              type="tel"
              id="customer-phone"
              maxlength="10"
              placeholder="0XXXXXXXXX"
              autocomplete="off"
              inputmode="numeric"
            >
            <span class="masked-value" id="masked-phone"></span>
          </div>
          <div id="trip-details" class="hidden-section">
            <div class="input-group" id="service-wrapper">
              <span class="material-icons input-icon">commute</span>
              <label>Trip Customization</label>
              <div class="option-group">
                  <fieldset class="radio-group">
                      <legend>Transport Mode</legend>
                      <div class="radio-item">
                          <input type="radio" id="mode-vehicle" name="mode" value="vehicle">
                          <label for="mode-vehicle">Vehicle üöó</label>
                      </div>
                      <div class="radio-item">
                          <input type="radio" id="mode-motorbike" name="mode" value="motorbike">
                          <label for="mode-motorbike">Motorbike üèçÔ∏è</label>
                      </div>
                  </fieldset>
                  <fieldset class="checkbox-group">
                      <legend>Additions</legend>
                      <div class="checkbox-item">
                          <input type="checkbox" id="extra-luggage-checkbox" name="extra-luggage" value="yes">
                          <label for="extra-luggage-checkbox">Luggage/Extra-Personsüß≥üë§</label>
                      </div>
                  </fieldset>
              </div>
            </div>
            <div class="input-group">
              <span class="material-icons input-icon">location_on</span>
              <fieldset class="locations-group">
                  <legend>Trip Locations</legend>
                  <div class="locations-wrapper">
                    <div class="input-group">
                      <span class="material-icons input-icon">place</span>
                      <label for="gm-origin">From</label>
                      <select id="gm-origin"></select>
                      <span class="masked-value" id="masked-origin"></span>
                    </div>
                    <div class="input-group">
                      <span class="material-icons input-icon">flag</span>
                      <label for="gm-destination">To</label>
                      <select id="gm-destination"></select>
                      <span class="masked-value" id="masked-destination"></span>
                    </div>
                  </div>
              </fieldset>
            </div>
          </div>
        </div>
        <div class="summary-table-section hidden-section">
          <div class="section-title">
            <span class="material-icons">table_chart</span>
            Trip Summary
          </div>
          <div id="summary-table-container"></div>
          <p style="text-align: center; font-style: italic; font-size: 0.85rem; color: #666; margin-top: 10px;">
            Review and verify all trip information.
          </p>
          <div class="summary-actions-row">
            <div class="button-wrapper">
              <a href="#" class="fa fa-send-o" id="submit-btn" title="Submit Trip Details"></a>
              <span class="button-label">Submit Trip</span>
            </div>
          </div>
        </div>
        <div id="submit-status" class="submit-status">Please fill in all details correctly.</div>
        <div id="loader" class="loader"></div>
      </div>
    </section>
  </main>
  <script>
    const config = {
      vehiclePricePerKm: 6.0,
      motorbikePricePerKm: 3.0,
      vehicleMinPrice: 20,
      motorbikeMinPrice: 10,
      avgSpeed: 60,
    };
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzN_LoIE8sb7H9wuhzIz8kYNqNd-0aWCSS2t0duusBaLqC2DjcK3Affih3Q-3R3QhE/exec";
    const places = [
      "Anglican Church", "Big 2 Zambezi Water Front Resort & Safari", "BM residence", "Boma Clinic","Chidada Ground", "Chitope", "Chilombwe Community School","Chiriwe Primary School",
      "Dzalo Skills Training Centre kambolozo", "Feira Kindom Hall", "Feira Day Secondary School", "Gerasmos Safari Lodge", "Hill View", "JB THREE BOARDERS MALL", "JB THREE BOARDERS CLUB", 
      "Justifeli Lodge", "Kakaro Primary School", "Kantuleni executive Lodge", "Kapoche", "Kasinsa",
      "Katondwe Mission Hospital", "Kavalamanja", "Luangwa (Feira)", "Luangwa Basic School", "Luangwa Bridge", "Luangwa Bridge Market",
      "Luangwa Council lodge", "Luangwa District Comission office", "Luangwa District Education Board Offices",
      "Luangwa District Hospital","Luangwa High School Police post", "Luangwa Filling Station", "Luangwa Habour", "Luangwa Indeco", "Luangwa Market",
      "Luangwa main sda churh", "Luangwa Police Station", "Luangwa Post Office", "Luangwa Town Council", "Luangwa Secondary School", "Makichilo Lodge",
      "Mwavi Secondary School","Mwalila Primary School", "Pentocostal Assembly of God Joshua Assembly", "UCZ","Soweto Junction", "Registration Office", "Yangoma Hotel", "yellow shop",
      "Zambia Electricity Supply Corporation"
    ];
    const segments = [
      { from: "Anglican Church", to: "Feira Kindom Hall", distance: 0.1 },
      { from: "Anglican Church", to: "Feira Day Secondary School", distance: 3.5 },
      
      { from: "Anglican Church", to: "Luangwa (Feira)", distance: 0.75 },
      { from: "Anglican Church", to: "Luangwa Town Council", distance: 0.80 },
      { from: "Big 2 Zambezi Water Front Resort & Safari", to: "Feira Day Secondary School", distance: 4.0 },
      { from: "BM residence", to: "Boma Clinic", distance: 0.6 },
      { from: "BM residence", to: "Hill View", distance: 1.0},
      { from: "BM residence", to: "Registration Office", distance: 1.89 },
      { from: "BM residence", to: "Chidada Ground", distance: 2.50 },
      { from: "BM residence", to: "JB THREE BOARDERS MALL", distance: 3.8 },
      { from: "BM residence", to: "Feira Day Secondary School", distance: 1.1 },
      { from: "Boma Clinic", to: "Dzalo Skills Training Centre kambolozo", distance: 0.2 },
      { from: "Luangwa Town Council", to: "Dzalo Skills Training Centre kambolozo", distance: 0.60 },
      { from: "Chilombwe Community School", to: "Feira Day Secondary School", distance: 14 },
      { from: "Chiriwe Primary School", to: "JB THREE BOARDERS MALL", distance: 46.8 },
      { from: "Chitope", to: "Kasinsa", distance: 10 },
      { from: "Chitope", to: "Luangwa Bridge", distance: 32 },
      { from: "Chitope", to: "Luangwa Bridge Market", distance: 29 },
      { from: "Chitope", to: "Luangwa Secondary School", distance: 14 },
      { from: "Dzalo Skills Training Centre kambolozo", to: "Luangwa Filling Station", distance: 0.3 },
      { from: "Feira Kindom Hall", to: "Luangwa (Feira)", distance: 0.7 },
      { from: "Feira Day Secondary School", to: "Gerasmos Safari Lodge", distance: 3.1 },
      { from: "Feira Day Secondary School", to: "Justifeli Lodge", distance: 2.2 },
      { from: "Feira Day Secondary School", to: "Katondwe Mission Hospital", distance: 48 },
      { from: "Feira Day Secondary School", to: "Luangwa Secondary School", distance: 4.1 },
      { from: "Feira Day Secondary School", to: "Mwalila Primary School", distance: 68 },
      { from: "Feira Day Secondary School", to: "yellow shop", distance: 3.3 },
      { from: "Feira Day Secondary School", to: "Zambia Electricity Supply Corporation", distance: 2.0 },
      { from: "Gerasmos Safari Lodge", to: "Justifeli Lodge", distance: 2.0 },
      { from: "Gerasmos Safari Lodge", to: "Luangwa Secondary School", distance: 1.0 },
      { from: "JB THREE BOARDERS MALL", to: "yellow shop", distance: 0.41 },
      { from: "JB THREE BOARDERS MALL", to: "JB THREE BOARDERS CLUB", distance: 0.50 },
      { from: "JB THREE BOARDERS MALL", to: "Soweto Junction", distance: 2.00 },
      { from: "Justifeli Lodge", to: "Luangwa main sda churh", distance: 0.9 },
      { from: "Justifeli Lodge", to: "Luangwa District Education Board Offices", distance: 2.0 },
      { from: "Kakaro Primary School", to: "Luangwa (Feira)", distance: 12 },
      { from: "Kantuleni executive Lodge", to: "Luangwa Filling Station", distance: 0.190 },
      { from: "Kapoche", to: "Luangwa (Feira)", distance: 28 },
      { from: "Kasinsa", to: "Katondwe Mission Hospital", distance: 16 },
      { from: "Katondwe Mission Hospital", to: "Luangwa (Feira)", distance: 52 },
      { from: "Katondwe Mission Hospital", to: "Mwavi Secondary School", distance: 7.2 },
      { from: "Kavalamanja", to: "Luangwa District Hospital", distance: 23 },
      { from: "Luangwa (Feira)", to: "Luangwa Basic School", distance: 0.7 },
      { from: "Luangwa (Feira)", to: "Luangwa Council lodge", distance: 1.15 },
      { from: "Luangwa (Feira)", to: "Luangwa District Hospital", distance: 4.6 },
      { from: "Luangwa (Feira)", to: "Luangwa Filling Station", distance: 1.8 },
      { from: "Luangwa (Feira)", to: "Luangwa Habour", distance: 0.9 },
      { from: "Luangwa (Feira)", to: "Luangwa Indeco", distance: 0.9 },
      { from: "Luangwa (Feira)", to: "Luangwa Market", distance: 0.40 },
      { from: "Luangwa (Feira)", to: "Luangwa Police Station", distance: 0.55 },
      { from: "Luangwa (Feira)", to: "Luangwa Post Office", distance: 1.65 },
      { from: "Luangwa (Feira)", to: "Makichilo Lodge", distance: 0.40 },
      { from: "Luangwa (Feira)", to: "Pentocostal Assembly of God Joshua Assembly", distance: 0.6 },
      { from: "Luangwa (Feira)", to: "UCZ", distance: 0.5 },
      { from: "Luangwa Basic School", to: "Luangwa Market", distance: 0.45 },
      { from: "Luangwa Bridge", to: "Luangwa Bridge Market", distance: 12.7 },
      { from: "Luangwa Council lodge", to: "Yangoma Hotel", distance: 0.15 },
      { from: "Luangwa Council lodge", to: "Luangwa High School Police post", distance: 49.0 },
      { from: "Luangwa Council lodge", to: "Zambia Electricity Supply Corporation", distance: 2.4 },
      { from: "Luangwa District Hospital", to: "Zambia Electricity Supply Corporation", distance: 2.8 },
      { from: "Luangwa Filling Station", to: "Yangoma Hotel", distance: 0.7 },
      { from: "Luangwa Habour", to: "Luangwa Market", distance: 0.5 },
      { from: "Luangwa Indeco", to: "Luangwa Council lodge", distance: 0.25 },
      { from: "Luangwa Indeco", to: "yellow shop", distance: 0.45 },
      { from: "Luangwa main sda churh", to: "Justifeli Lodge", distance: 0.9 },
      { from: "Luangwa main sda churh", to: "Zambia Electricity Supply Corporation", distance: 0.65 },
      { from: "Luangwa Police Station", to: "Luangwa Post Office", distance: 1.1 },
      { from: "Luangwa Post Office", to: "Luangwa District Comission office", distance: 0.25 },
      { from: "Mwavi Secondary School", to: "Chitope", distance: 1.1 }
    ];
    const originSelect = document.getElementById('gm-origin');
    const destinationSelect = document.getElementById('gm-destination');
    const customerPhoneInput = document.getElementById('customer-phone');
    const modeVehicleRadio = document.getElementById('mode-vehicle');
    const modeMotorbikeRadio = document.getElementById('mode-motorbike');
    const extraLuggageCheckbox = document.getElementById('extra-luggage-checkbox');
    const summaryTableSection = document.querySelector('.summary-table-section');
    const summaryTableContainer = document.getElementById('summary-table-container');
    const submitBtn = document.getElementById('submit-btn');
    const submitStatusDiv = document.getElementById('submit-status');
    const loader = document.getElementById('loader');
    const maskedPhone = document.getElementById('masked-phone');
    const maskedOrigin = document.getElementById('masked-origin');
    const maskedDestination = document.getElementById('masked-destination');
    const tripDetails = document.getElementById('trip-details');
    let summaryData = null;
    function populateDropdowns() {
      const defaultOptionOrigin = document.createElement('option');
      defaultOptionOrigin.value = "";
      defaultOptionOrigin.textContent = "Select...";
      defaultOptionOrigin.disabled = true;
      defaultOptionOrigin.selected = true;
      originSelect.appendChild(defaultOptionOrigin);
      const defaultOptionDestination = document.createElement('option');
      defaultOptionDestination.value = "";
      defaultOptionDestination.textContent = "Select...";
      defaultOptionDestination.disabled = true;
      defaultOptionDestination.selected = true;
      destinationSelect.appendChild(defaultOptionDestination);
      const sortedPlaces = places.slice().sort();
      sortedPlaces.forEach(place => {
        const option1 = document.createElement('option');
        option1.value = place;
        option1.textContent = place;
        originSelect.appendChild(option1);
        const option2 = document.createElement('option');
        option2.value = place;
        option2.textContent = place;
        destinationSelect.appendChild(option2);
      });
    }
    function buildGraph(segments) {
      const graph = {};
      segments.forEach(seg => {
        if (!graph[seg.from]) graph[seg.from] = [];
        if (!graph[seg.to]) graph[seg.to] = [];
        graph[seg.from].push({ place: seg.to, distance: seg.distance });
        graph[seg.to].push({ place: seg.from, distance: seg.distance });
      });
      return graph;
    }
    function findShortestDistance(from, to, segments) {
      const graph = buildGraph(segments);
      if (!graph[from] || !graph[to]) return null;
      const distances = {};
      const visited = new Set();
      places.forEach(place => distances[place] = Infinity);
      distances[from] = 0;
      let queue = [{ place: from, dist: 0 }];
      while (queue.length > 0) {
        queue.sort((a, b) => a.dist - b.dist);
        const { place, dist } = queue.shift();
        if (place === to) return dist;
        if (visited.has(place)) continue;
        visited.add(place);
        for (let neighbor of (graph[place] || [])) {
          if (dist + neighbor.distance < distances[neighbor.place]) {
            distances[neighbor.place] = dist + neighbor.distance;
            queue.push({ place: neighbor.place, dist: distances[neighbor.place] });
          }
        }
      }
      return null;
    }
    function updateValidationStatus(element, isValid) {
        const parentGroup = element.closest('.input-group');
        if (isValid) {
            parentGroup.classList.add('valid');
        } else {
            parentGroup.classList.remove('valid');
        }
    }
    function maskInputValues(origin, destination, phone) {
      const isPhoneValid = phone.match(/^0[0-9]{9}$/);
      updateValidationStatus(customerPhoneInput, isPhoneValid);
      maskedPhone.textContent = '**********';
      
      const isOriginValid = origin && origin !== '';
      updateValidationStatus(originSelect, isOriginValid);
      maskedOrigin.textContent = '**********';
      
      const isDestinationValid = destination && destination !== '';
      updateValidationStatus(destinationSelect, isDestinationValid);
      maskedDestination.textContent = '**********';
    }
    function resetValidation(event) {
      const parentGroup = event.target.closest('.input-group');
      parentGroup.classList.remove('valid');
      summaryTableContainer.innerHTML = '';
      submitBtn.classList.add('disabled');
      submitBtn.setAttribute('disabled', 'true');
      summaryData = null;
      displayStatus('Please fill in all details correctly.', 'failed');
      summaryTableSection.classList.add('hidden-section');
    }
    function reveal(eye) {
      document.querySelectorAll(".hidden-value").forEach(v => v.style.display = "none");
      document.querySelectorAll(".eye-btn").forEach(e => e.style.display = "inline");
      let value = eye.previousElementSibling;
      value.style.display = "inline";
      eye.style.display = "none";
    }
    function updateSummaryTable() {
      const origin = originSelect.value;
      const destination = destinationSelect.value;
      const customerPhone = customerPhoneInput.value.trim();
      
      const isVehicleSelected = modeVehicleRadio.checked;
      const isMotorbikeSelected = modeMotorbikeRadio.checked;
      const isExtraLuggageChecked = extraLuggageCheckbox.checked;
      
      summaryTableContainer.innerHTML = '';
      submitBtn.classList.add('disabled');
      submitBtn.setAttribute('disabled', 'true');
      summaryData = null;
      
      const isOriginValid = origin && origin !== '';
      const isDestinationValid = destination && destination !== '';
      const isPhoneValid = customerPhone.match(/^0[0-9]{9}$/);
      const isModeSelected = isVehicleSelected || isMotorbikeSelected;
      
      maskInputValues(origin, destination, customerPhone);
      
      if (!isOriginValid || !isDestinationValid || !isPhoneValid || !isModeSelected) {
          summaryTableSection.classList.add('hidden-section');
          displayStatus('Please fill in all details correctly.', 'info');
          return;
      }
      
      const mode = isVehicleSelected ? 'Vehicle' : 'Motorbike';
      const hasExtraLuggage = isExtraLuggageChecked;
      const distance = findShortestDistance(origin, destination, segments);
      
      if (distance === null || isNaN(distance)) {
        summaryTableSection.classList.add('hidden-section');
        displayStatus('A route could not be found between the selected places.', 'failed');
        return;
      }
      
      const timeHours = distance / config.avgSpeed;
      const wholeHours = Math.floor(timeHours);
      const minutes = Math.round((timeHours - wholeHours) * 60);
      let price = 0;
      
      if (mode === 'Vehicle') {
        price = distance * config.vehiclePricePerKm;
        price = Math.max(price, config.vehicleMinPrice);
      } else {
        price = distance * config.motorbikePricePerKm;
        price = Math.max(price, config.motorbikeMinPrice);
      }
      
      if (hasExtraLuggage) {
        price = price * 1.25;
      }
      
      price = Math.round(price);
      let timeText = '';
      if (wholeHours > 0) {
        timeText += `${wholeHours} hr`;
        if (minutes > 0) timeText += ` ${minutes} min`;
      } else {
        timeText += `${minutes} min`;
      }
      
      const tableHTML = `
        <div class="table-responsive">
          <table class="summary-table">
            <thead>
              <tr>
                <th>Mode</th>
                <th>Extra Luggage</th>
                <th>Phone</th>
                <th>From</th>
                <th>To</th>
                <th>Distance (km)</th>
                <th>Time</th>
                <th>Price (K)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <span class="hidden-value">${mode}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value">${hasExtraLuggage ? 'Yes' : 'No'}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value">${customerPhone}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value">${origin}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value">${destination}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value">${distance.toFixed(2)}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value">${timeText}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value"><b>K${price}</b></span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      `;
      summaryTableContainer.innerHTML = tableHTML;
      summaryData = {
        preferredMode: mode,
        extraLuggage: hasExtraLuggage ? 'Yes' : 'No',
        phone: customerPhone,
        from: origin,
        to: destination,
        distance: distance.toFixed(2),
        estimatedTime: timeText,
        price: price
      };
      summaryTableSection.classList.remove('hidden-section');
      displayStatus('Trip details calculated. Click submit to send your request.', 'success');
      submitBtn.classList.remove('disabled');
      submitBtn.removeAttribute('disabled');
    }
    
    function submitToGoogleSheet() {
      if (!summaryData) {
        displayStatus('No data to submit.', 'failed');
        return;
      }
      const timestamp = new Date().toLocaleString("en-US", { timeZone: "Africa/Lusaka" });
      const payload = {
        "preferredMode": summaryData.preferredMode,
        "extraLuggage": summaryData.extraLuggage,
        "phone": summaryData.phone,
        "from": summaryData.from,
        "to": summaryData.to,
        "distance": summaryData.distance,
        "estimatedTime": summaryData.estimatedTime,
        "price": summaryData.price,
        "timestamp": timestamp
      };
      const formBody = new URLSearchParams(payload);
      displayStatus('Submitting...', 'info');
      loader.style.display = 'block';
      submitBtn.setAttribute('disabled', 'true');
      fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        body: formBody,
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
      })
      .then(response => {
        loader.style.display = 'none';
        displayStatus('Booking request sent successfully! You will be contacted shortly.', 'success');
        submitBtn.removeAttribute('disabled');
      })
      .catch(error => {
        loader.style.display = 'none';
        submitBtn.removeAttribute('disabled');
        console.error('Submission error:', error);
      });
    }
    
    function displayStatus(message, type) {
      submitStatusDiv.innerHTML = `<span class="material-icons">${type === 'success' ? 'check_circle' : type === 'failed' ? 'error' : 'info'}</span> ${message}`;
      submitStatusDiv.className = `submit-status ${type}`;
    }
    
    function handlePhoneNumberInput() {
        const customerPhone = customerPhoneInput.value.trim();
        const isPhoneValid = customerPhone.match(/^0[0-9]{9}$/);
        
        if (isPhoneValid) {
            tripDetails.classList.remove('hidden-section');
            updateSummaryTable();
        } else {
            tripDetails.classList.add('hidden-section');
            summaryTableSection.classList.add('hidden-section');
            displayStatus('Please fill in all details correctly.', 'info');
        }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      populateDropdowns();
      
      // Event listener for phone number input
      customerPhoneInput.addEventListener('input', handlePhoneNumberInput);
      
      // Event listeners for other inputs (only appear after phone is entered)
      modeVehicleRadio.addEventListener('change', updateSummaryTable);
      modeMotorbikeRadio.addEventListener('change', updateSummaryTable);
      extraLuggageCheckbox.addEventListener('change', updateSummaryTable);
      originSelect.addEventListener('change', updateSummaryTable);
      destinationSelect.addEventListener('change', updateSummaryTable);
    });
    
    // Reset validation for masked values
    maskedPhone.addEventListener('click', resetValidation);
    maskedOrigin.addEventListener('click', resetValidation);
    maskedDestination.addEventListener('click', resetValidation);
    
    submitBtn.addEventListener('click', (e) => {
      e.preventDefault();
      submitToGoogleSheet();
    });
  </script>
</body>
</html>
