<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luangwa Feira Rides| Book a Ride</title>
  <meta property="og:image" content="https://zamlisting.com/taxi.webp" />
  <meta property="og:image:secure_url" content="https://zamlisting.com/taxi.webp" />
  <meta property="og:image:width" content="220" />
  <meta property="og:image:height" content="120" />
  <meta property="og:url" content="https://zamlisting.com/taxi" />
  <meta property="og:title" content="Luangwa Feira Rides| Book a Ride" />
  <meta property="og:description" content="Book your taxi ride in Lusaka! Choose vehicle or motorbike, enter trip details, and submit via SMS or WhatsApp." />
  <meta property="og:type" content="website" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary-color: #2563eb;
      --secondary-color: #ff9900;
      --success-color: #1aaf5d;
      --whatsapp-color: #25d366;
      --fail-color: #dc2626;
      --bg-color-body: #f5f5f5;
      --bg-color-card: #ffffff;
      --bg-color-input: #f5f7fa;
      --border-color-light: #ccc;
      --border-color-blue: #2563eb;
      --box-shadow-light: 0 2px 5px rgba(0,0,0,0.1);
      --box-shadow-strong: 0 4px 8px rgba(0, 0, 0, 0.2);
      --font-color-dark: #333;
      --font-color-medium: #2d3a4a;
    }
    body { font-family: 'Roboto', Arial, sans-serif; background-color: var(--bg-color-body); color: var(--font-color-dark); }
    header {
      background: var(--font-color-dark); color: white; padding: 20px; text-align: left;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    /* Updated .header-content and .footer-content-wrapper to share content alignment */
    .header-content, .footer-content-wrapper { 
      max-width: 1200px; 
      margin: auto; 
      padding: 0 20px; 
    }
    .header-content {
      display: flex; flex-wrap: wrap;
      justify-content: space-between; align-items: center; gap: 15px;
    }
    .company-info { flex: 1 1 60%; }
    .company-info h2 { font-size: 1.4rem; color: var(--secondary-color); }
    .company-info ul { list-style: none; margin-top: 8px; }
    .company-info li { margin-bottom: 5px; font-size: 0.95rem; }
    .price-tag {
      font-size: 1.3rem; font-weight: bold; background: #e67e22;
      padding: 8px 15px; border-radius: 5px; color: white;
    }
    .product-container {
      max-width: 1200px; margin: 30px auto; padding: 0 20px;
      display: flex; flex-wrap: wrap; gap: 30px;
      justify-content: center;
    }
    .booking-section {
      flex: 1 1 100%;
      min-width: 300px;
    }
    .booking-container {
      background: var(--bg-color-card); border-radius: 8px;
      box-shadow: var(--box-shadow-strong);
      padding: 20px;
    }
    .inputs-wrapper { display: flex; flex-direction: column; gap: 15px; margin: 15px 0; }
    .input-group {
      position: relative; background: var(--bg-color-input); border-radius: 5px;
      padding: 10px 10px 10px 40px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .input-group label {
      font-weight: bold; color: var(--primary-color); font-size: 0.9rem;
      margin-bottom: 5px; display: block;
    }
    .input-group .material-icons.input-icon {
      position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
      color: var(--primary-color); font-size: 20px; opacity: 0.85;
    }
    .input-group .material-icons.validation-tick {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--success-color);
        font-size: 24px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .input-group.valid .validation-tick {
      opacity: 1;
    }
    input[type="text"], input[type="tel"], select { /* Added input[type="text"] */
      width: 100%; padding: 10px; font-size: 1rem; border-radius: 5px;
      border: 1px solid var(--border-color-light); transition: border 0.2s, box-shadow 0.2s;
      background-color: transparent;
      box-sizing: border-box;
    }
    input:focus, select:focus {
      border: 1px solid var(--border-color-blue); box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    }
    .mode-group {
      display: flex; gap: 10px; flex-wrap: wrap;
    }
    .mode-radio {
      display: flex; align-items: center; gap: 5px; font-size: 0.95rem;
      cursor: pointer;
    }
    .mode-radio input[type="radio"] {
      display: none;
    }
    .heart-icon {
      font-size: 20px;
      color: #ccc;
      transition: color 0.2s ease;
    }
    .heart-icon::before {
      content: "‚ô°";
    }
    .mode-radio input[type="radio"]:checked + .heart-icon {
      color: var(--primary-color);
    }
    .mode-radio input[type="radio"]:checked + .heart-icon::before {
      content: "‚ô•";
    }
    .input-group.valid input[type="text"],
    .input-group.valid select,
    #customer-phone-wrapper.valid input[type="tel"] { /* Added phone input hiding */
      display: none;
    }
    .masked-value {
      display: none;
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid var(--border-color-light);
      background-color: var(--bg-color-card);
      color: var(--font-color-dark);
      cursor: pointer;
      min-height: 40px;
    }
    .input-group.valid .masked-value {
      display: block;
      font-weight: bold; /* Make the ********** stand out */
      letter-spacing: 2px; /* Spread ********** apart */
    }
    .summary-table-section {
      margin-top: 20px; padding: 15px; background: var(--bg-color-card);
      border-radius: 8px; box-shadow: var(--box-shadow-light);
    }
    .section-title {
      font-weight: bold; color: var(--primary-color); font-size: 1.1rem;
      margin-bottom: 10px; display: flex; align-items: center; gap: 5px;
    }
    #summary-table-container {
      width: 100%;
    }
    .table-responsive {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    table.summary-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      background: #f9fbfd;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      white-space: nowrap;
    }
    table.summary-table th, table.summary-table td {
      border: 1px solid #dbeafe;
      padding: 8px;
      text-align: left;
    }
    table.summary-table th {
      background-color: #e7f0fe; color: #222; font-weight: bold;
    }
    table.summary-table td { color: var(--font-color-medium); font-weight: 500; }
    .summary-actions-row {
      display: flex; gap: 15px; justify-content: center; margin: 10px 0; align-items: center;
      flex-wrap: wrap;
    }
    .button-wrapper {
      display: flex; align-items: center; gap: 5px;
    }
    .button-label {
      font-size: 0.95rem; color: var(--font-color-dark); font-weight: 500;
    }
    .fa {
      padding: 10px;
      font-size: 24px;
      width: 44px;
      height: 44px;
      line-height: 24px;
      text-align: center;
      text-decoration: none;
      margin: 5px;
      border-radius: 50%;
      color: white;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .fa-map { background: var(--primary-color); }
    .fa-send-o { background: var(--primary-color); }
    .map-btn:hover { background: #174ea6; }
    .submit-btn:hover { background: #138244; }
    .map-btn[disabled], .submit-btn[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .loader {
      display: none; width: 20px; height: 20px; border: 3px solid var(--primary-color);
      border-radius: 50%; border-top: 3px solid #e5e7eb;
      animation: spin 1s linear infinite; margin: 10px auto;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .submit-status {
      display: flex; align-items: center; gap: 5px; margin-top: 10px;
      justify-content: center; font-weight: 500;
    }
    .submit-status.success { color: var(--success-color); }
    .submit-status.failed { color: var(--fail-color); }
    .submit-status.info { color: var(--primary-color); }
    .material-icons { font-size: 20px; vertical-align: middle; }
    .share-options {
      display: none;
      justify-content: center;
      gap: 15px;
      margin-top: 10px;
    }
    .hidden-value {
      display: none;
      color: green;
      font-weight: bold;
    }
    .eye-btn {
      cursor: pointer;
      font-size: 18px;
    }
    @media (min-width: 768px) {
      .booking-section {
        flex: 1 1 50%;
      }
    }
    .option-group {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        align-items: flex-start;
    }
    .radio-group, .checkbox-group, .locations-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      border: 1px solid var(--border-color-light);
      border-radius: 5px;
      padding: 10px;
      background: #f9fbfd;
      flex-grow: 1;
      flex-basis: 0;
    }
    .radio-group {
      flex-direction: row;
      gap: 20px;
    }
    .radio-group legend, .checkbox-group legend, .locations-group legend {
      font-weight: bold;
      color: var(--primary-color);
      font-size: 0.95rem;
      padding: 0 5px;
      margin-bottom: 5px;
    }
    .radio-item, .checkbox-item {
      display: flex;
      align-items: center;
      cursor: pointer;
      gap: 10px;
      font-size: 1rem;
    }
    .radio-item label, .checkbox-item label {
        font-size: 0.85rem;
    }
    .radio-item input[type="radio"], .checkbox-item input[type="checkbox"] {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid var(--primary-color);
      border-radius: 4px;
      outline: none;
      cursor: pointer;
      position: relative;
    }
    .radio-item input[type="radio"] {
        border-radius: 50%;
    }
    .radio-item input[type="radio"]:checked:after {
        content: '';
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: var(--primary-color);
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    .checkbox-item input[type="checkbox"]:checked {
      background-color: var(--primary-color);
    }
    .checkbox-item input[type="checkbox"]:checked:after {
      content: '‚úî';
      color: white;
      font-size: 14px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    /* Make both fieldsets equal width on larger screens */
    .radio-group,
    .checkbox-group {
        flex: 1;
        min-width: 150px;
    }
    .locations-group {
        flex: 1 1 100%;
    }
    .hidden-section {
      display: none;
    }
    .locations-wrapper {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    @media (min-width: 500px) {
        .locations-wrapper {
            flex-direction: row;
        }
        .locations-wrapper .input-group {
            flex-grow: 1;
        }
    }
    
    /* Autocomplete Styles */
    .autocomplete-wrapper {
        position: relative;
        width: 100%; /* Important for inputs inside a group */
    }
    .autocomplete-list {
        position: absolute;
        z-index: 100;
        border: 1px solid var(--border-color-light);
        border-top: none;
        background-color: white;
        width: 100%;
        max-height: 200px;
        overflow-y: auto;
        box-shadow: var(--box-shadow-light);
        left: 0;
        top: 100%; /* Position right under the input */
    }
    .suggestion {
        padding: 10px;
        cursor: pointer;
        background-color: white;
        border-bottom: 1px solid #f0f0f0;
        font-size: 0.9rem;
    }
    .suggestion:hover {
        background-color: #f1f1f1;
    }
    .input-group.valid .autocomplete-list {
      display: none; /* Hide list when input is valid/masked */
    }

    /* Footer Styles - ADJUSTED */
    footer {
        width: 100%; /* Full width */
        padding: 0; 
        border-top: 1px solid var(--border-color-light);
        background: var(--bg-color-card);
        box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
        display: none; /* Hidden by default */
    }
    .footer-content-wrapper { 
        /* Inherits max-width: 1200px; margin: auto; padding: 0 20px; */
        text-align: center;
        padding-top: 15px;
        padding-bottom: 15px;
    }
    .footer-actions {
        display: flex;
        justify-content: center;
        gap: 15px; 
        margin-bottom: 15px;
    }
    .footer-btn {
        background-color: var(--primary-color);
        color: white;
        border: none;
        padding: 10px; 
        width: 45px; 
        height: 45px; 
        border-radius: 50%; 
        font-weight: 500;
        font-size: 0.9rem;
        cursor: pointer;
        transition: background-color 0.2s, transform 0.1s;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .footer-btn:hover {
        background-color: #174ea6;
        transform: translateY(-1px);
    }
    .footer-btn .material-icons {
        font-size: 22px; 
        margin: 0; 
    }
    /* Specific styling for the call button */
    #call-btn {
        background-color: var(--success-color);
    }
    #call-btn:hover {
        background-color: #138244;
    }

    .about-dropdown {
        background: #f9fbfd;
        border: 1px solid var(--border-color-light);
        border-left: 3px solid var(--secondary-color);
        border-radius: 5px;
        padding: 15px;
        margin-top: 10px;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
        text-align: left;
        display: none;
        box-shadow: var(--box-shadow-light);
        font-size: 0.9rem;
        color: var(--font-color-medium);
    }
    .about-dropdown h4 {
        color: var(--secondary-color);
        margin-bottom: 5px;
        font-size: 1rem;
    }
  </style>
</head>
<body>
  <header>
  <div class="header-content">
    <div class="company-info">
      <h2>

        Luangwa Feira Rides
      </h2>
      <ul>
        <li><strong>Location:</strong> Luangwa, Zambia</li>
      </ul>
    </div>
    <div>
      <div class="price-tag">Book Your Ride Now!</div>
    </div>
  </div>
</header>
  <main class="product-container">
    <section class="booking-section">
      <div class="booking-container">
        <div class="inputs-wrapper">
          <div class="input-group" id="customer-phone-wrapper">
            <span class="material-icons input-icon">phone</span>
            <label for="customer-phone">Phone Number</label>
            <input
              type="tel"
              id="customer-phone"
              maxlength="10"
              placeholder="0xxxxxxxxx"
              autocomplete="off"
              inputmode="numeric"
            >
            <span class="masked-value" id="masked-phone"></span>
          </div>
          <div id="trip-details" class="hidden-section">
            <div class="input-group" id="service-wrapper">
              <span class="material-icons input-icon">commute</span>
              <label>Trip Customization</label>
              <div class="option-group">
                  <fieldset class="radio-group">
                      <legend>Transport Mode</legend>
                      <div class="radio-item">
                          <input type="radio" id="mode-vehicle" name="mode" value="vehicle">
                          <label for="mode-vehicle">Vehicle üöó</label>
                      </div>
                      <div class="radio-item">
                          <input type="radio" id="mode-motorbike" name="mode" value="motorbike">
                          <label for="mode-motorbike">Motorbike üèçÔ∏è</label>
                      </div>
                  </fieldset>
                  <fieldset class="checkbox-group">
                      <legend>Additions</legend>
                      <div class="checkbox-item">
                          <input type="checkbox" id="extra-luggage-checkbox" name="extra-luggage" value="yes">
                          <label for="extra-luggage-checkbox">Luggage/Extra-Personsüß≥üë§</label>
                      </div>
                  </fieldset>
              </div>
            </div>
            <div class="input-group">
              <span class="material-icons input-icon">location_on</span>
              <fieldset class="locations-group">
                  <legend>Trip Locations</legend>
                  <div class="locations-wrapper">
                    <div class="autocomplete-wrapper input-group" id="origin-input-group">
                      <span class="material-icons input-icon">place</span>
                      <label for="gm-origin">From</label>
                      <input type="text" id="gm-origin" placeholder="Type Pickup Location..." autocomplete="off">
                      <div id="originList" class="autocomplete-list"></div>
                      <span class="masked-value" id="masked-origin"></span>
                    </div>
                    <div class="autocomplete-wrapper input-group" id="destination-input-group">
                      <span class="material-icons input-icon">flag</span>
                      <label for="gm-destination">To</label>
                      <input type="text" id="gm-destination" placeholder="Type Destination location..." autocomplete="off">
                      <div id="destinationList" class="autocomplete-list"></div>
                      <span class="masked-value" id="masked-destination"></span>
                    </div>
                  </div>
              </fieldset>
            </div>
          </div>
        </div>
        <div class="summary-table-section hidden-section">
          <div class="section-title">
            <span class="material-icons">table_chart</span>
            Trip Summary
          </div>
          <div id="summary-table-container"></div>
          <p style="text-align: center; font-style: italic; font-size: 0.85rem; color: #666; margin-top: 10px;">
            Review and verify all trip information(press on the field üëÄ to check )
          </p>
          <div class="summary-actions-row">
            <div class="button-wrapper">
              <a href="#" class="fa fa-send-o" id="submit-btn" title="Submit Trip Details"></a>
              <span class="button-label">Submit Trip</span>
            </div>
          </div>
        </div>
        <div id="submit-status" class="submit-status">Please fill in all details correctly.</div>
        <div id="loader" class="loader"></div>
      </div>
    </section>
  </main>
  
  <footer id="main-footer">
    <div class="footer-content-wrapper"> <div class="footer-actions">
            <a href="tel:0966423229" class="footer-btn" id="call-btn" title="Call for Inquiry/Complaint">
                <span class="material-icons">call</span>
            </a>
            <button id="about-btn" class="footer-btn" title="About Luangwa Feira Rides">
                <span class="material-icons">info</span>
            </button>
        </div>
        <div id="about-info" class="about-dropdown">
            <h4>About Our Service</h4>
            <p><strong>Location:</strong> Dedicated service provider within the Luangwa Feira area and surrounding locations in Zambia. üáøüá≤</p>
            <p><strong>Affordable:</strong> Our pricing is **cheap and fixed as shown** and competitive, calculated fairly based on distance.</p>
            <p><strong>Reliable:</strong> We are committed to **reliable** and safe transport, ensuring you reach your destination efficiently.</p>
        </div>
        <p style="font-size: 0.8rem; color: #999; margin-top: 15px;"> For inquiries and queries call.</p>
        <p style="font-size: 0.8rem; color: #999; margin-top: 15px;">&copy; 2024 Luangwa Feira Rides. All rights reserved.</p>
    </div>
  </footer>
  
  <script>
    const config = {
      vehiclePricePerKm: 6.0,
      motorbikePricePerKm: 3.0,
      vehicleMinPrice: 20,
      motorbikeMinPrice: 10,
      avgSpeed: 60,
    };
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzN_LoIE8sb7H9wuhzIz8kYNqNd-0aWCSS2t0duusBaLqC2DjcK3Affih3Q-3R3QhE/exec";
    

// Data for Luangwa Town Routes

const places = [
  "Anglican Church", "Airstrip", "Big 2 Zambezi Water Front Resort & Safari", "BM Residence", "Boma Clinic", "Chidada Ground", "Chitope", "Chitope Rural Health Centre", "Chilombwe Community School", "Chiriwe Primary School",
  "Dzalo Skills Training Centre Kambolozo", "Feira Kindom Hall", "Feira Day Secondary School", "Gerasmos Safari Lodge", "Hill View", "JB Three Boarders Mall", "JB Three Boarders Club", 
  "Justifeli Lodge", "Kakaro Primary School", "Kakaro Liberation Heritage Site", "Kantuleni Executive Lodge", "Kapoche", "Kaunga Secondary School", "Kasinsa", "Katondwe Chapel", "Katondwe Chaz Hotel", "Katondwe Dam", 
  "Katondwe Girls Secondary School", "Katondwe Primary School", "Katondwe Mission Hospital", "Kavalamanja", "Kindom Hall",  "Luangwa (Feira)", "Luangwa Basic School", "Luangwa Bridge", 
  "Luangwa Bridge Market", "Luangwa Bus Station","Luangwa Council Lodge", "Luangwa DC Office", "Luangwa DEBS Offices", "Luangwa District Hospital", "Luangwa High School Police Post", "Boma Filling Station", 
  "Luangwa Habour", "Indeco Building", "Luangwa Market", "Luangwa Main SDA Church", "Mburuma Local Court", "Luangwa Police Station", "Luangwa Post Office", "Luangwa Town Council", 
  "Luangwa Secondary School", "Luangwa Town Council", "Makichilo Lodge", "Mwavi Secondary School", "Mwalila Primary School", "Nyabota Lodge", "Passover Living Lamb Ministry Katondwe", 
  "Pentecostal Assembly of God Joshua Assembly", "UCZ", "Soweto Junction", "Registration Office", "River Spot Club", "Yangoma Lodge", "Yellow Shop",
  "ZESCO Office" 
];

// ---

const segments = [

// Luangwa Town Straight-Line Route
// NOTE: All distance properties are consistently named 'distance' and names are standardized.

  { from: "Kakaro Primary School", to: "Luangwa District Hospital", distance: 7.1 },
  { from: "Luangwa District Hospital", to: "Soweto Junction", distance: 2.5 },
  
  { from: "Soweto Junction", to: "Airstrip", distance: 1.7 },
  
  { from: "Soweto Junction", to: "ZESCO Office", distance: 0.3 },
  { from: "ZESCO Office", to: "Luangwa Main SDA Church", distance: 0.65 },
  { from: "Luangwa Main SDA Church", to: "Indeco Building", distance: 0.7 },
  { from: "Indeco Building", to: "JB Three Boarders Club", distance: 0.1 },
  { from: "JB Three Boarders Club", to: "Yellow Shop", distance: 0.45 },
  { from: "Yellow Shop", to: "Luangwa Bus Station", distance: 0.19 },
  { from: "Luangwa Bus Station", to: "JB Three Boarders Mall", distance: 0.24 },
  { from: "JB Three Boarders Mall", to: "Boma Filling Station", distance: 0.35 },
  { from: "Boma Filling Station", to: "Kantuleni Executive Lodge", distance: 0.19 },
  { from: "Kantuleni Executive Lodge", to: "Luangwa Habour", distance: 0.09 },
  { from: "Kantuleni Executive Lodge", to: "Luangwa Council Lodge", distance: 0.09 },
  { from: "Luangwa Council Lodge", to: "Luangwa DC Office", distance: 0.3 },
  { from: "Luangwa DC Office", to: "Luangwa Police Station", distance: 0.3 },
  { from: "Luangwa Police Station", to: "Luangwa DEBS Offices", distance: 0.1 },
  { from: "Luangwa DEBS Offices", to: "Yangoma Lodge", distance: 0.4 },
  { from: "Yangoma Lodge", to: "Boma Clinic", distance: 0.5 },

// Anglican Church Straight-Line Cluster
  { from: "Feira Kindom Hall", to: "Anglican Church", distance: 0.08 },
  { from: "Anglican Church", to: "Luangwa Town Council", distance: 0.8 },

// Big 2 Zambezi cluster
  { from: "Big 2 Zambezi Water Front Resort & Safari", to: "Feira Day Secondary School", distance: 4.0 },

// BM Residence Straight-Line Route
  { from: "Feira Day Secondary School", to: "BM Residence", distance: 1.1 },
  { from: "BM Residence", to: "Hill View", distance: 1.0 },
  { from: "Hill View", to: "Luangwa Town Council", distance: 0.40 },
  { from: "Luangwa Town Council", to: "Registration Office", distance: 0.49 },
  { from: "Registration Office", to: "Chidada Ground", distance: 0.49 },
  { from: "Registration Office", to: "Yangoma Lodge", distance: 1.9 },

  { from: "Luangwa Town Council", to: "Chilombwe Community School", distance: 13.0 },
  
  { from: "Feira Day Secondary School", to: "Hill View", distance: 1.0 },
  { from: "Hill View", to: "Soweto Junction", distance: 1.8 },

  { from: "JB Three Boarders Mall", to: "Nyabota Lodge", distance: 0.250 },
  { from: "Nyabota Lodge", to: "Luangwa Basic School", distance: 0.180 },
  
  { from: "JB Three Boarders Mall", to: "River Spot Club", distance: 0.03 },

  // Dzalo Skills cluster
  { from: "Dzalo Skills Training Centre Kambolozo", to: "Justifeli Lodge", distance: 0.260 },
  { from: "Justifeli Lodge", to: "Luangwa Town Council", distance: 0.45 },


// Feira Kindom Hall cluster
  { from: "Feira Kindom Hall", to: "Luangwa (Feira)", distance: 0.7 },

// Lodges Straight-Line Route
  { from: "Yangoma Lodge", to: "Makichilo Lodge", distance: 0.550 },
  { from: "Makichilo Lodge", to: "Gerasmos Safari Lodge", distance: 0.300 },
  // Kakaro cluster
  { from: "Kakaro Primary School", to: "Kakaro Liberation Heritage Site", distance: 1.2 },
  { from: "Kakaro Liberation Heritage Site", to: "Kapoche", distance: 16.0 },
  { from: "Kapoche", to: "Katondwe Mission Hospital", distance: 26.0 },

// Kavalamanja cluster
  { from: "Kavalamanja", to: "Luangwa District Hospital", distance: 23.0 },

// Luangwa (Feira) Straight-Line Route (Expanded Cluster)
  { from: "Luangwa Market", to: "Makichilo Lodge", distance: 0.4 },
  { from: "Makichilo Lodge", to: "UCZ", distance: 0.5 },
  { from: "Pentecostal Assembly of God Joshua Assembly", to: "Kindom Hall", distance: 0.130 },
  { from: "UCZ", to: "Pentecostal Assembly of God Joshua Assembly", distance: 0.08 },

// Chitope Straight-Line Cluster
  { from: "Mwavi Secondary School", to: "Mburuma Local Court", distance: 0.65 },

  { from: "Chitope", to: "Kasinsa", distance: 10.0 },
  { from: "Chitope", to: "Mwavi Secondary School", distance: 1.1 },
  { from: "Kasinsa", to: "Luangwa Secondary School", distance: 14.0 },

// Luangwa Secondary School Straight-Line Route
  { from: "Luangwa Secondary School", to: "Luangwa High School Police Post", distance: 0.8 },
  { from: "Luangwa High School Police Post", to: "Katondwe Mission Hospital", distance: 5.2 },
  { from: "Luangwa High School Police Post", to: "Chiriwe Primary School", distance: 2.1 },
  
  { from: "Katondwe Mission Hospital", to: "Mburuma Local Court", distance: 7.5 },
  { from: "Mburuma Local Court", to: "Mwavi Secondary School", distance: 0.65 },
  { from: "Mburuma Local Court", to: "Chitope Rural Health Centre", distance: 1.9 },
  { from: "Mwalila Primary School", to: "Mburuma Local Court", distance: 8.1 },
  { from: "Kaunga Secondary School", to: "Luangwa Bridge Market", distance: 16.0 },
  { from: "Mwalila Primary School", to: "Kaunga Secondary School", distance: 5.4 },
  { from: "Luangwa Bridge Market", to: "Luangwa Bridge", distance: 3.1 },

// Katondwe Cluster Route (Straight Line Order)
  { from: "Katondwe Mission Hospital", to: "Katondwe Chapel", distance: 0.50 },
  { from: "Katondwe Chapel", to: "Katondwe Primary School", distance: 0.05 },
  { from: "Katondwe Primary School", to: "Katondwe Girls Secondary School", distance: 0.00 },
  { from: "Katondwe Girls Secondary School", to: "Katondwe Chaz Hotel", distance: 0.45 },
  { from: "Katondwe Chaz Hotel", to: "Passover Living Lamb Ministry Katondwe", distance: 0.40 },
  { from: "Passover Living Lamb Ministry Katondwe", to: "Katondwe Dam", distance: 0.10 },
  { from: "Katondwe Mission Hospital", to: "Mburuma Local Court", distance: 7.5 }

  
];


    
    // Changed to input elements
    const originInput = document.getElementById('gm-origin');
    const destinationInput = document.getElementById('gm-destination');
    
    const customerPhoneInput = document.getElementById('customer-phone');
    const modeVehicleRadio = document.getElementById('mode-vehicle');
    const modeMotorbikeRadio = document.getElementById('mode-motorbike');
    const extraLuggageCheckbox = document.getElementById('extra-luggage-checkbox');
    const summaryTableSection = document.querySelector('.summary-table-section');
    const summaryTableContainer = document.getElementById('summary-table-container');
    const submitBtn = document.getElementById('submit-btn');
    const submitStatusDiv = document.getElementById('submit-status');
    const loader = document.getElementById('loader');
    const maskedPhone = document.getElementById('masked-phone');
    const maskedOrigin = document.getElementById('masked-origin');
    const maskedDestination = document.getElementById('masked-destination');
    const tripDetails = document.getElementById('trip-details');
    const mainFooter = document.getElementById('main-footer'); 
    const aboutBtn = document.getElementById('about-btn'); 
    const aboutInfo = document.getElementById('about-info'); 
    let summaryData = null;
    let selectedOrigin = ''; // Store the actual selected place
    let selectedDestination = ''; // Store the actual selected place
    
    // Function to attach live autocomplete filtering
    function setupAutocomplete(inputId, listId, inputElement) {
        const input = inputElement; // Use the passed input element
        const list = document.getElementById(listId);

        input.addEventListener("input", () => {
            // Force reset validation on typing
            input.closest('.input-group').classList.remove('valid');
            
            const query = input.value.toLowerCase();
            list.innerHTML = "";
            
            // Only show dropdown if there's a query and the input is not masked/valid
            if (!query || input.closest('.input-group').classList.contains('valid')) {
                return;
            }

            const filtered = places.filter(p => p.toLowerCase().includes(query)).sort(); // Added sort for alphabetical order
            
            filtered.forEach(place => {
                const item = document.createElement("div");
                item.textContent = place;
                item.classList.add("suggestion");
                item.addEventListener("click", () => {
                    input.value = place;
                    list.innerHTML = "";
                    
                    // Store the selected value
                    if (inputId === 'gm-origin') {
                        selectedOrigin = place;
                    } else if (inputId === 'gm-destination') {
                        selectedDestination = place;
                    }
                    
                    updateSummaryTable(); // Trigger summary update after selection
                });
                list.appendChild(item);
            });
            
            // If no results, clear the list
            if (filtered.length === 0) {
                 list.innerHTML = "";
            }
        });

        // Hide list when clicking outside the input or dropdown
        document.addEventListener("click", (e) => {
            if (!list.contains(e.target) && e.target !== input) {
                list.innerHTML = "";
            }
        });
        
        // Add event listener for calculating distance on focus change
        input.addEventListener("change", updateSummaryTable);
    }
    
    function buildGraph(segments) {
      const graph = {};
      segments.forEach(seg => {
        if (!graph[seg.from]) graph[seg.from] = [];
        if (!graph[seg.to]) graph[seg.to] = [];
        graph[seg.from].push({ place: seg.to, distance: seg.distance });
        graph[seg.to].push({ place: seg.from, distance: seg.distance });
      });
      return graph;
    }
    function findShortestDistance(from, to, segments) {
      const graph = buildGraph(segments);
      if (!graph[from] || !graph[to]) return null;
      const distances = {};
      const visited = new Set();
      places.forEach(place => distances[place] = Infinity);
      distances[from] = 0;
      let queue = [{ place: from, dist: 0 }];
      while (queue.length > 0) {
        queue.sort((a, b) => a.dist - b.dist);
        const { place, dist } = queue.shift();
        if (place === to) return dist;
        if (visited.has(place)) continue;
        visited.add(place);
        for (let neighbor of (graph[place] || [])) {
          if (dist + neighbor.distance < distances[neighbor.place]) {
            distances[neighbor.place] = dist + neighbor.distance;
            queue.push({ place: neighbor.place, dist: distances[neighbor.place] });
          }
        }
      }
      return null;
    }
    function updateValidationStatus(element, isValid) {
        const parentGroup = element.closest('.input-group');
        if (isValid) {
            parentGroup.classList.add('valid');
        } else {
            parentGroup.classList.remove('valid');
        }
    }
    function maskInputValues(origin, destination, phone) {
      const isPhoneValid = phone.match(/^0[0-9]{9}$/);
      updateValidationStatus(customerPhoneInput, isPhoneValid);
      maskedPhone.textContent = '**********';
      
      // Validation check for autocomplete inputs: must be a place in the array
      const isOriginValid = places.includes(origin);
      updateValidationStatus(originInput, isOriginValid);
      // ALWAYS display *********** for the masked element
      maskedOrigin.textContent = '**********'; 
      
      const isDestinationValid = places.includes(destination);
      updateValidationStatus(destinationInput, isDestinationValid);
      // ALWAYS display ********** for the masked element
      maskedDestination.textContent = '**********';
    }
    
    // Core function to reset the input on masked click
    function resetValidation(event) {
      const parentGroup = event.target.closest('.input-group');
      const input = parentGroup.querySelector('input');
      
      // If the clicked element is masked-phone, reset phone input
      if (event.target === maskedPhone) {
          input.value = ''; // Clear for re-entry
          handlePhoneNumberInput(); // Run validation/hide check
      } else {
          // It's a place input (origin or destination)
          // Set the value back to the actual selected place for editing
          if (input === originInput) {
              input.value = selectedOrigin;
          } else if (input === destinationInput) {
              input.value = selectedDestination;
          }
          parentGroup.classList.remove('valid');
          // Important: Keep the input visible and editable
      }

      summaryTableContainer.innerHTML = '';
      submitBtn.classList.add('disabled');
      submitBtn.setAttribute('disabled', 'true');
      summaryData = null;
      displayStatus('Please fill in all details correctly.', 'failed');
      summaryTableSection.classList.add('hidden-section');
      mainFooter.style.display = 'none'; // Hide footer on reset
    }
    
    function reveal(eye) {
      document.querySelectorAll(".hidden-value").forEach(v => v.style.display = "none");
      document.querySelectorAll(".eye-btn").forEach(e => e.style.display = "inline");
      let value = eye.previousElementSibling;
      value.style.display = "inline";
      eye.style.display = "none";
    }
    
    function updateSummaryTable() {
      // Use the actual input value for calculation
      const origin = originInput.value.trim();
      const destination = destinationInput.value.trim();
      const customerPhone = customerPhoneInput.value.trim();
      
      const isVehicleSelected = modeVehicleRadio.checked;
      const isMotorbikeSelected = modeMotorbikeRadio.checked;
      const isExtraLuggageChecked = extraLuggageCheckbox.checked;
      
      summaryTableContainer.innerHTML = '';
      submitBtn.classList.add('disabled');
      submitBtn.setAttribute('disabled', 'true');
      summaryData = null;
      mainFooter.style.display = 'none'; // Ensure footer is hidden until submission is ready/complete
      
      // Validation now checks if the typed/selected value is in the 'places' array
      const isOriginValid = places.includes(origin);
      const isDestinationValid = places.includes(destination);
      const isPhoneValid = customerPhone.match(/^0[0-9]{9}$/);
      const isModeSelected = isVehicleSelected || isMotorbikeSelected;
      
      // Ensure selected variables are updated if valid
      if (isOriginValid) selectedOrigin = origin;
      if (isDestinationValid) selectedDestination = destination;
      
      // Call maskInputValues to hide inputs and show masked values if valid
      maskInputValues(origin, destination, customerPhone);
      
      if (!isOriginValid || !isDestinationValid || !isPhoneValid || !isModeSelected) {
          summaryTableSection.classList.add('hidden-section');
          displayStatus('Please fill in all details correctly.', 'info');
          return;
      }
      
      const mode = isVehicleSelected ? 'Vehicle' : 'Motorbike';
      const hasExtraLuggage = isExtraLuggageChecked;
      const distance = findShortestDistance(origin, destination, segments);
      
      if (distance === null || isNaN(distance)) {
        summaryTableSection.classList.add('hidden-section');
        displayStatus('A route could not be found between the selected places.', 'failed');
        return;
      }
      
      const timeHours = distance / config.avgSpeed;
      const wholeHours = Math.floor(timeHours);
      const minutes = Math.round((timeHours - wholeHours) * 60);
      let price = 0;
      
      if (mode === 'Vehicle') {
        price = distance * config.vehiclePricePerKm;
        price = Math.max(price, config.vehicleMinPrice);
      } else {
        price = distance * config.motorbikePricePerKm;
        price = Math.max(price, config.motorbikeMinPrice);
      }
      
      if (hasExtraLuggage) {
        price = price * 1.25;
      }
      
      price = Math.round(price);
      let timeText = '';
      if (wholeHours > 0) {
        timeText += `${wholeHours} hr`;
        if (minutes > 0) timeText += ` ${minutes} min`;
      } else {
        timeText += `${minutes} min`;
      }
      
      const tableHTML = `
        <div class="table-responsive">
          <table class="summary-table">
            <thead>
              <tr>
                <th>Mode</th>
                <th>Extra Luggage</th>
                <th>Phone</th>
                <th>From</th>
                <th>To</th>
                <th>Distance (km)</th>
                <th>Time</th>
                <th>Price (K)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <span class="hidden-value">${mode}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value">${hasExtraLuggage ? 'Yes' : 'No'}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value">${customerPhone}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value">${origin}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value">${destination}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value">${distance.toFixed(2)}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value">${timeText}</span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
                <td>
                  <span class="hidden-value"><b>K${price}</b></span>
                  <span class="eye-btn" onclick="reveal(this)">üëÅÔ∏è</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      `;
      summaryTableContainer.innerHTML = tableHTML;
      summaryData = {
        preferredMode: mode,
        extraLuggage: hasExtraLuggage ? 'Yes' : 'No',
        phone: customerPhone,
        from: origin,
        to: destination,
        distance: distance.toFixed(2),
        estimatedTime: timeText,
        price: price
      };
      summaryTableSection.classList.remove('hidden-section');
      displayStatus('Trip details calculated. Click submit to send your request.', 'success');
      submitBtn.classList.remove('disabled');
      submitBtn.removeAttribute('disabled');
    }
    
    function submitToGoogleSheet() {
      if (!summaryData) {
        displayStatus('No data to submit.', 'failed');
        return;
      }
      const timestamp = new Date().toLocaleString("en-US", { timeZone: "Africa/Lusaka" });
      const payload = {
        "preferredMode": summaryData.preferredMode,
        "extraLuggage": summaryData.extraLuggage,
        "phone": summaryData.phone,
        "from": summaryData.from,
        "to": summaryData.to,
        "distance": summaryData.distance,
        "estimatedTime": summaryData.estimatedTime,
        "price": summaryData.price,
        "timestamp": timestamp
      };
      const formBody = new URLSearchParams(payload);
      displayStatus('Submitting...', 'info');
      loader.style.display = 'block';
      submitBtn.setAttribute('disabled', 'true');
      fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        body: formBody,
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
      })
      .then(response => {
        loader.style.display = 'none';
        displayStatus('Booking request sent successfully! You will be contacted shortly.', 'success');
        submitBtn.removeAttribute('disabled');
        // --- LOGIC: Show Footer on Success ---
        mainFooter.style.display = 'block'; 
        // ----------------------------------------
      })
      .catch(error => {
        loader.style.display = 'none';
        submitBtn.removeAttribute('disabled');
        displayStatus('Submission failed. Please try again.', 'failed');
        console.error('Submission error:', error);
      });
    }
    
    function displayStatus(message, type) {
      submitStatusDiv.innerHTML = `<span class="material-icons">${type === 'success' ? 'check_circle' : type === 'failed' ? 'error' : 'info'}</span> ${message}`;
      submitStatusDiv.className = `submit-status ${type}`;
    }
    
    function handlePhoneNumberInput() {
        const customerPhone = customerPhoneInput.value.trim();
        const isPhoneValid = customerPhone.match(/^0[0-9]{9}$/);
        
        // This validation check runs on *every* input/change for the phone field
        updateValidationStatus(customerPhoneInput, isPhoneValid);

        if (isPhoneValid) {
            tripDetails.classList.remove('hidden-section');
            updateSummaryTable();
        } else {
            tripDetails.classList.add('hidden-section');
            summaryTableSection.classList.add('hidden-section');
            displayStatus('Please fill in all details correctly.', 'info');
            mainFooter.style.display = 'none'; // Ensure footer is hidden if phone input is invalid
        }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize autocomplete for origin and destination inputs
      setupAutocomplete("gm-origin", "originList", originInput);
      setupAutocomplete("gm-destination", "destinationList", destinationInput);
      
      // Event listener for phone number input
      customerPhoneInput.addEventListener('input', handlePhoneNumberInput);
      
      // Event listeners for other inputs (only appear after phone is entered)
      modeVehicleRadio.addEventListener('change', updateSummaryTable);
      modeMotorbikeRadio.addEventListener('change', updateSummaryTable);
      extraLuggageCheckbox.addEventListener('change', updateSummaryTable);

      // Footer button logic
      aboutBtn.addEventListener('click', () => {
          aboutInfo.style.display = aboutInfo.style.display === 'block' ? 'none' : 'block';
      });
    });
    
    // Reset validation for masked values
    maskedPhone.addEventListener('click', resetValidation);
    maskedOrigin.addEventListener('click', resetValidation);
    maskedDestination.addEventListener('click', resetValidation);
    
    submitBtn.addEventListener('click', (e) => {
      e.preventDefault();
      submitToGoogleSheet();
    });
  </script>
</body>
</html>
