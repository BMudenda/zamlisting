<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZamTaxi | Book a Ride</title>
  <meta property="og:image" content="https://zamlisting.com/taxi.webp" />
  <meta property="og:image:secure_url" content="https://zamlisting.com/taxi.webp" />
  <meta property="og:image:width" content="220" />
  <meta property="og:image:height" content="120" />
  <meta property="og:url" content="https://zamlisting.com/taxi" />
  <meta property="og:title" content="ZamTaxi | Book a Ride" />
  <meta property="og:description" content="Book your taxi ride in Lusaka! Choose vehicle or motorbike, enter trip details, and submit via SMS or WhatsApp." />
  <meta property="og:type" content="website" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto', Arial, sans-serif; background-color: #f5f5f5; color: #333; }
    header {
      background: #333; color: white; padding: 20px; text-align: left;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .header-content {
      max-width: 1200px; margin: auto; display: flex; flex-wrap: wrap;
      justify-content: space-between; align-items: center; gap: 15px;
    }
    .company-info { flex: 1 1 60%; }
    .company-info h2 { font-size: 1.4rem; color: #ff9900; }
    .company-info ul { list-style: none; margin-top: 8px; }
    .company-info li { margin-bottom: 5px; font-size: 0.95rem; }
    .price-tag {
      font-size: 1.3rem; font-weight: bold; background: #e67e22;
      padding: 8px 15px; border-radius: 5px; color: white;
    }
    .time-listed { font-size: 0.85rem; color: #ccc; margin-top: 5px; }
    .product-container {
      max-width: 1200px; margin: 30px auto; padding: 0 20px;
      display: flex; flex-wrap: wrap; gap: 30px;
    }
    .map-section { flex: 1 1 60%; min-width: 300px; }
    .booking-section { flex: 1 1 35%; min-width: 300px; }
    .map-container {
      background: white; border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow: hidden;
      height: 400px; display: none;
    }
    #google-map-frame {
      width: 100%; height: 100%; border: none; border-radius: 8px;
    }
    .booking-container {
      background: white; border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      padding: 20px;
    }
    .inputs-wrapper { display: flex; flex-direction: column; gap: 15px; margin: 15px 0; }
    .input-group {
      position: relative; background: #f5f7fa; border-radius: 5px;
      padding: 10px 10px 10px 40px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .input-group label {
      font-weight: bold; color: #2563eb; font-size: 0.9rem;
      margin-bottom: 5px; display: block;
    }
    .input-group .material-icons.input-icon {
      position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
      color: #2563eb; font-size: 20px; opacity: 0.85;
    }
    .autocomplete-wrapper { position: relative; }
    input, select {
      width: 100%; padding: 10px; font-size: 1rem; border-radius: 5px;
      border: 1px solid #ccc; transition: border 0.2s, box-shadow 0.2s;
    }
    input:focus, select:focus {
      border: 1px solid #2563eb; box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    }
    .autocomplete-list {
      position: absolute; background: white; border: 1px solid #ccc;
      max-height: 150px; overflow-y: auto; z-index: 1000; width: 100%;
      border-radius: 5px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .autocomplete-item {
      padding: 10px; cursor: pointer; border-bottom: 1px solid #f1f5f9;
      font-size: 0.95rem; transition: background 0.2s;
    }
    .autocomplete-item:hover, .autocomplete-item.active {
      background-color: #f0f6ff; color: #2563eb;
    }
    .mode-group {
      display: flex; gap: 10px; flex-wrap: wrap;
    }
    .mode-radio {
      display: flex; align-items: center; gap: 5px; font-size: 0.95rem;
      cursor: pointer;
    }
    .mode-radio input { width: auto; margin-right: 5px; }
    .summary-table-section {
      margin-top: 20px; padding: 15px; background: white;
      border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .section-title {
      font-weight: bold; color: #2563eb; font-size: 1.1rem;
      margin-bottom: 10px; display: flex; align-items: center; gap: 5px;
    }
    .summary-table-wrapper { overflow-x: auto; }
    table.summary-table {
      width: 100%; border-collapse: collapse; font-size: 0.95rem;
      background: #f9fbfd; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    table.summary-table th, table.summary-table td {
      border: 1px solid #dbeafe; padding: 8px; text-align: left;
    }
    table.summary-table th {
      background-color: #e7f0fe; color: #222; font-weight: bold;
    }
    table.summary-table td { color: #2d3a4a; font-weight: 500; }
    .summary-actions-row {
      display: flex; gap: 10px; justify-content: center; margin: 10px 0;
      flex-wrap: wrap;
    }
    .summary-actions-row button {
      padding: 10px 20px; background: #2563eb; color: white;
      border: none; border-radius: 5px; font-weight: bold;
      cursor: pointer; font-size: 0.95rem; transition: background 0.2s;
      display: flex; align-items: center; gap: 5px;
    }
    .summary-actions-row button:hover { background: #174ea6; }
    .whatsapp-btn { background-color: #25d366; }
    .whatsapp-btn:hover { background-color: #25d366; }
    .sms-btn { background-color: #808080; }
    .sms-btn:hover { background-color: #808080; }
    .loader {
      display: none; width: 20px; height: 20px; border: 3px solid #2563eb;
      border-radius: 50%; border-top: 3px solid #e5e7eb;
      animation: spin 1s linear infinite; margin: 10px auto;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .submit-status {
      display: flex; align-items: center; gap: 5px; margin-top: 10px;
      justify-content: center; font-weight: 500;
    }
    .submit-status.success { color: #1aaf5d; }
    .submit-status.failed { color: #dc2626; }
    .material-icons { font-size: 20px; vertical-align: middle; }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="company-info">
        <h2>ZamListing Booking</h2>
        <ul>
          <li><strong>Location:</strong> Luangwa, Zambia</li>
        </ul>
      </div>
      <div>
        <div class="price-tag">Book Your Ride Now!</div>
      </div>
    </div>
  </header>

  <main class="product-container">
    <section class="map-section">
      <div class="map-container" id="mapContainer">
        <iframe id="google-map-frame" allowfullscreen loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
    </section>

    <section class="booking-section">
      <div class="booking-container">
        <div class="inputs-wrapper">
          <div class="input-group" id="mode-group-wrapper">
            <span class="material-icons input-icon">commute</span>
            <label for="mode-of-transport">Preferred Mode</label>
            <div class="mode-group" id="mode-group">
              <label class="mode-radio">
                <input type="radio" name="mode" value="vehicle" id="mode-vehicle" onchange="handleModeChange();handleCustomerPhoneInput();">
                <span class="material-icons">directions_car</span>Vehicle
              </label>
              <label class="mode-radio">
                <input type="radio" name="mode" value="motorbike" id="mode-motorbike" onchange="handleModeChange();handleCustomerPhoneInput();">
                <span class="material-icons">two_wheeler</span>Motorbike
              </label>
            </div>
          </div>
          <div class="input-group" id="customer-phone-wrapper">
            <span class="material-icons input-icon">phone</span>
            <label for="customer-phone">Phone Number</label>
            <input
              type="tel"
              id="customer-phone"
              maxlength="10"
              pattern="^0[0-9]{9}$"
              placeholder="0XXXXXXXXX"
              autocomplete="off"
              inputmode="numeric"
            >
          </div>
          <div class="input-group">
            <span class="material-icons input-icon">place</span>
            <label for="gm-origin">From</label>
            <div class="autocomplete-wrapper">
              <input type="text" id="gm-origin" autocomplete="off" placeholder="Enter starting point" oninput="showSuggestions(this, 'gm-origin')" aria-label="Origin">
              <div id="gm-origin-list" class="autocomplete-list"></div>
            </div>
          </div>
          <div class="input-group">
            <span class="material-icons input-icon">flag</span>
            <label for="gm-destination">To</label>
            <div class="autocomplete-wrapper">
              <input type="text" id="gm-destination" autocomplete="off" placeholder="Enter destination" oninput="showSuggestions(this, 'gm-destination')" aria-label="Destination">
              <div id="gm-destination-list" class="autocomplete-list"></div>
            </div>
          </div>
        </div>
        <div class="summary-table-section">
          <div class="section-title">
            <span class="material-icons">table_chart</span>
            Trip Summary
          </div>
          <div class="summary-table-wrapper">
            <div id="summary-table-container"></div>
          </div>
          <div class="summary-actions-row">
            <button type="button" onclick="updateSummaryTable()">
              <span class="material-icons">summarize</span>Calculate
            </button>
            <button type="button" class="sms-btn" onclick="submitTripDetails('sms')" disabled>
              ðŸ’¬ SMS
            </button>
            <button type="button" class="whatsapp-btn" onclick="submitTripDetails('whatsapp')" disabled>
              ðŸŸ¢ whatsapp
            </button>
          </div>
          <div id="submit-status" class="submit-status"></div>
          <div id="loader" class="loader"></div>
          <div class="summary-actions-row">
            <button type="button" id="map-btn" onclick="toggleMap()">
              <span class="material-icons">map</span><span id="map-btn-text">Show Map</span>
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Places and Segments
    const places = [
      "Luangwa (Feira)", "Chitope", "Luangwa Market", "Kasinsa", "Kapoche",
      "Kakaro Primary School", "Makichilo Lodge", "Gerasmos Safari Lodge",
      "Justifeli Lodge", "Kantuleni executive Lodge", "Feira Kindom Hall",
      "Luangwa main sda churh", "Pentocostal Assembly of God Joshua Assembly",
      "UCZ", "JB THREE BOARDERS MALL", "yellow shop", "Anglican Church",
      "Big 2 Zambezi Water Front Resort & Safari", "Luangwa Secondary School",
      "Luangwa District Hospital", "Kavalamanja", "Luangwa Police Station",
      "Zambia Electricity Supply Corporation", "Luangwa Post Office",
      "Luangwa Basic School", "Luangwa Habour", "Luangwa Indeco",
      "Luangwa District Comission office", "Luangwa District Education Board Offices",
      "Luangwa Council lodge", "Yangoma Hotel", "Luangwa Filling Station",
      "Dzalo Skills Training Centre kambolozo", "Boma Clinic", "BM residence",
      "Luangwa Feira Day Secondary School", "Katondwe Mission Hospital",
      "Mwavi Secondary School", "Luangwa Bridge", "Luangwa Bridge Market"
    ];

    const segments = [
      { from: "Luangwa (Feira)", to: "Kapoche", distance: 28 },
      { from: "Luangwa (Feira)", to: "Katondwe Mission Hospital", distance: 52 },
      { from: "Luangwa (Feira)", to: "Luangwa Market", distance: 0.1 },
      { from: "Luangwa Market", to: "Luangwa (Feira)", distance: 0.1 },
      { from: "Luangwa (Feira)", to: "Luangwa District Hospital", distance: 4.6 },
      { from: "Luangwa (Feira)", to: "Kakaro Primary School", distance: 12 },
      { from: "Luangwa District Hospital", to: "Kavalamanja", distance: 23 },
      { from: "Katondwe Mission Hospital", to: "Kasinsa", distance: 16 },
      { from: "Chitope", to: "Kasinsa", distance: 10 },
      { from: "Luangwa (Feira)", to: "Luangwa Police Station", distance: 0.55 },
      { from: "Luangwa (Feira)", to: "Makichilo Lodge", distance: 0.40 },
      { from: "Luangwa (Feira)", to: "Anglican Church", distance: 0.75 },
      { from: "Luangwa (Feira)", to: "Feira Kindom Hall", distance: 0.7 },
      { from: "Luangwa (Feira)", to: "UCZ", distance: 0.5 },
      { from: "Luangwa (Feira)", to: "Pentocostal Assembly of God Joshua Assembly", distance: 0.6 },
      { from: "Luangwa Police Station", to: "Luangwa Post Office", distance: 1.1 },
      { from: "Luangwa Post Office", to: "Luangwa District Comission office", distance: 0 },
      { from: "Luangwa Market", to: "Luangwa Basic School", distance: 0.45 },
      { from: "Luangwa Market", to: "Luangwa Habour", distance: 0.5 },
      { from: "Luangwa (Feira)", to: "Luangwa Indeco", distance: 0.9 },
      { from: "Luangwa Indeco", to: "Luangwa Council lodge", distance: 0.25 },
      { from: "Luangwa Council lodge", to: "Yangoma Hotel", distance: 0.15 },
      { from: "Luangwa Council lodge", to: "Zambia Electricity Supply Corporation", distance: 2.4 },
      { from: "Yangoma Hotel", to: "Luangwa Filling Station", distance: 0.7 },
      { from: "Kantuleni executive Lodge", to: "Luangwa Filling Station", distance: 0.190 },
      { from: "Luangwa Filling Station", to: "Dzalo Skills Training Centre kambolozo", distance: 0.3 },
      { from: "Dzalo Skills Training Centre kambolozo", to: "Boma Clinic", distance: 0.2 },
      { from: "Boma Clinic", to: "BM residence", distance: 0.6 },
      { from: "BM residence", to: "Luangwa Feira Day Secondary School", distance: 1.1 },
      { from: "Gerasmos Safari Lodge", to: "Luangwa Feira Day Secondary School", distance: 3.1 },
      { from: "Luangwa Feira Day Secondary School", to: "Justifeli Lodge", distance: 2.2 },
      { from: "Luangwa main sda churh", to: "Justifeli Lodge", distance: 0.9 },
      { from: "Luangwa District Education Board Offices", to: "Justifeli Lodge", distance: 2.0 },
      { from: "Luangwa Feira Day Secondary School", to: "yellow shop", distance: 3.3 },
      { from: "Luangwa Feira Day Secondary School", to: "Zambia Electricity Supply Corporation", distance: 2.0 },
      { from: "yellow shop", to: "JB THREE BOARDERS MALL", distance: 0.45 },
      { from: "yellow shop", to: "Luangwa Indeco", distance: 0.45 },
      { from: "yellow shop", to: "Luangwa main sda churh", distance: 0.70 },
      { from: "Luangwa main sda churh", to: "Zambia Electricity Supply Corporation", distance: 0.65 },
      { from: "Luangwa District Hospital", to: "Zambia Electricity Supply Corporation", distance: 2.8 },
      { from: "Luangwa Feira Day Secondary School", to: "Big 2 Zambezi Water Front Resort & Safari", distance: 4.0 },
      { from: "Luangwa Feira Day Secondary School", to: "Katondwe Mission Hospital", distance: 48 },
      { from: "Katondwe Mission Hospital", to: "Mwavi Secondary School", distance: 7.2 },
      { from: "Mwavi Secondary School", to: "Luangwa Bridge Market", distance: 27.3 },
      { from: "Mwavi Secondary School", to: "Chitope", distance: 1.1 },
      { from: "Chitope", to: "Luangwa Secondary School", distance: 14 },
      { from: "Luangwa Bridge Market", to: "Luangwa Bridge", distance: 12.7 }
    ];

    function buildGraph(segments) {
      const graph = {};
      segments.forEach(seg => {
        if (!graph[seg.from]) graph[seg.from] = [];
        if (!graph[seg.to]) graph[seg.to] = [];
        graph[seg.from].push({ place: seg.to, distance: seg.distance });
        graph[seg.to].push({ place: seg.from, distance: seg.distance });
      });
      return graph;
    }

    function findShortestDistance(from, to, segments) {
      const graph = buildGraph(segments);
      if (!graph[from] || !graph[to]) return null;
      const distances = {};
      const visited = new Set();
      places.forEach(place => distances[place] = Infinity);
      distances[from] = 0;
      let queue = [{ place: from, dist: 0 }];
      while (queue.length > 0) {
        queue.sort((a, b) => a.dist - b.dist);
        const { place, dist } = queue.shift();
        if (place === to) return dist;
        if (visited.has(place)) continue;
        visited.add(place);
        for (let neighbor of (graph[place] || [])) {
          if (dist + neighbor.distance < distances[neighbor.place]) {
            distances[neighbor.place] = dist + neighbor.distance;
            queue.push({ place: neighbor.place, dist: distances[neighbor.place] });
          }
        }
      }
      return null;
    }

    window.onload = function() {
      document.getElementById('mode-group-wrapper').style.display = '';
      document.getElementById('customer-phone-wrapper').style.display = '';
      document.getElementById('mapContainer').style.display = 'none';
    };

    function handleModeChange() {}
    function handleCustomerPhoneInput() {
      document.getElementById('customer-phone-wrapper').style.display = '';
    }

    function showSuggestions(input, field) {
      const listId = field + '-list';
      const list = document.getElementById(listId);
      const value = input.value;
      list.innerHTML = '';
      if (!value) return;
      const filtered = places.filter(place => place.toLowerCase().includes(value.trim().toLowerCase()));
      filtered.forEach(place => {
        const item = document.createElement('div');
        item.classList.add('autocomplete-item');
        item.textContent = place;
        item.onclick = () => { input.value = place; list.innerHTML = ''; };
        list.appendChild(item);
      });
    }

    function toggleMap() {
      const origin = document.getElementById('gm-origin').value.trim();
      const destination = document.getElementById('gm-destination').value.trim();
      const frame = document.getElementById('google-map-frame');
      const mapBtn = document.getElementById('map-btn');
      const mapBtnText = document.getElementById('map-btn-text');
      const mapContainer = document.getElementById('mapContainer');
      if (mapContainer.style.display === 'none' || mapContainer.style.display === '') {
        if (!origin || !destination) {
          alert('Please enter both origin and destination.');
          return;
        }
        const embedUrl = `https://www.google.com/maps?q=${encodeURIComponent(origin + ' to ' + destination)}&output=embed`;
        frame.src = embedUrl;
        mapContainer.style.display = 'block';
        mapBtnText.textContent = 'Hide Map';
        mapBtn.setAttribute('aria-pressed', 'true');
        mapContainer.scrollIntoView({ behavior: 'smooth' });
      } else {
        mapContainer.style.display = 'none';
        mapBtnText.textContent = 'Show Map';
        mapBtn.setAttribute('aria-pressed', 'false');
      }
    }

    let summaryData = null;

    function updateSummaryTable() {
      const origin = document.getElementById('gm-origin').value.trim();
      const destination = document.getElementById('gm-destination').value.trim();
      const container = document.getElementById('summary-table-container');
      const submitButtons = document.querySelectorAll('.sms-btn, .whatsapp-btn');
      let mode = '';
      let pricePer3Km = 20;
      let customerPhone = '';
      let distance = null;
      distance = findShortestDistance(origin, destination, segments);
      if (distance === null || isNaN(distance)) {
        container.innerHTML = '<div style="color:red;margin-top:10px;">Please enter both origin and destination from the supported list, and ensure a route exists between them.</div>';
        submitButtons.forEach(btn => btn.disabled = true);
        summaryData = null;
        return;
      }
      const v = document.getElementById('mode-vehicle').checked;
      const m = document.getElementById('mode-motorbike').checked;
      if (!v && !m) {
        container.innerHTML = '<div style="color:red;margin-top:10px;">Please select a mode of transport above.</div>';
        submitButtons.forEach(btn => btn.disabled = true);
        summaryData = null;
        return;
      }
      if (v) { mode = 'Vehicle'; pricePer3Km = 20; }
      else if (m) { mode = 'Motorbike'; pricePer3Km = 10; }
      customerPhone = document.getElementById('customer-phone').value.trim();
      if (!customerPhone.match(/^0[0-9]{9}$/)) {
        container.innerHTML = '<div style="color:red;margin-top:10px;">Please enter a valid phone number in the format 0978167546.</div>';
        submitButtons.forEach(btn => btn.disabled = true);
        summaryData = null;
        return;
      }
      const avgSpeed = 60;
      const timeHours = distance / avgSpeed;
      const wholeHours = Math.floor(timeHours);
      const minutes = Math.round((timeHours - wholeHours) * 60);
      let price = Math.ceil(distance / 3) * pricePer3Km;
      let timeText = '';
      if (wholeHours > 0) {
        timeText += wholeHours + ' hr';
        if (minutes > 0) timeText += ' ' + minutes + ' min';
      } else {
        timeText += minutes + ' min';
      }
      let tableHeader = `
        <tr>
          <th>Mode</th>
          <th>Phone</th>
          <th>From</th>
          <th>To</th>
          <th>Distance (km)</th>
          <th>Time</th>
          <th>Price (K)</th>
        </tr>`;
      let tableRow = `
        <tr>
          <td>${mode}</td>
          <td>${customerPhone}</td>
          <td>${origin}</td>
          <td>${destination}</td>
          <td>${distance.toFixed(2)}</td>
          <td>${timeText}</td>
          <td><b>K${price}</b></td>
        </tr>`;
      container.innerHTML = `
        <table class="summary-table">
          ${tableHeader}
          ${tableRow}
        </table>
      `;
      summaryData = {
        preferredMode: mode,
        phone: customerPhone,
        from: origin,
        to: destination,
        distance: distance.toFixed(2),
        estimatedTime: timeText,
        price: price
      };
      submitButtons.forEach(btn => btn.disabled = false);
      document.getElementById('submit-status').innerHTML = '';
    }

    function submitTripDetails(method) {
      const statusDiv = document.getElementById('submit-status');
      const submitButtons = document.querySelectorAll('.sms-btn, .whatsapp-btn');
      const loader = document.getElementById('loader');
      if (!summaryData) {
        statusDiv.innerHTML = '<span class="submit-status failed"><span class="material-icons">error</span>No data to submit.</span>';
        return;
      }
      let requiredFields = ['from', 'to', 'distance', 'estimatedTime', 'price', 'phone', 'preferredMode'];
      for (const key of requiredFields) {
        if (!summaryData[key] || summaryData[key].toString().trim() === '') {
          statusDiv.innerHTML = '<span class="submit-status failed"><span class="material-icons">error</span>Missing required field: ' + key + '</span>';
          return;
        }
      }
      submitButtons.forEach(btn => btn.disabled = true);
      loader.style.display = 'inline-block';
      statusDiv.innerHTML = '';

      const tripDetails = `Trip: ${summaryData.from} to ${summaryData.to}, Mode: ${summaryData.preferredMode}, Phone: ${summaryData.phone}, Distance: ${summaryData.distance}km, Time: ${summaryData.estimatedTime}, Price: K${summaryData.price}`;

      if (method === 'sms') {
        const smsNumber = '0978167546';
        const smsUrl = `sms:${smsNumber}?body=${encodeURIComponent(tripDetails)}`;
        window.location.href = smsUrl;
        statusDiv.innerHTML = '<span class="submit-status success">ðŸ’¬ SMS app opened with trip details!</span>';
      } else if (method === 'whatsapp') {
        const whatsappNumber = '+260978167546';
        const encodedMessage = encodeURIComponent(tripDetails);
        const whatsappUrl = `https://api.whatsapp.com/send?phone=${whatsappNumber}&text=${encodedMessage}`;
        window.open(whatsappUrl, '_blank');
        statusDiv.innerHTML = '<span class="submit-status success">ðŸŸ¢ whatsapp opened with trip details!</span>';
      }

      loader.style.display = 'none';
      setTimeout(() => {
        statusDiv.innerHTML = '';
        submitButtons.forEach(btn => btn.disabled = false);
      }, 3000);
    }
  </script>
</body>
</html>
