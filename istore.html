<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grocery Cart</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
    }
    .top-bar {
      background: #004d00;
      color: white;
      padding: 10px;
      text-align: center;
    }
    .top-bar h1 {
      margin: 5px 0;
      font-size: 22px;
    }
    .top-bar p {
      margin: 3px 0;
      font-size: 14px;
    }
    .top-bar a {
      color: yellow;
      text-decoration: none;
      margin: 0 5px;
      font-weight: bold;
    }

    h2, h3 {
      text-align: center;
      padding: 10px;
    }
    .search-bar {
      display: flex;
      justify-content: center;
      margin: 10px;
    }
    #searchInput {
      padding: 10px;
      width: 90%;
      max-width: 400px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
    }
    .item-slider {
      display: flex;
      overflow-x: auto;
      gap: 10px;
      padding: 10px;
      background: #fff;
      flex-wrap: nowrap;
    }
    .item {
      flex: 0 0 auto;
      width: 140px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fff;
      text-align: center;
      padding: 10px;
      cursor: pointer;
    }
    .item img {
      width: 100px;
      height: 100px;
      object-fit: contain;
      border-radius: 4px;
    }
    .cart {
      padding: 15px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: #fff;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: left;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
    }
    .delete-btn {
      background: #dc3545;
      margin-left: 10px;
    }
    #loader {
      margin-top: 10px;
      font-weight: bold;
      color: green;
      display: none;
    }
    .cart-icon {
      position: fixed;
      top: 10px;
      right: 15px;
      background: #ff5722;
      color: white;
      padding: 8px 12px;
      border-radius: 30px;
      font-weight: bold;
      z-index: 999;
    }
    #initialsInput {
      margin-top: 10px;
      padding: 8px;
      width: 100%;
      max-width: 300px;
      border-radius: 5px;
      border: 1px solid #ccc;
      display: block;
    }
    @media (max-width: 768px) {
      .item { width: 120px; padding: 8px; }
      .item img { width: 80px; height: 80px; }
      h2 { font-size: 1.2em; }
      table, th, td { font-size: 14px; }
      button { width: 100%; }
      .cart-icon { font-size: 14px; padding: 6px 10px; }
    }
  </style>
</head>
<body>

<div class="top-bar">
  <h1>Luanshya Grocery Hub</h1>
  <p>Plot 15, Town Centre, Luanshya, Zambia</p>
  <p>
    <a href="tel:+260978000111">Call Us ðŸ“ž</a> |
    <a href="https://wa.me/260978000111" target="_blank">WhatsApp Us ðŸ’¬</a>
  </p>
</div>

<div class="cart-icon" id="cartIcon">Cart: 0 | Qty: 0</div>

<h2>Select Items</h2>

<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Search items...">
</div>

<div class="item-slider" id="itemContainer"></div>

<div class="cart">
  <h3>Your Cart</h3>
  <table id="cartTable">
    <thead>
      <tr><th>Item</th><th>Qty</th><th>Price</th><th>Action</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <p><strong>Total: ZMW <span id="total">0.00</span></strong></p>

  <label for="initialsInput"><strong>Enter your initials to submit:</strong></label>
  <input id="initialsInput" type="text" placeholder="e.g. BM" />

  <button onclick="submitCart()">Submit</button>
  <div id="loader">Submitting...</div>
</div>

<script>
  const items = [
    { name: "Mosi Beer", price: 25, image: "M.jpeg" },
    { name: "Castle Lager", price: 24, image: "CC.jpeg" },
    { name: "Castle Light Dumpy", price: 25, image: "CLD.jpeg" },
    { name: "Black Label", price: 28, image: "BL.webp" },
    { name: "Coca-Cola bottled", price: 12, image: "MC.jpg" },
    { name: "Fanta", price: 12, image: "F.jpeg" }
  ];

  const cart = {};
  const itemContainer = document.getElementById("itemContainer");
  const cartTable = document.querySelector("#cartTable tbody");
  const totalDisplay = document.getElementById("total");
  const loader = document.getElementById("loader");
  const cartIcon = document.getElementById("cartIcon");
  const searchInput = document.getElementById("searchInput");

  function renderItems(filter = "") {
    itemContainer.innerHTML = "";
    const filteredItems = items.filter(item => item.name.toLowerCase().includes(filter.toLowerCase()));
    filteredItems.forEach(item => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <img src="${item.image}" alt="${item.name}">
        <p>${item.name}</p>
        <p>ZMW ${item.price}</p>
      `;
      div.addEventListener("click", () => addToCart(item));
      itemContainer.appendChild(div);
    });
  }

  searchInput.addEventListener("input", () => {
    renderItems(searchInput.value);
  });

  function updateCartDisplay() {
    cartTable.innerHTML = "";
    let total = 0, totalQty = 0, totalItems = 0;
    Object.entries(cart).forEach(([key, { item, qty }]) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${item.name}</td>
        <td>${qty}</td>
        <td>ZMW ${(item.price * qty).toFixed(2)}</td>
        <td><button class="delete-btn" onclick="removeFromCart('${key}')">Delete</button></td>
      `;
      cartTable.appendChild(row);
      total += item.price * qty;
      totalQty += qty;
      totalItems++;
    });
    totalDisplay.textContent = total.toFixed(2);
    cartIcon.textContent = `Cart: ${totalItems} | Qty: ${totalQty}`;
  }

  function addToCart(item) {
    if (cart[item.name]) {
      cart[item.name].qty++;
    } else {
      cart[item.name] = { item, qty: 1 };
    }
    updateCartDisplay();
  }

  function removeFromCart(name) {
    if (cart[name]) {
      delete cart[name];
      updateCartDisplay();
    }
  }

  function submitCart() {
    const initials = document.getElementById("initialsInput").value.trim();
    if (Object.keys(cart).length === 0) return alert("Cart is empty.");
    if (!initials || initials.length < 2) return alert("Please enter your initials to submit.");

    loader.style.display = "block";
    loader.style.color = "blue";
    loader.textContent = "Submitting...";

    const itemsData = Object.values(cart).map(({ item, qty }) =>
      `${item.name} (x${qty}) - ZMW ${(item.price * qty).toFixed(2)}`
    ).join(", ");

    const total = Object.values(cart).reduce((sum, entry) => sum + (entry.item.price * entry.qty), 0);

    fetch("https://script.google.com/macros/s/AKfycbxy3eUjHDcOCr-cEpihTTrTnixw_6rE2B_w_25UxK2SnTXPYvT0f44jM3Ud1A2yEXKB_A/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        submitter: initials.toUpperCase(),
        items: itemsData,
        total: total.toFixed(2)
      })
    })
    .then(res => res.json())
    .then(() => {
      loader.style.color = "green";
      loader.textContent = "Submitted successfully!";
      for (const key in cart) delete cart[key];
      updateCartDisplay();
      document.getElementById("initialsInput").value = "";
      setTimeout(() => loader.style.display = "none", 3000);
    })
    .catch(err => {
      loader.style.color = "red";
      loader.textContent = "Submission failed. Try again.";
    });
  }

  renderItems(); // initial load
</script>

</body>
</html>
